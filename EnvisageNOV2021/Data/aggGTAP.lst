GAMS 36.1.0  r2c0a44a Released Aug  2, 2021 WEX-WEI x86 64bit/MS Windows - 11/19/21 10:44:12 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1  *-----------------------------------------------------------------------------------------
       
         Envisage 10 project -- Data preparation modules
       
         GAMS file : AggGTAP.gms
       
         @purpose  : Aggregate standard GTAP database--emulation the GTAPAgg GEMPACK program.
       
         @author   : Dominique van der Mensbrugghe
         @date     : 21.10.16
         @since    :
         @refDoc   :
         @seeAlso  :
         @calledBy : AggGTAP.cmd
         @Options  : ifCSV (default=0)
                     ifAggTrade (default=1)
                     ifWater (default=OFF)
       
  21  *-----------------------------------------------------------------------------------------
  22   
  23  * ----------------------------------------------------------------------------------------
  24  *
  25  *  GAMS program to aggregate a GTAP database
  26  *
  27  * ----------------------------------------------------------------------------------------
  28   
  29  *  Define the aggregation macros
  30   
  31  $macro AGG1(v0,v,x0,x,mapx)                     v(x)     = sum(x0$mapx(x0,x), v0(x0))
  32  $macro AGG2(v0,v,x0,x,mapx,y0,y,mapy)           v(x,y)   = sum((x0,y0)$(mapx(x0,x) and mapy(y0,y)), v0(x0,y0))
  33  $macro AGG3(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz) v(x,y,z) = sum((x0,y0,z0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z)), v0(x0,y0
      ,z0))
  34  $macro AGG4(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz,w0,w,mapw) v(x,y,z,w) = sum((x0,y0,z0,w0)$(mapx(x0,x) and mapy(y0,y) and mapz(z
      0,z) and mapw(w0,w)), v0(x0,y0,z0,w0))
  35   
  36  *  Labor options
  37   
  38  acronyms off, on, noLab, agLab, allLab, giddLab, alterTax, GTAP, Env ;
  39   
INCLUDE    F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\SSPSets.gms
  41  *  Sets for SSPs
  42   
  43  sets
  44     tt          "Full time path including history" / 1950*2100 /
  45     th(tt)      "History"                          / 1950*2010 /
  46     tssp(tt)    "Full time path for SSPs"          / 2007*2100 /
  47     var "GDP variables" /
  48           GDP         "GDP in million $2007 MER"
  49           GDPpc       "GDP per capita in $2007 MER"
  50           gdpppp05    "GDP in $2005 PPP"
  51           gdppcppp05  "GDP per capita in $2005"
  52        /
  53     scen "Scenarios" /
  54        SSP1        "Sustainable development"
  55        SSP2        "Middle of the road"
  56        SSP3        "Regional rivalry"
  57        SSP4        "Inequality"
  58        SSP5        "Fossil-fueled development"
  59        UNMED2010   "UN Population Division Medium Variant 2010 revision"
  60        UNMED2012   "UN Population Division Medium Variant 2012 revision"
  61        UNMED2015   "UN Population Division Medium Variant 2015 revision"
  62        UNMED2017   "UN Population Division Medium Variant 2017 revision"
  63        UNMED2019   "UN Population Division Medium Variant 2019 revision"
  64        GIDD        "GIDD population projection"
  65        /
  66     ssp(scen) "SSP Scenarios" /
  67        SSP1        "Sustainable development"
  68        SSP2        "Middle of the road"
  69        SSP3        "Regional rivalry"
  70        SSP4        "Inequality"
  71        SSP5        "Fossil-fueled development"
  72        /
  73     mod "Models" /
  74        OECD        "OECD-based SSPs"
  75        IIASA       "IIASA-based SSPs"
  76        /
  77     tranche "Population cohorts" /
  78        PLT15       "Population less than 15"
  79        P1564       "Population aged 15 to 64"
  80        P65UP       "Population 65 and over"
  81        PTOTL       "Total population"
  82        /
  83     trs(tranche) "Population cohorts" /
  84        PLT15       "Population less than 15"
  85        P1564       "Population aged 15 to 64"
  86        P65UP       "Population 65 and over"
  87        /
  88     ed "Education levels" /
  89        ENONE       "No Education"
  90        EPRIM       "Primary Education"
  91        ESECN       "Secondary Education"
  92        ETERT       "Tertiary Education"
  93        ETOTL       "Total"
  94        /
  95     edx(ed) "Education levels excl total" /
  96        ENONE       "No Education"
  97        EPRIM       "Primary Education"
  98        ESECN       "Secondary Education"
  99        ETERT       "Tertiary Education"
 100        /
 101     sex   "Gender categories" /
 102        MAL         "Male"
 103        FEM         "Female"
 104        BOTH        "M+F"
 105        /
 106     sexx(sex) "Gender categories excl total"  /
 107        MAL         "Male"
 108        FEM         "Female"
 109        /
 110   
 111     edw "GIDD education labels" /
 112        educ0_6     "educ0_6"
 113        educ6_9     "educ6_9"
 114        educ9up     "educ9up"
 115        eductot     "eductot"
 116        /
 117   
 118     edwx(edw) "GIDD education labels /x total" /
 119        educ0_6     "educ0_6"
 120        educ6_9     "educ6_9"
 121        educ9up     "educ9up"
 122        /
 123   
 124     edj "Combined SSP/GIDD education levels" /
 125        elev0       "ENONE/EDUC0_6"
 126        elev1       "EPRIM/EDUC6_9"
 127        elev2       "ESECN/EDUC9UP"
 128        elev3       "ETERT"
 129        elevt       "Total"
 130     /
 131   
 132     mape1(edj, ed) "Mapping of SSP education to edj" /
 133        elev0.ENONE
 134        elev1.EPRIM
 135        elev2.ESECN
 136        elev3.ETERT
 137        elevt.ETOTL
 138     /
 139   
 140     mape2(edj, edw) "Mapping of GIDD education to edj" /
 141        elev0.EDUC0_6
 142        elev1.EDUC6_9
 143        elev2.EDUC9UP
 144        elevt.eductot
 145     /
 146  ;
 147   
 148  *  Load the aggregation mappings
 149   
INCLUDE    F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\ANX1Map.gms
 167   
 168  *  Only used to override GTAP parameters for Env model
 169   
 172   
 173  *  Select a labor option
 174  *  Valid options are:
 175  *     noLab  -- ignore employment volumes (all wages are set to 1)
 176  *     agLab  -- calculate ag and non-ag employment (wages uniform within zones)
 177  *     allLab -- assume employment data is correct for each sector (wages differ for each sector)
 178  *     giddLab -- Use the GIDD labor data
 179   
 180  $macro IFLABOR noLab
 181   
INCLUDE    F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\GTAPSets10APOWF.gms
 183   
 184  * ----------------------------------------------------------------------------------------
 185  *
 186  *  Set definitions for standard GTAP database
 187  *
 188  *     Includes water endowment
 189  *
 190  * ----------------------------------------------------------------------------------------
 191   
 192  scalar ver / 10 / ;
 193   
 195   
 196  set REG Set of regions in GTAP /
 197     AUS     "Australia"
 198     NZL     "New Zealand"
 199     XOC     "Rest of Oceania"
 200     CHN     "China"
 201     HKG     "Hong Kong"
 202     JPN     "Japan"
 203     KOR     "Korea"
 204     MNG     "Mongolia"
 205     TWN     "Taiwan"
 206     XEA     "Rest of East Asia"
 207     BRN     "Brunei Darussalam"
 208     KHM     "Cambodia"
 209     IDN     "Indonesia"
 210     LAO     "Laos"
 211     MYS     "Malaysia"
 212     PHL     "Philippines"
 213     SGP     "Singapore"
 214     THA     "Thailand"
 215     VNM     "Viet Nam"
 216     XSE     "Rest of Southeast Asia"
 217     BGD     "Bangladesh"
 218     IND     "India"
 219     NPL     "Nepal"
 220     PAK     "Pakistan"
 221     LKA     "Sri Lanka"
 222     XSA     "Rest of South Asia"
 223     CAN     "Canada"
 224     USA     "United States of America"
 225     MEX     "Mexico"
 226     XNA     "Rest of North America"
 227     ARG     "Argentina"
 228     BOL     "Bolivia"
 229     BRA     "Brazil"
 230     CHL     "Chile"
 231     COL     "Colombia"
 232     ECU     "Ecuador"
 233     PRY     "Paraguay"
 234     PER     "Peru"
 235     URY     "Uruguay"
 236     VEN     "Venezuela"
 237     XSM     "Rest of South America"
 238     CRI     "Costa Rica"
 239     GTM     "Guatemala"
 240     HND     "Honduras"
 241     NIC     "Nicaragua"
 242     PAN     "Panama"
 243     SLV     "El Salvador"
 244     XCA     "Rest of Central America"
 245     DOM     "Dominican Republic"
 246     JAM     "Jamaica"
 247     PRI     "Puerto Rico"
 248     TTO     "Trinidad and Tobago"
 249     XCB     "Rest of Caribbean"
 250     AUT     "Austria"
 251     BEL     "Belgium"
 252     CYP     "Cyprus"
 253     CZE     "Czech Republic"
 254     DNK     "Denmark"
 255     EST     "Estonia"
 256     FIN     "Finland"
 257     FRA     "France"
 258     DEU     "Germany"
 259     GRC     "Greece"
 260     HUN     "Hungary"
 261     IRL     "Ireland"
 262     ITA     "Italy"
 263     LVA     "Latvia"
 264     LTU     "Lithuania"
 265     LUX     "Luxembourg"
 266     MLT     "Malta"
 267     NLD     "Netherlands"
 268     POL     "Poland"
 269     PRT     "Portugal"
 270     SVK     "Slovakia"
 271     SVN     "Slovenia"
 272     ESP     "Spain"
 273     SWE     "Sweden"
 274     GBR     "United Kingdom"
 275     CHE     "Switzerland"
 276     NOR     "Norway"
 277     XEF     "Rest of EFTA"
 278     ALB     "Albania"
 279     BGR     "Bulgaria"
 280     BLR     "Belarus"
 281     HRV     "Croatia"
 282     ROU     "Romania"
 283     RUS     "Russian Federation"
 284     UKR     "Ukraine"
 285     XEE     "Rest of Eastern Europe"
 286     XER     "Rest of Europe"
 287     KAZ     "Kazakhstan"
 288     KGZ     "Kyrgyzstan"
 289     TJK     "Tajikistan"
 290     XSU     "Rest of Former Soviet Union"
 291     ARM     "Armenia"
 292     AZE     "Azerbaijan"
 293     GEO     "Georgia"
 294     BHR     "Bahrain"
 295     IRN     "Iran"
 296     ISR     "Israel"
 297     JOR     "Jordan"
 298     KWT     "Kuwait"
 299     OMN     "Oman"
 300     QAT     "Qatar"
 301     SAU     "Saudi Arabia"
 302     TUR     "Turkey"
 303     ARE     "United Arab Emirates"
 304     XWS     "Rest of Western Asia"
 305     EGY     "Egypt"
 306     MAR     "Morocco"
 307     TUN     "Tunisia"
 308     XNF     "Rest of North Africa"
 309     BEN     "Benin"
 310     BFA     "Burkina Faso"
 311     CMR     "Cameroon"
 312     CIV     "Côte d'Ivoire"
 313     GHA     "Ghana"
 314     GIN     "Guinea"
 315     NGA     "Nigeria"
 316     SEN     "Senegal"
 317     TGO     "Togo"
 318     XWF     "Rest of Western Africa"
 319     XCF     "Central Africa"
 320     XAC     "South-Central Africa"
 321     ETH     "Ethiopia"
 322     KEN     "Kenya"
 323     MDG     "Madagascar"
 324     MWI     "Malawi"
 325     MUS     "Mauritius"
 326     MOZ     "Mozambique"
 327     RWA     "Rwanda"
 328     TZA     "Tanzania"
 329     UGA     "Uganda"
 330     ZMB     "Zambia"
 331     ZWE     "Zimbabwe"
 332     XEC     "Rest of Eastern Africa"
 333     BWA     "Botswana"
 334     NAM     "Namibia"
 335     ZAF     "South Africa"
 336     XSC     "Rest of South African Customs Union"
 337     XTW     "Rest of the World"
 338  / ;
 339   
 340  alias(reg,r0) ; alias(reg,rp0) ;
 341   
 342  set comm "Set of activities in GTAP" /
 343     PDR     "Paddy rice"
 344     WHT     "Wheat"
 345     GRO     "Cereal grains nec"
 346     V_F     "Vegetables, fruit, nuts"
 347     OSD     "Oil seeds"
 348     C_B     "Sugar cane, sugar beet"
 349     PFB     "Plant-based fibers"
 350     OCR     "Crops nec"
 351     CTL     "Bovine cattle, sheep and goats, horses"
 352     OAP     "Animal products nec"
 353     RMK     "Raw milk"
 354     WOL     "Wool, silk-worm cocoons"
 355     FRS     "Forestry"
 356     FSH     "Fishing"
 357     COA     "Coal"
 358     OIL     "Oil"
 359     GAS     "Gas"
 360     OXT     "Other Extraction (formerly omn Minerals nec)"
 361     CMT     "Bovine meat products"
 362     OMT     "Meat products nec"
 363     VOL     "Vegetable oils and fats"
 364     MIL     "Dairy products"
 365     PCR     "Processed rice"
 366     SGR     "Sugar"
 367     OFD     "Food products nec"
 368     B_T     "Beverages and tobacco products"
 369     TEX     "Textiles"
 370     WAP     "Wearing apparel"
 371     LEA     "Leather products"
 372     LUM     "Wood products"
 373     PPP     "Paper products, publishing"
 374     P_C     "Petroleum, coal products"
 375     CHM     "Chemical products"
 376     BPH     "Basic pharmaceutical products"
 377     RPP     "Rubber and plastic products"
 378     NMM     "Mineral products nec"
 379     I_S     "Ferrous metals"
 380     NFM     "Metals nec"
 381     FMP     "Metal products"
 382     ELE     "Computer, electronic and optical products"
 383     EEQ     "Electrical equipment"
 384     OME     "Machinery and equipment nec"
 385     MVH     "Motor vehicles and parts"
 386     OTN     "Transport equipment nec"
 387     OMF     "Manufactures nec"
 388  *  ELY           "Electricity"
 389     TnD           "Electricity transmission and distribution"
 390     NuclearBL     "Nuclear power"
 391     CoalBL        "Coal power baseload"
 392     GasBL         "Gas power baseload"
 393     WindBL        "Wind power"
 394     HydroBL       "Hydro power baseload"
 395     OilBL         "Oil power baseload"
 396     OtherBL       "Other baseload"
 397     GasP          "Gas power peakload"
 398     HydroP        "Hydro power peakload"
 399     OilP          "Oil power peakload"
 400     SolarP        "Solar power"
 401     GDT     "Gas manufacture, distribution"
 402     WTR     "Water"
 403     CNS     "Construction"
 404     TRD     "Trade"
 405     AFS     "Accommodation, Food and service activities"
 406     OTP     "Transport nec"
 407     WTP     "Water transport"
 408     ATP     "Air transport"
 409     WHS     "Warehousing and support activities"
 410     CMN     "Communication"
 411     OFI     "Financial services nec"
 412     INS     "Insurance (formerly isr)"
 413     RSA     "Real estate activities"
 414     OBS     "Business services nec"
 415     ROS     "Recreational and other services"
 416     OSG     "Public Administration and defense"
 417     EDU     "Education"
 418     HHT     "Human health and social work activities"
 419     DWE     "Dwellings"
 420  / ;
 421   
 422  alias(acts,comm) ;
 423   
 424  alias(comm, i0) ;
 425  alias(acts, a0) ;
 426   
 427  SET MARG(comm) /
 428   
 429  otp
 430  wtp
 431  atp
 432   
 433  /;
 434  alias(img0, marg) ;
 435   
 436  set erg(comm) /
 437   
 438     "coa"    "Coal"
 439     "oil"    "Crude oil"
 440     "gas"    "Natural gas"
 441     "p_c"    "Refined oil"
 442  *  ELY           "Electricity"
 443     TnD           "Electricity transmission and distribution"
 444     NuclearBL     "Nuclear power"
 445     CoalBL        "Coal power baseload"
 446     GasBL         "Gas power baseload"
 447     WindBL        "Wind power"
 448     HydroBL       "Hydro power baseload"
 449     OilBL         "Oil power baseload"
 450     OtherBL       "Other baseload"
 451     GasP          "Gas power peakload"
 452     HydroP        "Hydro power peakload"
 453     OilP          "Oil power peakload"
 454     SolarP        "Solar power"
 455     "gdt"    "Gas distribution"
 456  / ;
 457   
 458   
 459  *  !!!! NEEDS REVIEW -- SHOULD PROBABLY MOVE THIS TO A MAP FILE
 460   
 461  parameter scaleXP(a0) ;
 462  scaleXP(a0) = 1 ;
 463   
 464  set fuel(erg) /
 465   
 466     coa   "Coal"
 467     oil   "Oil"
 468     gas   "Gas"
 469     p_c   "Petroleum, coal products"
 470     gdt   "Gas manufacture, distribution"
 471   
 472  / ;
 473   
 474   
 475  *  Calculate the energy content of fossil fuel consumption
 476  *
 477  *  THIS IS A QUICK FIX AND NEEDS REVIEW
 478   
 479  alias(fuel,f0) ;
 480  alias(erg,e0) ;
 481   
 482  set etr0(f0) "Which fuels"      / coa, oil, gas, p_c, gdt / ;
 483  set atr0(a0) "Which activities" / oil, p_c, chm, bph, rpp / ;
 484   
 485  sets
 486      acr0(a0) "Crop activities" /
 487        pdr   "Paddy rice"
 488        wht   "Wheat"
 489        gro   "Cereal grains, n.e.s."
 490        v_f   "Vegetables and fruits"
 491        osd   "Oil seeds"
 492        c_b   "Sugar cane and sugar beet"
 493        pfb   "Plant-based fibers"
 494        ocr   "Crops, n.e.s."
 495        /
 496     alv0(a0) "Livestock activities" /
 497        ctl   "Bovine cattle, sheep and goats, horses"
 498        oap   "Animal products n.e.s."
 499        rmk   "Raw milk"
 500        wol   "Wool, silk-worm cocoons"
 501        /
 502  ;
 503   
 504  set elya0(a0)  "Power activities" /
 505     TnD           "Electricity transmission and distribution"
 506     NuclearBL     "Nuclear power"
 507     CoalBL        "Coal power baseload"
 508     GasBL         "Gas power baseload"
 509     WindBL        "Wind power"
 510     HydroBL       "Hydro power baseload"
 511     OilBL         "Oil power baseload"
 512     OtherBL       "Other baseload"
 513     GasP          "Gas power peakload"
 514     HydroP        "Hydro power peakload"
 515     OilP          "Oil power peakload"
 516     SolarP        "Solar power"
 517  / ;
 518   
 519  set endw Set of endowment factors /
 520     Land           "Land"
 521     tech_aspros    "Technical and professional workers"
 522     clerks         "Clerical workers"
 523     service_shop   "Service shop"
 524     off_mgr_pros   "Management"
 525     ag_othlowsk    "Agriculture and other low-skill workers"
 526     Capital        "Capital"
 527     NatlRes        "Natural resources"
 529  / ;
 530   
 531  set lab(endw) Set of labor factors /
 532     tech_aspros    "Technical and professional workers"
 533     clerks         "Clerical workers"
 534     service_shop   "Service shop"
 535     off_mgr_pros   "Management"
 536     ag_othlowsk    "Agriculture and other low-skill workers"
 537  / ;
 538   
 539  alias(endw, fp0) ;
 540   
 541  set ENDWS(endw) "Sluggish endowments" /
 542     Land     "Land"
 543     NatlRes  "Natural resources"
 544  / ;
 545   
 546  singleton set CAPT(endw) "Capital endowment" /
 547     Capital  "Capital"
 548  / ;
 549   
 550  set LAND(endw) "Land endowment" /
 551     Land     "Land"
 552  / ;
 553   
 554  set NTRS(endw) "Natural resource endowment" /
 555     NatlRes  "Natural resources"
 556  / ;
 557   
 558  set WATER(endw) "Water commodity" /
 560  / ;
 561   
 562  set DIR /
 563     Domestic
 564     Imported
 565  / ;
 566   
 567  set TARTYPE /
 568     ADV      "Ad valorem"
 569     SPE      "Specific"
 570  / ;
 571   
 572  set wbnd0 "Aggregate water markets" /
 573     crp      "Crops"
 574     lvs      "Livestock"
 575     ind      "Industrial use"
 576     mun      "Municipal use"
 577  / ;
 578   
 579  *  Emissions sets
 580   
 581  set em "Emissions" /
 582     co2      "Carbon emissions"
 583     n2o      "N2O emissions"
 584     ch4      "Methane emissions"
 585     fgas     "Emissions of fluoridated gases"
 586   
 587     bc       "Black carbon (Gg)"
 588     co       "Carbon monoxide (Gg)"
 589     nh3      "Ammonia (Gg)"
 590  *  nmvb     "Non-methane volatile organic compounds (Gg)"
 591  *  nmvf     "Non-methane volatile organic compounds (Gg)"
 592     nmvoc    "Non-methane volatile organic compounds (Gg)"
 593     nox      "Nitrogen oxides (Gg)"
 594     oc       "Organic carbon (Gg)"
 595     pm10     "Particulate matter 10 (Gg)"
 596  *  pm2_5b   "Particulate matter 2.5 bio (Gg)"
 597  *  pm2_5f   "Particulate matter 2.5 fossil fuels (Gg)"
 598     pm2_5    "Particulate matter 2.5"
 599     so2      "Sulfur dioxide (Gg)"
 600  / ;
 601   
 602  set ghg(em) "Greenhouse gas emissions" /
 603   
 604     co2      "Carbon emissions"
 605     n2o      "N2O emissions"
 606     ch4      "Methane emissions"
 607     fgas     "Emissions of fluoridated gases"
 608   
 609  / ;
 610   
 611  set nghg(em) "Non-greenhouse gas emissions" /
 612   
 613     bc       "Black carbon (Gg)"
 614     co       "Carbon monoxide (Gg)"
 615     nh3      "Ammonia (Gg)"
 616  *  nmvb     "Non-methane volatile organic compounds (Gg)"
 617  *  nmvf     "Non-methane volatile organic compounds (Gg)"
 618     nmvoc    "Non-methane volatile organic compounds (Gg)"
 619     nox      "Nitrogen oxides (Gg)"
 620     oc       "Organic carbon (Gg)"
 621     pm10     "Particulate matter 10 (Gg)"
 622  *  pm2_5b   "Particulate matter 2.5 bio (Gg)"
 623  *  pm2_5f   "Particulate matter 2.5 fossil fuels (Gg)"
 624     pm2_5    "Particulate matter 2.5"
 625     so2      "Sulfur dioxide (Gg)"
 626   
 627  / ;
 628   
 629  *  Non-CO2 Emissions sets
 630   
 631  set emn(em) "Non-CO2 emissions" /
 632     n2o      "N2O emissions"
 633     ch4      "Methane emissions"
 634     fgas     "Emissions of fluoridated gases"
 635   
 636     bc       "Black carbon (Gg)"
 637     co       "Carbon monoxide (Gg)"
 638     nh3      "Ammonia (Gg)"
 639  *  nmvb     "Non-methane volatile organic compounds (Gg)"
 640  *  nmvf     "Non-methane volatile organic compounds (Gg)"
 641     nmvoc    "Non-methane volatile organic compounds (Gg)"
 642     nox      "Nitrogen oxides (Gg)"
 643     oc       "Organic carbon (Gg)"
 644     pm10     "Particulate matter 10 (Gg)"
 645  *  pm2_5b   "Particulate matter 2.5 bio (Gg)"
 646  *  pm2_5f   "Particulate matter 2.5 fossil fuels (Gg)"
 647     pm2_5    "Particulate matter 2.5"
 648     so2      "Sulfur dioxide (Gg)"
 649  / ;
 650   
 651  alias(emn, nco2) ;
 652   
 653  set mapnco2(nco2,nco2) ; mapnco2(nco2,nco2) = yes ;
 654   
 655  set nco2eq "Labels for NCO2 gases in GWP units" /
 656     co2_co2eq
 657     n2o_co2eq
 658     ch4_co2eq
 659     fgas_co2eq
 660  / ;
 661   
 662  set mapco2eq(em,nco2eq) /
 663     co2 . co2_co2eq
 664     n2o . n2o_co2eq
 665     ch4 . ch4_co2eq
 666     fgas. fgas_co2eq
 667  / ;
 668   
 669  parameters co2_mtoe(f0) "Standard emissions coefficients" /
 670  coa     3.881135
 671  oil     3.03961
 672  gas     2.22606
 673  p_c     2.89167
 674  gdt     2.22606
 675  / ;
 676   
 677  set lg "Labor sets in the GIDD database" /
 678        nsk      "Unskilled labor"
 679        skl      "Skilled labor"
 680  / ;
 681   
 682  set z Zones /
 683     rur   "Agricultural sectors"
 684     urb   "Non-agricultural sectors"
 685     nsg   "Non-segmented labor markets"
 686  / ;
 687   
 688  set rur(z) "Rural zone" /
 689     rur         "Rural zone"
 690  / ;
 691   
 692  set urb(z) "Urban zone" /
 693     urb         "Urban zone"
 694  / ;
 695   
 696  set nsg(z) "Both zones" /
 697     nsg         "Non-segmented labor markets"
 698  / ;
 699   
 700  set stdlab  "Standard SAM labels" /
 701     regY           "Regional household"
 702     hhd            "Household"
 703     gov            "Government"
 705     r_d            "Research and development"
 707     inv            "Investment"
 708     deprY          "Depreciation"
 709     tmg            "Trade margins"
 710     itax           "Indirect tax"
 711     ptax           "Production tax"
 712     mtax           "Import tax"
 713     etax           "Export tax"
 714     vtax           "Taxes on factors of production"
 715     ltax           "Taxes on labor use"
 716     ktax           "Taxes on capital use"
 717     rtax           "Taxes on natural resource use"
 718     vsub           "Subsidies on factors of production"
 719     wtax           "Waste tax"
 720     dtax           "Direct taxation"
 721     ctax           "Carbon tax"
 722     ntmY           "NTM revenues"
 723     trd            "Trade account"
 724     bop            "Balance of payments account"
 725     tot            "Total for row/column sums"
 726  / ;
 727   
 728  set fd(stdlab) "Domestic final demand agents" /
 729   
 730     hhd            "Household"
 731     gov            "Government"
 733     r_d            "Research and development"
 735     inv            "Investment"
 736     tmg            "Trade margins"
 737   
 738  / ;
 739   
 740  set h(fd) "Households" /
 741     hhd            "Household"
 742  / ;
 743   
 744  set gov(fd) "Government" /
 745     gov            "Government"
 746  / ;
 747   
 749  set r_d(fd) "Research and development" /
 750     r_d            "Research and development"
 751  / ;
 753   
 754  set inv(fd) "Investment"/
 755     inv            "Investment"
 756  / ;
 757   
 758  set tmg(fd) "Domestic supply of trade margins services" /
 759     tmg            "Trade margins"
 760  / ;
 761   
 762  * --------------------------------------------------------------------------------------------------
 763  *
 764  *  Mapping of SSP countries to GTAP regions
 765  *
 766  * --------------------------------------------------------------------------------------------------
 767   
 768  set c "Countries" /
 769   
 770     AUS     "Australia"
 771     NZL     "New Zealand"
 772     ASM     "American Samoa"
 773     COK     "Cook Islands, The"
 774     FJI     "Fiji, The Republic of"
 775     PYF     "French Polynesia"
 776     GUM     "Guam"
 777     KIR     "Kiribati, The Republic of"
 778     MHL     "Marshall Islands, The Republic of the"
 779     FSM     "Micronesia, The Federated States of"
 780     NRU     "Nauru, The Republic of"
 781     NCL     "New Caledonia"
 782     NIU     "Niue"
 783     MNP     "Northern Mariana Islands, The Commonwealth of the"
 784     PLW     "Palau, The Republic of"
 785     PNG     "Papua New Guinea, The Independent State of"
 786     WSM     "Samoa, The Independent State of"
 787     SLB     "Solomon Islands"
 788     TKL     "Tokelau"
 789     TON     "Tonga, The Kingdom of"
 790     TUV     "Tuvalu"
 791     VUT     "Vanuatu, The Republic of"
 792     WLF     "Wallis and Futuna Islands"
 793     CHN     "China, The People's Republic of"
 794     HKG     "Hong Kong Special Administrative Region of China, The"
 795     JPN     "Japan"
 796     KOR     "Korea, The Republic of"
 797     MNG     "Mongolia"
 798     TWN     "Taiwan Province of China"
 799     MAC     "Macao Special Administrative Region of China"
 800     PRK     "Korea, The Democratic People's Republic of"
 801     BRN     "Brunei Darussalam"
 802     KHM     "Cambodia, The Kingdom of"
 803     IDN     "Indonesia, The Republic of"
 804     LAO     "Lao People's Democratic Republic, The"
 805     MYS     "Malaysia"
 806     PHL     "Philippines, The Republic of the"
 807     SGP     "Singapore, The Republic of"
 808     THA     "Thailand, The Kingdom of"
 809     VNM     "Viet Nam, The Socialist Republic of"
 810     MMR     "Myanmar, The Republic of the Union of"
 811     TLS     "Timor-Leste, The Democratic Republic of"
 812     BGD     "Bangladesh, The People's Republic of"
 813     IND     "India, The Republic of"
 814     NPL     "Nepal, The Federal Democratic Republic of"
 815     PAK     "Pakistan, The Islamic Republic of"
 816     LKA     "Sri Lanka, The Democratic Socialist Republic of"
 817     AFG     "Afghanistan, The Islamic Republic of"
 818     BTN     "Bhutan, The Kingdom of"
 819     MDV     "Maldives, The Republic of"
 820     CAN     "Canada"
 821     USA     "United States of America, The"
 822     MEX     "United Mexican States, The"
 823     BMU     "Bermuda"
 824     GRL     "Greenland"
 825     SPM     "Saint Pierre and Miquelon"
 826     ARG     "Argentine Republic, The"
 827     BOL     "Bolivia, The Plurinational State of"
 828     BRA     "Brazil, The Federative of Brazil"
 829     CHL     "Chile, The Republic"
 830     COL     "Colombia, The Republic of"
 831     ECU     "Ecuador, The Republic of"
 832     PRY     "Paraguay, The Republic of"
 833     PER     "Peru, The Republic of"
 834     URY     "Uruguay, The Eastern Republic of"
 835     VEN     "Venezuela, The Bolivarian Republic of"
 836     FLK     "Falkland Islands (Malvinas), The"
 837     GUF     "French Guiana"
 838     GUY     "Guyana, The Republic of"
 839     SUR     "Suriname, The Republic of"
 840     CRI     "Costa Rica, The Republic of"
 841     GTM     "Guatemala, The Republic of"
 842     HND     "Honduras, The Republic of"
 843     NIC     "Nicaragua, The Republic of"
 844     PAN     "Panama, The Republic of"
 845     SLV     "El Salvador, The Republic of"
 846     BLZ     "Belize"
 847     DOM     "Dominican Republic, The"
 848     JAM     "Jamaica"
 849     PRI     "Puerto Rico"
 850     TTO     "Trinidad and Tobago, The Republic of"
 851     AIA     "Anguilla"
 852     ATG     "Antigua and Barbuda"
 853     ABW     "Aruba"
 854     ANT     "Netherland Antilles"
 855     BHS     "Bahamas, The Commonwealth of the"
 856     BRB     "Barbados"
 857     VGB     "British Virgin Islands, The"
 858     CYM     "Cayman Islands, The"
 859     CUB     "Cuba, The Republic of"
 860     DMA     "Dominica, The Commonwealth of"
 861     GRD     "Grenada"
 862     HTI     "Haiti, The Republic of"
 863     MSR     "Montserrat"
 864     KNA     "Saint Kitts and Nevis"
 865     LCA     "Saint Lucia"
 866     VCT     "Saint Vincent and the Grenadines"
 867     TCA     "Turks and Caicos Islands, The"
 868     VIR     "Virgin Islands of the United States, The"
 869     AUT     "Austria, The Republic of"
 870     BEL     "Belgium, The Kingdom of"
 871     CYP     "Cyprus, The Republic of"
 872     CZE     "Czech Republic, The"
 873     DNK     "Denmark, The Kingdom of"
 874     EST     "Estonia, The Republic of"
 875     FIN     "Finland, The Republic of"
 876     FRA     "French Republic, The"
 877     GLP     "Guadeloupe"
 878     MTQ     "Martinique"
 879     REU     "Réunion"
 880     DEU     "Germany, The Federal Republic of"
 881     GRC     "Hellenic Republic, The"
 882     HUN     "Hungary"
 883     IRL     "Ireland"
 884     ITA     "Italy, The Republic of"
 885     LVA     "Latvia, The Republic of"
 886     LTU     "Lithuania, The Republic of"
 887     LUX     "Luxembourg, The Grand Duchy of"
 888     MLT     "Malta, The Republic of"
 889     NLD     "Netherlands, The Kingdom of the"
 890     POL     "Poland, The Republic of"
 891     PRT     "Portuguese Republic, The"
 892     SVK     "Slovak Republic, The"
 893     SVN     "Slovenia, The Republic of"
 894     ESP     "Spain, The Kingdom of"
 895     SWE     "Sweden, The Kingdom of"
 896     GBR     "United Kingdom of Great Britain and Northern Ireland, The"
 897     CHE     "Swiss Confederation, The"
 898     NOR     "Norway, The Kingdom of"
 899     ISL     "Iceland, The Republic of"
 900     LIE     "Liechtenstein, The Principality of"
 901     ALB     "Albania, The Republic of"
 902     BGR     "Bulgaria, The Republic of Bulgaria"
 903     BLR     "Belarus, The Republic of"
 904     HRV     "Croatia, The Republic of"
 905     ROU     "Romania"
 906     RUS     "Russian Federation, The"
 907     UKR     "Ukraine"
 908     MDA     "Moldova, The Republic of"
 909     AND     "Andorra, The Principality of"
 910     BIH     "Bosnia and Herzegovina"
 911     CHI     "Channel Islands"
 912     FRO     "Faeroe Islands, The"
 913     GIB     "Gibraltar"
 914     VAT     "Holy See, The"
 915     IMN     "Isle of Man"
 916     MKD     "Macedonia, The Former Yugoslav Republic of"
 917     MCO     "Monaco, The Principality of"
 918     MNE     "Montenegro"
 919     SMR     "San Marino, The Republic of"
 920     SRB     "Serbia, The Republic of"
 921     UVK     "Kosovo"
 922     KAZ     "Kazakhstan, The Republic of"
 923     KGZ     "Kyrgyz Republic,The"
 924     TJK     "Tajikistan, The Republic of"
 925     TKM     "Turkmenistan"
 926     UZB     "Uzbekistan, The Republic of"
 927     ARM     "Armenia, The Republic of"
 928     AZE     "Azerbaijan, The Republic of"
 929     GEO     "Georgia"
 930     BHR     "Bahrain, The Kingdom of"
 931     IRN     "Iran, The Islamic Republic of"
 932     ISR     "Israel, The State of"
 933     JOR     "Jordan, The Hashemite Kingdom of"
 934     KWT     "Kuwait, The State of"
 935     OMN     "Oman, The Sultanate of"
 936     QAT     "Qatar, The State of"
 937     SAU     "Saudi Arabia, The Kingdom of"
 938     TUR     "Turkey, The Republic of"
 939     ARE     "United Arab Emirates, The"
 940     IRQ     "Iraq, The Republic of"
 941     LBN     "Lebanese Republic, The"
 942     PSE     "Palestine, The State of"
 943     SYR     "Syrian Arab Republic, The"
 944     YEM     "Yemen, The Republic of"
 945     EGY     "Egypt, The Arab Republic of"
 946     MAR     "Morocco, The Kingdom of"
 947     TUN     "Tunisia, The Republic of"
 948     DZA     "Algeria, The People's Democratic Republic of"
 949     LBY     "Libya"
 950     ESH     "Western Sahara"
 951     BEN     "Benin, The Republic of"
 952     BFA     "Burkina Faso"
 953     CMR     "Cameroon, The Republic"
 954     CIV     "Côte d'Ivoire, The Republic of"
 955     GHA     "Ghana, The Republic of"
 956     GIN     "Guinea, The Republic of"
 957     NGA     "Nigeria, The Federal Republic of"
 958     SEN     "Senegal, The Republic of"
 959     TGO     "Togolese Republic, The"
 960     CPV     "Cabo Verde, The Republic of"
 961     GMB     "Gambia, The Republic of the"
 962     GNB     "Guinea-Bissau, The Republic of"
 963     LBR     "Liberia, The Republic of"
 964     MLI     "Mali, The Republic of"
 965     MRT     "Mauritania, The Islamic Republic of"
 966     NER     "Niger, The Republic of the"
 967     SHN     "Saint Helena, Ascension and Tristan da Cunha"
 968     SLE     "Sierra Leone, The Republic of"
 969     CAF     "Central African Republic, The"
 970     TCD     "Chad, The Republic of"
 971     COG     "Congo, The Republic of the"
 972     GNQ     "Equatorial Guinea, The Republic of"
 973     GAB     "Gabonese Republic, The"
 974     STP     "Sao Tome and Principe, The Democratic Republic of"
 975     AGO     "Angola, The Republic of"
 976     COD     "Congo, The Democratic Republic of the"
 977     ETH     "Ethiopia, The Federal Democratic Republic of"
 978     KEN     "Kenya, The Republic of"
 979     MDG     "Madagascar, The Republic of"
 980     MWI     "Malawi, The Republic of"
 981     MUS     "Mauritius, The Republic of"
 982     MOZ     "Mozambique, The Republic of"
 983     RWA     "Rwanda, The Republic of"
 984     TZA     "Tanzania, The United Republic of"
 985     UGA     "Uganda, The Republic of"
 986     ZMB     "Zambia, The Republic of"
 987     ZWE     "Zimbabwe, The Republic of"
 988     BDI     "Burundi, The Republic of"
 989     COM     "Comoros, The Union of the"
 990     DJI     "Djibouti, The Republic of"
 991     ERI     "Eritrea, The State of"
 992     MYT     "Mayotte"
 993     SYC     "Seychelles, The Republic of"
 994     SOM     "Somalia, The Federal Republic of"
 995     SDN     "Sudan, The Republic of the"
 996     SSD     "South Sudan"
 997     BWA     "Botswana, The Republic of"
 998     NAM     "Namibia, The Republic of"
 999     ZAF     "South Africa, The Republic of"
1000     LSO     "Lesotho, The Kingdom of"
1001     SWZ     "Swaziland, The Kingdom of"
1002   
1003  / ;
1004   
1005  set mapc(reg,c) "GTAP mapping" /
1006   
1007     AUS.AUS
1008  *  AUS.CXR
1009  *  AUS.CCK
1010  *  AUS.HMD
1011  *  AUS.NFK
1012     NZL.NZL
1013     XOC.ASM
1014     XOC.COK
1015     XOC.FJI
1016     XOC.PYF
1017     XOC.GUM
1018     XOC.KIR
1019     XOC.MHL
1020     XOC.FSM
1021     XOC.NRU
1022     XOC.NCL
1023     XOC.MNP
1024     XOC.NIU
1025     XOC.PLW
1026     XOC.PNG
1027     XOC.WSM
1028     XOC.SLB
1029     XOC.TKL
1030     XOC.TON
1031     XOC.TUV
1032     XOC.VUT
1033     XOC.WLF
1034     CHN.CHN
1035     HKG.HKG
1036     JPN.JPN
1037     KOR.KOR
1038     MNG.MNG
1039     TWN.TWN
1040     XEA.MAC
1041     XEA.PRK
1042     BRN.BRN
1043     KHM.KHM
1044     IDN.IDN
1045     LAO.LAO
1046     MYS.MYS
1047     PHL.PHL
1048     SGP.SGP
1049     THA.THA
1050     VNM.VNM
1051     XSE.MMR
1052     XSE.TLS
1053     BGD.BGD
1054     IND.IND
1055     NPL.NPL
1056     PAK.PAK
1057     LKA.LKA
1058     XSA.AFG
1059     XSA.BTN
1060     XSA.MDV
1061     CAN.CAN
1062     USA.USA
1063     MEX.MEX
1064     XNA.BMU
1065     XNA.GRL
1066     XNA.SPM
1067     ARG.ARG
1068     BOL.BOL
1069     BRA.BRA
1070     CHL.CHL
1071     COL.COL
1072     ECU.ECU
1073     PRY.PRY
1074     PER.PER
1075     URY.URY
1076     VEN.VEN
1077     XSM.FLK
1078     XSM.GUF
1079     XSM.GUY
1080     XSM.SUR
1081     CRI.CRI
1082     GTM.GTM
1083     HND.HND
1084     NIC.NIC
1085     PAN.PAN
1086     SLV.SLV
1087     XCA.BLZ
1088     DOM.DOM
1089     JAM.JAM
1090     PRI.PRI
1091     TTO.TTO
1092     XCB.AIA
1093     XCB.ATG
1094     XCB.ABW
1095     XCB.BHS
1096     XCB.BRB
1097     XCB.CYM
1098     XCB.CUB
1099     XCB.DMA
1100     XCB.GRD
1101     XCB.HTI
1102     XCB.MSR
1103     XCB.ANT
1104     XCB.KNA
1105     XCB.LCA
1106     XCB.VCT
1107     XCB.TCA
1108     XCB.VGB
1109     XCB.VIR
1110     AUT.AUT
1111     BEL.BEL
1112     CYP.CYP
1113     CZE.CZE
1114     DNK.DNK
1115     EST.EST
1116     FIN.FIN
1117     FRA.FRA
1118     FRA.MTQ
1119     FRA.GLP
1120     DEU.DEU
1121     GRC.GRC
1122     HUN.HUN
1123     IRL.IRL
1124     ITA.ITA
1125     LVA.LVA
1126     LTU.LTU
1127     LUX.LUX
1128     MLT.MLT
1129     NLD.NLD
1130     POL.POL
1131     PRT.PRT
1132     SVK.SVK
1133     SVN.SVN
1134     ESP.ESP
1135     SWE.SWE
1136     GBR.GBR
1137     GBR.CHI
1138     GBR.IMN
1139     CHE.CHE
1140     NOR.NOR
1141     XEF.ISL
1142     XEF.LIE
1143     ALB.ALB
1144     BGR.BGR
1145     BLR.BLR
1146     HRV.HRV
1147     ROU.ROU
1148     RUS.RUS
1149     UKR.UKR
1150     XEE.MDA
1151     XER.AND
1152     XER.BIH
1153     XER.FRO
1154     XER.GIB
1155  *  XER.GGY
1156     XER.VAT
1157  *  XER.JEY
1158  *  XER.KSV
1159     XER.MKD
1160     XER.MCO
1161     XER.MNE
1162     XER.SMR
1163     XER.SRB
1164     XER.UVK
1165     KAZ.KAZ
1166     KGZ.KGZ
1167     TJK.TJK
1168     XSU.TKM
1169     XSU.UZB
1170     ARM.ARM
1171     AZE.AZE
1172     GEO.GEO
1173     BHR.BHR
1174     IRN.IRN
1175     ISR.ISR
1176     JOR.JOR
1177     KWT.KWT
1178     OMN.OMN
1179     QAT.QAT
1180     SAU.SAU
1181     TUR.TUR
1182     ARE.ARE
1183     XWS.IRQ
1184     XWS.LBN
1185     XWS.PSE
1186     XWS.SYR
1187     XWS.YEM
1188     EGY.EGY
1189     MAR.MAR
1190     TUN.TUN
1191     XNF.DZA
1192     XNF.LBY
1193     XNF.ESH
1194     BEN.BEN
1195     BFA.BFA
1196     CMR.CMR
1197     CIV.CIV
1198     GHA.GHA
1199     GIN.GIN
1200     NGA.NGA
1201     SEN.SEN
1202     TGO.TGO
1203     XWF.CPV
1204     XWF.GMB
1205     XWF.GNB
1206     XWF.LBR
1207     XWF.MLI
1208     XWF.MRT
1209     XWF.NER
1210     XWF.SHN
1211     XWF.SLE
1212     XCF.CAF
1213     XCF.TCD
1214     XCF.COG
1215     XCF.GNQ
1216     XCF.GAB
1217     XCF.STP
1218     XAC.AGO
1219     XAC.COD
1220     ETH.ETH
1221     KEN.KEN
1222     MDG.MDG
1223     MWI.MWI
1224     MUS.MUS
1225     MOZ.MOZ
1226     TZA.TZA
1227     RWA.RWA
1228     UGA.UGA
1229     ZMB.ZMB
1230     ZWE.ZWE
1231     XEC.BDI
1232     XEC.COM
1233     XEC.DJI
1234     XEC.ERI
1235     XEC.MYT
1236     XEC.REU
1237     XEC.SYC
1238     XEC.SOM
1239     XEC.SDN
1240     XEC.SSD
1241     BWA.BWA
1242     NAM.NAM
1243     ZAF.ZAF
1244     XSC.LSO
1245     XSC.SWZ
1246  *  XTW.ATA
1247  *  XTW.BVT
1248  *  XTW.IOT
1249  *  XTW.ATF
1250  / ;
1252   
1254  * Andre modified this line to use a relative path
1255   
1262   
1264   
1265  sets
1266   
1267     i  "Commodities"   /
1268           AGR          "Agriculture"
1269           FRS          "Forestry"
1270           COA          "Coal"
1271           OIL          "Oil"
1272           GAS          "Gas"
1273           OXT          "Minerals nec"
1274           EIT          "Vegetable oils and fats"
1275           XMN          "Dairy products"
1276           P_C          "Petroleum and coal products"
1277           ETD          "Electricity transmission"
1278           CLP          "Coal-fired power"
1279           OLP          "Oil-fired power"
1280           GSP          "Gas-fired power"
1281           NUC          "Nuclear power"
1282           HYD          "Hydro power"
1283           SOL          "Solar power"
1284           WND          "Wind power"
1285           XEL          "Other power"
1286           SRV          "Services"
1287        /
1288   
1289     r  "Regions" /
1290           USA          "United States"
1291           EUR          "Western Europe"
1292           XOE          "Other HIY OECD"
1293           CHN          "China"
1294           RUS          "Russia"
1295           OPC          "Major oil and gas exporters"
1296           XEA          "Rest of East Asia and Pacific"
1297           SAS          "South Asia"
1298           XLC          "Rest of Latin America & Caribbean"
1299           ROW          "Rest of the World"
1300        /
1301   
1302     fp  "Factors of production"  /
1303        nsk            "Unskilled labor"
1304        skl            "Skilled labor"
1305        cap            "Capital"
1306        lnd            "Land"
1307        nrs            "Natural resource"
1308        /
1309   
1310     l(fp)  "Labor factors" /
1311        nsk            "Unskilled labor"
1312        skl            "Skilled labor"
1313        /
1314     wb "Intermediate labor bundle(s)" /
1315        Single         "Single intermediate labor bundle"
1316     /
1317     maplab1(wb) "Mapping of intermediate labor demand bundle(s) to LAB1" /
1318        Single
1319     /
1320     mapl(wb,l) "Mapping of labor categories to intermedate demand bundle(s)" /
1321        Single.(nsk, skl)
1322     /
1323     lr(l) "Reference labor for skill premium" /
1324        skl            "Skilled labor"
1325        /
1326     cap(fp) "Capital" /
1327        cap            "Capital"
1328        /
1329     lnd(fp) "Land endowment" /
1330        lnd            "Land"
1331        /
1332     nrs(fp) "Natural resource" /
1333        nrs            "Natural resource"
1334        /
1335     wat(fp) "Water resource" / /
1336   
1337     ra "Aggregate regions for emission regimes and model output" /
1338        hic   "High-income countries"
1339        lmy   "Developing countries"
1340        wld   "World Total"
1341        /
1342     ia "Aggregate commodities for model output" /
1343        tagr-c      "Agriculture"
1344        tman-c      "Manufacturing"
1345        tsrv-c      "Services"
1346        toth-c      "Other"
1347        ttot-c      "Total"
1348        /
1349     aga  "Aggregate activities for model output" /
1350        tagr-a      "Agriculture"
1351        tman-a      "Manufacturing"
1352        tsrv-a      "Services"
1353        toth-a      "Other"
1354        ttot-a      "Total"
1355        /
1356     lagg "Aggregate labor for model output" /
1357        tot         "Total labor"
1358        /
1359  ;
1360   
1361  *  !!!! Explicit assumption about diagonality
1362   
1363  alias(i,a) ;
1364   
1365  alias(m,i) ;
1366   
1367  *  User defined parameters (i.e. not aggregated by aggregation facility)
1368  *  NEW -- New region specific
1369   
1370  Parameter
1371     etrae1(fp,r) "CET transformation elasticities for factor allocation"
1372  ;
1373   
1374  parameter etrae0(fp) "CET transformation elasticities for factor allocation" /
1375     nsk       inf
1376     skl       inf
1377     cap       inf
1378     lnd       1.0
1379     nrs      0.001
1380  / ;
1381   
1382  etrae1(fp,r) = etrae0(fp) ;
1383   
1384  *  NEW -- MAKE ELASTICITIES
1385   
1386  Parameter
1387     etraq1(a,r)       "MAKE CET Elasticity"
1388     esubq1(i,r)       "MAKE CES Elasticity"
1389  ;
1390  etraq1(a,r) = 5 ;
1391  esubq1(i,r) = inf ;
1392   
1393  *  NEW -- EXPENDITURE ELASTICITIES
1394   
1395  Parameter
1396     esubg1(r)         "Government expenditure CES elasticity"
1397     esubi1(r)         "Investment expenditure CES elasticity"
1398     esubs1(m)         "Transport margins CES elasticity"
1399  ;
1400   
1401  esubg1(r) = 1 ;
1402  esubi1(r) = 0 ;
1403  esubs1(m) = 1 ;
1404   
1405  *  This zonal mapping is for labor/volume splits between agriculture and other
1406   
1407  set mapz(z,a)  "Mapping of activities to zones" /
1408     rur.(agr)
1409  / ;
1410   
1411  mapz("urb",a) = not mapz("rur",a) ;
1412  mapz("nsg",a) = yes ;
1413   
1414  * >>>> MUST INSERT RESIDUAL REGION (ONLY ONE)
1415   
1416  set rres(r) "Residual region" /
1417   
1418     USA
1419   
1420  / ;
1421   
1422  * >>>> MUST INSERT MUV REGIONS (ONE OR MORE)
1423   
1424  set rmuv(r) "MUV regions" /
1425     USA
1426     EUR
1427     XOE
1428     CHN
1429  / ;
1430   
1431  set mapt(a) "Merge land and capital payments in the following sectors" /
1432   
1433  / ;
1434   
1435  set mapn(a) "Merge natl. res. and capital payments in the following sectors" /
1436     xmn
1437  / ;
1438   
1439  *  MAPPINGS TO GTAP
1440   
1441  set mapa(acts,a) /
1442     PDR.AGR
1443     WHT.AGR
1444     GRO.AGR
1445     V_F.AGR
1446     OSD.AGR
1447     C_B.AGR
1448     PFB.AGR
1449     OCR.AGR
1450     CTL.AGR
1451     OAP.AGR
1452     RMK.AGR
1453     WOL.AGR
1454     FRS.FRS
1455     FSH.XMN
1456     COA.COA
1457     OIL.OIL
1458     GAS.GAS
1459     OXT.OXT
1460     CMT.XMN
1461     OMT.XMN
1462     VOL.XMN
1463     MIL.XMN
1464     PCR.XMN
1465     SGR.XMN
1466     OFD.XMN
1467     B_T.XMN
1468     TEX.XMN
1469     WAP.XMN
1470     LEA.XMN
1471     LUM.XMN
1472     PPP.EIT
1473     P_C.P_C
1474     CHM.EIT
1475     BPH.XMN
1476     RPP.EIT
1477     NMM.EIT
1478     I_S.EIT
1479     NFM.EIT
1480     FMP.XMN
1481     MVH.XMN
1482     OTN.XMN
1483     ELE.XMN
1484     EEQ.XMN
1485     OME.XMN
1486     OMF.XMN
1487     TND.ETD
1488     NUCLEARBL.NUC
1489     COALBL.CLP
1490     GASBL.GSP
1491     WINDBL.WND
1492     HYDROBL.HYD
1493     OILBL.OLP
1494     OTHERBL.XEL
1495     GASP.GSP
1496     HYDROP.HYD
1497     OILP.OLP
1498     SOLARP.SOL
1499     GDT.GAS
1500     WTR.SRV
1501     CNS.SRV
1502     TRD.SRV
1503     AFS.SRV
1504     OTP.SRV
1505     WTP.SRV
1506     ATP.SRV
1507     WHS.SRV
1508     CMN.SRV
1509     OFI.SRV
1510     INS.SRV
1511     RSA.SRV
1512     OBS.SRV
1513     ROS.SRV
1514     OSG.SRV
1515     EDU.SRV
1516     HHT.SRV
1517     DWE.SRV
1518  / ;
1519   
1521     set mapi(comm,i) ;
1522     loop((acts,comm)$sameas(acts,comm),
1523        mapi(comm,i) = mapa(acts,i) ;
1524     ) ;
1526   
1527  set mapr(reg,r) /
1528     AUS.XOE
1529     NZL.XOE
1530     XOC.XEA
1531     CHN.CHN
1532     HKG.XEA
1533     JPN.XOE
1534     KOR.XOE
1535     MNG.XEA
1536     TWN.XEA
1537     XEA.XEA
1538     BRN.XEA
1539     KHM.XEA
1540     IDN.XEA
1541     LAO.XEA
1542     MYS.XEA
1543     PHL.XEA
1544     SGP.XEA
1545     THA.XEA
1546     VNM.XEA
1547     XSE.XEA
1548     BGD.SAS
1549     IND.SAS
1550     NPL.SAS
1551     PAK.SAS
1552     LKA.SAS
1553     XSA.SAS
1554     CAN.XOE
1555     USA.USA
1556     MEX.XLC
1557     XNA.XLC
1558     ARG.XLC
1559     BOL.XLC
1560     BRA.OPC
1561     CHL.XLC
1562     COL.XLC
1563     ECU.XLC
1564     PRY.XLC
1565     PER.XLC
1566     URY.XLC
1567     VEN.OPC
1568     XSM.XLC
1569     CRI.XLC
1570     GTM.XLC
1571     HND.XLC
1572     NIC.XLC
1573     PAN.XLC
1574     SLV.XLC
1575     XCA.XLC
1576     DOM.XLC
1577     JAM.XLC
1578     PRI.XLC
1579     TTO.XLC
1580     XCB.XLC
1581     AUT.EUR
1582     BEL.EUR
1583     CYP.EUR
1584     CZE.EUR
1585     DNK.EUR
1586     EST.EUR
1587     FIN.EUR
1588     FRA.EUR
1589     DEU.EUR
1590     GRC.EUR
1591     HUN.EUR
1592     IRL.EUR
1593     ITA.EUR
1594     LVA.EUR
1595     LTU.EUR
1596     LUX.EUR
1597     MLT.EUR
1598     NLD.EUR
1599     POL.EUR
1600     PRT.EUR
1601     SVK.EUR
1602     SVN.EUR
1603     ESP.EUR
1604     SWE.EUR
1605     GBR.EUR
1606     CHE.EUR
1607     NOR.EUR
1608     XEF.EUR
1609     ALB.ROW
1610     BGR.ROW
1611     BLR.ROW
1612     HRV.ROW
1613     ROU.ROW
1614     RUS.RUS
1615     UKR.ROW
1616     XEE.ROW
1617     XER.ROW
1618     KAZ.OPC
1619     KGZ.ROW
1620     TJK.ROW
1621     XSU.ROW
1622     ARM.ROW
1623     AZE.ROW
1624     GEO.ROW
1625     BHR.OPC
1626     IRN.OPC
1627     ISR.ROW
1628     JOR.ROW
1629     KWT.OPC
1630     OMN.OPC
1631     QAT.OPC
1632     SAU.OPC
1633     TUR.ROW
1634     ARE.OPC
1635     XWS.OPC
1636     EGY.ROW
1637     MAR.ROW
1638     TUN.ROW
1639     XNF.OPC
1640     BEN.ROW
1641     BFA.ROW
1642     CMR.ROW
1643     CIV.ROW
1644     GHA.ROW
1645     GIN.ROW
1646     NGA.OPC
1647     SEN.ROW
1648     TGO.ROW
1649     XWF.ROW
1650     XCF.ROW
1651     XAC.OPC
1652     ETH.ROW
1653     KEN.ROW
1654     MDG.ROW
1655     MWI.ROW
1656     MUS.ROW
1657     MOZ.ROW
1658     RWA.ROW
1659     TZA.ROW
1660     UGA.ROW
1661     ZMB.ROW
1662     ZWE.ROW
1663     XEC.ROW
1664     BWA.ROW
1665     NAM.ROW
1666     ZAF.ROW
1667     XSC.ROW
1668     XTW.ROW
1669  / ;
1670   
1671  set mapf(endw, fp) /
1672     ag_othlowsk  . nsk
1673     service_shop . nsk
1674     clerks       . nsk
1675     tech_aspros  . skl
1676     off_mgr_pros . skl
1677     Capital      . cap
1678     Land         . lnd
1679     NatlRes      . nrs
1680  *  Water        . lnd
1681  / ;
1682   
1683  set maplGIDD(lg, l) "Mapping to GIDD labor database" /
1684     nsk.(nsk)
1685     skl.(skl)
1686  / ;
1687   
1688  * ----------------------------------------------------------------------------------------
1689  *
1690  *     Section dealing with model aggregations (to handle non-diagonal make matrix)
1691  *
1692  * ----------------------------------------------------------------------------------------
1693   
1694  *  Model aggregation(s)
1695   
1696  set actf "Model activities" /
1697           sets.i
1698  / ;
1699   
1700  set commf "Model commodities" /
1701           AGR          "Agriculture"
1702           FRS          "Forestry"
1703           COA          "Coal"
1704           OIL          "Oil"
1705           GAS          "Gas"
1706           OXT          "Minerals nec"
1707           EIT          "Vegetable oils and fats"
1708           XMN          "Dairy products"
1709           P_C          "Petroleum and coal products"
1710           ELY          "Electricity"
1711           SRV          "Services"
1712  / ;
1713   
1714  set mapaf(i, actf) "Mapping from original to modeled activities" /
1715       AGR.AGR
1716       FRS.FRS
1717       COA.COA
1718       OIL.OIL
1719       GAS.GAS
1720       OXT.OXT
1721       EIT.EIT
1722       XMN.XMN
1723       P_C.P_C
1724       ETD.ETD
1725       CLP.CLP
1726       OLP.OLP
1727       GSP.GSP
1728       NUC.NUC
1729       HYD.HYD
1730       SOL.SOL
1731       WND.WND
1732       XEL.XEL
1733       SRV.SRV
1734  / ;
1735   
1736  set mapif(i, commf) "Mapping from original to modeled commodities" /
1737       AGR.AGR
1738       FRS.FRS
1739       COA.COA
1740       OIL.OIL
1741       GAS.GAS
1742       OXT.OXT
1743       EIT.EIT
1744       XMN.XMN
1745       P_C.P_C
1746       ETD.ELY
1747       CLP.ELY
1748       OLP.ELY
1749       GSP.ELY
1750       NUC.ELY
1751       HYD.ELY
1752       SOL.ELY
1753       WND.ELY
1754       XEL.ELY
1755       SRV.SRV
1756  / ;
1757   
1758  * >>>> MUST INSERT MUV COMMODITIES (ONE OR MORE)
1759  *      !!!! Be careful of compatibility with modeled imuv
1760  *           This one is intended for AlterTax
1761   
1762  set imuvf(commf) "MUV commodities" /
1763     eit, xmn
1764  / ;
1765   
1766  *  >>>> Aggregation of modeled sectors and regions
1767   
1768  set mapia(ia,commf)"mapping of individual comm to aggregate comm" /
1769       tagr-c.agr
1770       tagr-c.frs
1771       toth-c.coa
1772       toth-c.oil
1773       toth-c.gas
1774       toth-c.oxt
1775       tman-c.xmn
1776       tman-c.p_c
1777       tman-c.eit
1778       tsrv-c.ely
1779       tsrv-c.srv
1780  / ;
1781  mapia("ttot-c",commf) = yes ;
1782   
1783  set mapaga(aga,actf)"mapping of individual comm to aggregate activities" /
1784       tagr-a.agr
1785       tagr-a.frs
1786       toth-a.coa
1787       toth-a.oil
1788       toth-a.gas
1789       toth-a.oxt
1790       tman-a.xmn
1791       tman-a.p_c
1792       tman-a.eit
1793       tsrv-a.etd
1794       tsrv-a.nuc
1795       tsrv-a.clp
1796       tsrv-a.gsp
1797       tsrv-a.wnd
1798       tsrv-a.hyd
1799       tsrv-a.olp
1800       tsrv-a.xel
1801       tsrv-a.sol
1802       tsrv-a.srv
1803  / ;
1804  mapaga("ttot-a",actf) = yes ;
1805   
1806  set mapra(ra,r) "Mapping of model regions to aggregate regions" /
1807     hic.(USA, EUR, XOE)
1808  / ;
1809  mapra("lmy", r)$(not mapra("hic",r)) = yes ;
1810  mapra("wld", r) = yes ;
1811  mapra(ra,r)$sameas(ra,r) = yes ;
1812   
1813  *  If none, just use 'all'. The mapping for 'All' will be done automatically.
1814  *  Here the user can only input the activity subset of agents as the
1815  *  aggregation facility is unaware of Armington agents
1816   
1817  set
1818     aets "Agent specific ETS definitions" /
1819        All      "ALL agents"
1820     /
1821     aa   "Armington agents" / sets.actf, sets.fd /
1822     mapets(aets,aa)
1823  ;
1824  mapets("all",aa) = yes;
1825   
1826  set maplagg(lagg,l) "Mapping of model labor to aggregate labor" ;
1827  maplagg("Tot",l) = yes ;
1828   
1829  set sortOrder / sort1*sort500 / ;
1830  set mapRegSort(sortOrder,r) /
1831     Sort1  . USA
1832     Sort2  . EUR
1833     Sort3  . XOE
1834     Sort4  . CHN
1835     Sort5  . RUS
1836     Sort6  . OPC
1837     Sort7  . XEA
1838     Sort8  . SAS
1839     Sort9  . XLC
1840     Sort10 . ROW
1841  / ;
1842   
1843  set mapActSort(sortOrder,actf) /
1844     Sort1  . AGR
1845     Sort2  . FRS
1846     Sort3  . COA
1847     Sort4  . OIL
1848     Sort5  . GAS
1849     Sort6  . OXT
1850     Sort7  . EIT
1851     Sort8  . XMN
1852     Sort9  . P_C
1853     Sort10 . ETD
1854     Sort11 . CLP
1855     Sort12 . OLP
1856     Sort13 . GSP
1857     Sort14 . NUC
1858     Sort15 . HYD
1859     Sort16 . SOL
1860     Sort17 . WND
1861     Sort18 . XEL
1862     Sort19 . SRV
1863  / ;
1864   
1865  set mapCommSort(sortOrder,commf) /
1866     Sort1  . AGR
1867     Sort2  . FRS
1868     Sort3  . COA
1869     Sort4  . OIL
1870     Sort5  . GAS
1871     Sort6  . OXT
1872     Sort7  . EIT
1873     Sort8  . XMN
1874     Sort9  . P_C
1875     Sort10 . ELY
1876     Sort11 . SRV
1877  / ;
1878   
1879  * ----------------------------------------------------------------------------------------
1880  *
1881  *     Envisage section
1882  *
1883  * ----------------------------------------------------------------------------------------
1884   
1885  *  >>>> Activity related sets and subsets
1886   
1887  set acr(actf)  "Crop activities" /
1888  / ;
1889   
1890  set alv(actf)  "Livestock activities" /
1891  / ;
1892   
1893  set agr(actf)  "Agricultural activities" /
1894     agr
1895  / ;
1896   
1897  set man(actf)  "Manufacturing activities" /
1898       xmn
1899       eit
1900  / ;
1901   
1902  set aenergy(actf) "Energy activities" /
1903        coa
1904        oil
1905        gas
1906        p_c
1907        clp
1908        olp
1909        gsp
1910        nuc
1911        hyd
1912        wnd
1913        sol
1914        xel
1915        etd
1916  / ;
1917   
1918  set affl(actf) "Fossil fuel activities" /
1919        coa
1920        oil
1921        gas
1922  / ;
1923   
1924  set aw(actf)   "Water services activities" /
1925  / ;
1926   
1927  set elya(actf) "Power activities" /
1928        clp
1929        olp
1930        gsp
1931        nuc
1932        hyd
1933        wnd
1934        sol
1935        xel
1936        etd
1937  / ;
1938   
1939  set etd(actf)  "Electricity transmission and distribution activities" /
1940        etd
1941  / ;
1942   
1943  set primElya(actf) "Primary power activities" /
1944        nuc
1945        hyd
1946        wnd
1947        sol
1948        xel
1949  / ;
1950   
1951  set pb   "Power bundles" /
1952     coap       "Coal bundle"
1953     oilp       "Oil bundle"
1954     gasp       "Gas bundle"
1955     nucp       "Nuclear"
1956     hydp       "Hydro"
1957     renp       "Renewables"
1958  / ;
1959   
1960  set mappow(pb,elya) "Mapping of power activities to power bundles" /
1961     nucp    .NUC
1962     hydp    .HYD
1963     renp    .WND
1964     renp    .SOL
1965     renp    .XEL
1966     coap    .CLP
1967     oilp    .OLP
1968     gasp    .GSP
1969  / ;
1970   
1971  *  >>>> Commodity sets and subsets
1972   
1973  set frt(commf) "Fertilizer commodities" /
1974  / ;
1975   
1976  set feed(commf) "Feed commodities" /
1977  / ;
1978   
1979  set iw(commf) "Water services commodities" /
1980  / ;
1981   
1982  set e(commf) "Energy commodities" /
1983        coa
1984        oil
1985        gas
1986        p_c
1987        ely
1988  / ;
1989   
1990  set elyc(commf) "Electricity commodities" /
1991        ely
1992  / ;
1993   
1994  set f(commf) "Fuel commodities" /
1995        coa
1996        oil
1997        gas
1998        p_c
1999  / ;
2000   
2001  *  This zonal mapping is for labor market segmentation in final model
2002   
2003  set mapzf(z,actf)  "Mapping of activities to zones" /
2004       rur.agr
2005  / ;
2006   
2007  mapzf("urb",actf) = not mapzf("rur",actf) ;
2008  mapzf("nsg",actf) = yes ;
2009   
2010  * >>>> Household commodity section
2011   
2012  set k "Household commodities" /
2013           agr          "Agriculture"
2014           nrg          "Energy"
2015           oxt          "Minerals nec"
2016           xmn          "Other manufacturing"
2017           eit          "Energy intensive goods"
2018           srv          "Services"
2019  / ;
2020   
2021  set fud(k) "Household food commodities" /
2022           agr          "Agriculture"
2023  / ;
2024   
2025  set mapk(commf,k) "Mapping from i to k" /
2026       agr.agr
2027       frs.oxt
2028       coa.nrg
2029       oil.nrg
2030       gas.nrg
2031       oxt.oxt
2032       xmn.xmn
2033       p_c.nrg
2034       eit.eit
2035       ely.nrg
2036       srv.srv
2037  / ;
2038   
2039  set cpindx  "CPI indices to be derived by the model" /
2040     tot      "Total price index"
2041  / ;
2042   
2043  set mapCPI(cpindx,commf)   "Mapping from i to CPI index" ;
2044  mapCPI("tot",commf)              = yes ;
2045   
2046  set lb "Land bundles" /
2047     agr      "Agriculture"
2048  / ;
2049   
2050  set lb1(lb) "First land bundle" /
2051     agr      "Agriculture"
2052  / ;
2053   
2054  set maplb(lb,actf) "Mapping of activities to land bundles" /
2055       agr.agr
2056  / ;
2057   
2058  *  !!!! TO BE REVIEWED
2059   
2060  set lb0   "Default land bundles" / lb1 / ;
2061  set maplb0(lb, lb0) "Mapping of land bundles to original" /
2062     agr.lb1
2063  / ;
2064   
2065  set wbnd "Aggregate water markets" /
2066     N_A         "N_A"
2067  / ;
2068   
2069  set wbnd1(wbnd) "Top level water markets" /
2070  / ;
2071   
2072  set wbnd2(wbnd) "Second level water markets" /
2073  / ;
2074   
2075  set wbndEx(wbnd) "Exogenous water markets" /
2076  / ;
2077   
2078  set mapw1(wbnd,wbnd) "Mapping of first level water bundles" /
2079  / ;
2080   
2081  set mapw2(wbnd,actf) "Mapping of second level water bundle" /
2082  / ;
2083   
2084  set wbnda(wbnd) "Water bundles mapped one-to-one to activities" /
2085  / ;
2086   
2087  set wbndi(wbnd) "Water bundles mapped to aggregate output" /
2088  / ;
2089   
2090  set NRG "Energy bundles used in model" /
2091     coa         "Coal"
2092     oil         "Oil"
2093     gas         "Gas"
2094     ely         "Electricity"
2095  / ;
2096   
2097  set coa(NRG) "Coal bundle used in model" /
2098     coa         "Coal"
2099  / ;
2100   
2101  set oil(NRG) "Oil bundle used in model" /
2102     oil         "Oil"
2103  / ;
2104   
2105  set gas(NRG) "Gas bundle used in model" /
2106     gas         "Gas"
2107  / ;
2108   
2109  set ely(NRG) "Electricity bundle used in model" /
2110     ely         "Electricity"
2111  / ;
2112   
2113  set mape(NRG,e) "Mapping of energy commodities to energy bundles" /
2114     COA.(coa)
2115     OIL.(oil, p_c)
2116     GAS.(gas)
2117     ELY.(ely)
2118  / ;
2119   
2120  *  >>>> Sets required for 'growing' labor by skill
2121   
2122  set skl(l)  "Skill types for labor growth assumptions" /
2123     skl
2124  / ;
2125   
2126  set elev / elev0*elev3 / ;
2127   
2128  set educMap(r,l,elev) "Mapping of skills to education levels" ;
2129   
2130  *  Use GIDD definitions (i.e. "elev3" has no meaning)
2131   
2132  educMap(r,"nsk","elev0")$mapra("lmy",r) = yes ;
2133  educMap(r,"skl","elev1")$mapra("lmy",r)   = yes ;
2134  educMap(r,"skl","elev2")$mapra("lmy",r)   = yes ;
2135   
2136  educMap(r,"nsk","elev0")$mapra("hic",r) = yes ;
2137  educMap(r,"nsk","elev1")$mapra("hic",r) = yes ;
2138  educMap(r,"skl","elev2")$mapra("hic",r)   = yes ;
2139   
2141   
2142   
2144   
2146   
2153   
2154  set
2155     t(tssp)  "Modeled years"      /
2156              2014*2100
2157     /
2158     t0(t)    "First simulation year"
2159     te(t)    "Equilibrium year"   / 2100 /
2160  ;
2161   
2162  file mcsv    / macroANX1.csv / ;
2163  file msamcsv / macroSAMANX1.csv / ;
2164   
2165  parameter depr(r,t) ;
2166   
2167  *  Possible adjustments (depends on ra defined above)
2168  depr(r,t) = 0.04 ;
2169  depr(r,t)$mapra("lmy",r) = 0.05$(t.val le 2030) + 0.05$(t.val gt 2030) ;
      *  Possible additional adjustments
      depr("chn",t) = 0.06$(t.val le 2030)
                    + 0.05$(t.val gt 2030 and t.val le 2040)
                    + 0.05$(t.val gt 2040)
                    ;
2177   
2178  set mapcr(c,r) "Mapping from countries to model aggregation" ;
2179  loop((c,r,reg),
2180     mapcr(c,r)$(mapr(reg,r) and mapc(reg,c)) = yes ;
2181  ) ;
2182   
2183  set
2184     maprg(reg,r) "Mapping for missing regions 'r'"
2185  ;
2186   
2187  maprg(reg,r)$mapr(reg,r) = yes ;
2188   
2189  display mapcr, maprg ;
2190   
2192  set
2193     rx(r) "Regions not part of GTAP database" /
2194     /
2195     maprx(rx,r) "Mapping of missing regions to original GTAP region" /
2196     /
2197  ;
2199   
2200  * parameter kadj0(r) ; kadj0(r) = 1 ;
2201   
2202  Parameter kadj0(r) "Adjustment to initial K/Y ratio" ;
2203  kadj0(r) = 1 ;
2204   
2205  scalar lfpr0 / 0.75 / ;
2206  parameter lfpr(r) ; lfpr(r) = lfpr0 ;
2207   
2209   
2211   
2212  * put  "FS = ", "%system.filesys%" / ;
2213   
2219   
2224   
2225  file screen / 'con' /;
2226   
2227  put screen ;
2228  put / ;
2229   
2230  scalar ifWater / OFF / ;
2231   
2232  scalar ifPower / ON / ;
2233   
2236  scalar ifCSV / 1 / ;
2237   
2240  scalar ifAggTrade / 1 / ;
2241   
2244   
---- Begin of Active File List
Level Type         Line  Filename
---------------------------------
    0 INPUT          83  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggGTAP.gms
---- End of Active File List

---- Begin of Compile-time Variable List
Level SetVal                          Type       Text
-----------------------------------------------------
    0 basename                        SCOPED     ANX1
*   0 ifAlt                           SCOPED     ON
*   0 model                           SCOPED     Env
    0 ifCSV                           SCOPED     1
    0 ifAggTrade                      SCOPED     1
    0 OPSYS                           SCOPED     DOS
    0 console                         SCOPED     con
    0 DIAG                            GLOBAL     ON
    0 DYN                             GLOBAL     ON
    0 MACRO                           GLOBAL     ON
    0 ifPower                         GLOBAL     ON
    0 ifBKSTOP                        GLOBAL     OFF
    0 ifWater                         GLOBAL     OFF
    0 NCO2                            GLOBAL     ON
    0 ELAST                           GLOBAL     OFF
    0 LAB                             GLOBAL     ON
    0 BoP                             GLOBAL     ON
    0 LU                              GLOBAL     OFF
    0 SAVEMAP                         GLOBAL     TXT
    0 ifMRIO                          GLOBAL     OFF
    0 ifR_D                           GLOBAL     ON
    0 DEPL                            GLOBAL     ON
    0 ifGENDER                        GLOBAL     OFF
    0 OVRRIDEGTAPARM                  GLOBAL     1
    0 OVRRIDEGTAPINC                  GLOBAL     1
    0 gtpDir                          GLOBAL     ../GTAP10POW
    0 GTAPBASE                        GLOBAL     GSDF
    0 SSPFile                         GLOBAL     ../SatAcct/sspScenV9_2.gdx
    0 DEPLFile                        GLOBAL     ../SatAcct/RystadGTAP2014.gdx
    0 giddLab                         GLOBAL     ../SatAcct/giddLab.gdx
    0 giddProj                        GLOBAL     ../SatAcct/giddProj.gdx
    0 EnvElast                        GLOBAL     ../SatAcct/EnvLinkElast10APOW.gdx
    0 ifDual                          GLOBAL     1
    0 SIGMA                           GLOBAL     1.0
    0 SIGMAM                          GLOBAL     1.5
    0 OMEGA                           GLOBAL     4
    0 ETAM                            GLOBAL     inf
    0 ETAE                            GLOBAL     inf
    0 ifCSV                           GLOBAL     
    0 ifAggTrade                      GLOBAL     
---- End of Compile-time Variable List

---- Begin of Macro List
$macro AGG1(v0,v,x0,x,mapx)  v(x)     = sum(x0$mapx(x0,x), v0(x0))
$macro AGG2(v0,v,x0,x,mapx,y0,y,mapy)  v(x,y)   = sum((x0,y0)$(mapx(x0,x) and mapy(y0,y)), v0(x0,y0))
$macro AGG3(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz)  v(x,y,z) = sum((x0,y0,z0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z)), v0(x0,y0,z0))
$macro AGG4
(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz,w0,w,mapw)  v(x,y,z,w) = sum((x0,y0,z0,w0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z) and mapw(w0
                                                                                                              ,w)), v0(x0,y0,z0,w0))
$macro IFLABOR  noLab
---- End of Macro List
2246   
2247  * ------------------------------------------------------------------------------
2248  *
2249  *  Validate the aggregations
2250  *
2251  * ------------------------------------------------------------------------------
2252   
2253  parameters
2254     r0Flag(r0)
2255     rFlag(r)
2256     a0Flag(a0)
2257     aFlag(a)
2258     i0Flag(i0)
2259     iFlag(i)
2260     fpFlag(fp)
2261     fp0Flag(fp0)
2262     total
2263     work
2264     ifFirstPass    / 1 /
2265     ifCheck        / 1 /
2266     ifFirst        / 1 /
2267     order          / 0 /
2268  ;
2269   
2270  r0Flag(r0) = sum(mapr(r0,r), 1) ;
2271  loop(r0,
2272     if(r0Flag(r0) ne 1,
2273        put screen ;
2274        if(ifFirst eq 1,
2275           ifFirst = 0 ;
2276           ifCheck = 0 ;
2277           put "The following GTAP region(s) have not been mapped:" / ;
2278        ) ;
2279        put r0.tl:<10, "     ", r0.te(r0) / ;
2280     ) ;
2281  ) ;
2282   
2283  put screen ; put / ;
2284   
2285  ifFirst = 1 ;
2286  rFlag(r) = sum(mapr(r0,r), 1) ;
2287  loop(r,
2288     if(rFlag(r) eq 0,
2289        put screen ;
2290        if(ifFirst eq 1,
2291           ifFirst = 0 ;
2292           ifCheck = 0 ;
2293           put "The following aggregate region(s) have no GTAP regions mapped to them:" / ;
2294        ) ;
2295        put r.tl:<10, "     ", r.te(r) / ;
2296     ) ;
2297  ) ;
2298   
2299  ifFirst = 1 ;
2300   
2301  i0Flag(i0) = sum(mapi(i0,i), 1) ;
2302  loop(i0,
2303     if(i0Flag(i0) ne 1,
2304        put screen ;
2305        if(ifFirst eq 1,
2306           ifFirst = 0 ;
2307           ifCheck = 0 ;
2308           put "The following GTAP sector(s) have not been mapped:" / ;
2309        ) ;
2310        put i0.tl:<10, "     ", i0.te(i0) / ;
2311     ) ;
2312  ) ;
2313   
2314  put screen ; put / ;
2315   
2316  ifFirst = 1 ;
2317  iFlag(i) = sum(mapi(i0,i), 1) ;
2318  loop(i,
2319     if(iFlag(i) eq 0,
2320        put screen ;
2321        if(ifFirst eq 1,
2322           ifFirst = 0 ;
2323           ifCheck = 0 ;
2324           put "The following aggregate sector(s) have no GTAP sectors mapped to them:" / ;
2325        ) ;
2326        put i.tl:<10, "     ", i.te(i) / ;
2327     ) ;
2328  ) ;
2329   
2330  fp0Flag(fp0) = sum(mapf(fp0,fp), 1) ;
2331  loop(fp0,
2332     if(fp0Flag(fp0) lt 1,
2333        put screen ;
2334        if(ifFirst eq 1,
2335           ifFirst = 0 ;
2336           ifCheck = 0 ;
2337           put "The following GTAP factor(s) have not been mapped:" / ;
2338        ) ;
2339        put fp0.tl:<10, "     ", fp0.te(fp0) / ;
2340     ) ;
2341  ) ;
2342   
2343  put screen ; put / ;
2344   
2345  ifFirst = 1 ;
2346  fpFlag(fp) = sum(mapf(fp0,fp), 1) ;
2347  loop(fp,
2348     if(fpFlag(fp) eq 0,
2349        put screen ;
2350        if(ifFirst eq 1,
2351           ifFirst = 0 ;
2352           ifCheck = 0 ;
2353           put "The following aggregate factor(s) have no GTAP factors mapped to them:" / ;
2354        ) ;
2355        put fp.tl:<10, "     ", fp.te(fp) / ;
2356     ) ;
2357  ) ;
2358   
2359  put screen ; put / ;
2360   
2362   
2364   
2365  *  Check the mapk mappings
2366   
2367  Parameters
2368     commFlag(commf)
2369     kFlag(k)
2370  ;
2371   
2372  ifFirst = 1 ;
2373   
2374  commFlag(commf) = sum(mapk(commf,k), 1) ;
2375  loop(commf,
2376     if(commFlag(commf) ne 1,
2377        put screen ;
2378        if(ifFirst eq 1,
2379           ifFirst = 0 ;
2380           ifCheck = 0 ;
2381           put "The following commodity(ies) have not been mapped to a consumer bundle:" / ;
2382        ) ;
2383        put commf.tl:<10, "     ", commf.te(commf) / ;
2384     ) ;
2385  ) ;
2386   
2387  put screen ; put / ;
2388   
2389  ifFirst = 1 ;
2390  kFlag(k) = sum(mapk(commf,k), 1) ;
2391  loop(k,
2392     if(kFlag(k) eq 0,
2393        put screen ;
2394        if(ifFirst eq 1,
2395           ifFirst = 0 ;
2396           ifCheck = 0 ;
2397           put "The following consumer bundle(s) have no commodities mapped to them:" / ;
2398        ) ;
2399        put k.tl:<10, "     ", k.te(k) / ;
2400     ) ;
2401  ) ;
2403   
2404  *  Check the size of the residual region
2405   
2406  put screen ; put / ;
2407   
2408  if(card(rres) ne 1,
2409     ifCheck = 0 ;
2410     if(card(rres) eq 0,
2411        put "Map file doesn't contain a residual region (see subset 'rres')..." / ;
2412     elseif(card(rres) gt 1),
2413        put "There can only be one residual region (see subset 'rres'):" / ;
2414        loop(r$rres(r),
2415           put r.tl / ;
2416        ) ;
2417     ) ;
2418  ) ;
2419   
2420  abort$(ifCheck eq 0) "Invalid mapping file" ;
2421   
2422  put screen ;
2423  put "All mappings have passed standard checks..." / / ;
2424   
2425  putclose screen ;
2426   
2427  * ------------------------------------------------------------------------------
2428  *
2429  *  Save the aggregation mappings
2430  *
2431  * ------------------------------------------------------------------------------
2432   
INCLUDE    F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\saveMap.gms
2436  file mapfile / ANX1Sets.txt / ;
2438   
2439  put mapfile ;
2440  mapfile.pw=10000 ;
2441   
2442  *  Output the regional dimensions
2443   
2445   
2446  order = 0 ;
2447  loop(mapRegsort(sortOrder,r),
2448     order = order + 1 ;
2449     ifFirst = 1 ;
2451        put order:0:0, ',"', r.te(r):card(r.te), ' (', r.tl:card(r.tl),')",' ;
2453     loop(mapr(r0,r),
2454        if(ifFirst,
2456              put '"', r0.te(r0):card(r0.te), ' (', r0.tl:card(r0.tl), ')' ;
2457              ifFirst = 0 ;
2459        else
2460           put ', ', r0.te(r0):card(r0.te), ' (', r0.tl:card(r0.tl), ')' ;
2461        ) ;
2462     ) ;
2464        put '"' / ;
2466  ) ;
2467   
2469   
2470  put / ;
2471   
2472  *  Output the concordance for activities
2473   
2475   
2476  order = 0 ;
2477   
2478  scalar order ; order = 0 ;
2479  loop(mapActsort(sortOrder,actf),
2480     order = order + 1 ;
2481     ifFirst = 1 ;
2483        put order:0:0, ',"', actf.te(actf):card(actf.te), ' (', actf.tl:card(actf.tl),')",' ;
2485     loop(mapaf(a,actf),
2486        loop(mapa(a0,a),
2487           if(ifFirst,
2489                 put '"', a0.te(a0):card(a0.te), ' (', a0.tl:card(a0.tl), ')' ;
2490                 ifFirst = 0 ;
2492           else
2493              put ', ', a0.te(a0):card(a0.te), ' (', a0.tl:card(a0.tl), ')' ;
2494           ) ;
2495        ) ;
2496     ) ;
2498        put '"' / ;
2500  ) ;
2501   
2503   
2504  put / ;
2505   
2506  *  Output the concordance for commodities
2507   
2509   
2510  order = 0 ;
2511   
2512  scalar order ; order = 0 ;
2513  loop(mapCommsort(sortOrder,commf),
2514     order = order + 1 ;
2515     ifFirst = 1 ;
2517        put order:0:0, ',"', commf.te(commf):card(commf.te), ' (', commf.tl:card(commf.tl),')",' ;
2519     loop(mapif(i,commf),
2520        loop(mapi(i0,i),
2521           if(ifFirst,
2523                 put '"', i0.te(i0):card(i0.te), ' (', i0.tl:card(i0.tl), ')' ;
2524                 ifFirst = 0 ;
2526           else
2527              put ', ', i0.te(i0):card(i0.te), ' (', i0.tl:card(i0.tl), ')' ;
2528           ) ;
2529        ) ;
2530     ) ;
2532        put '"' / ;
2534  ) ;
2535   
2537  put / ;
2538   
2539  *  Output the aggregate regional dimensions
2540   
2542   
2543  alias(r,rp) ;
2544  set rra(ra) "Aggregate regions only" ;
2545  loop((r,ra)$(not sameas(r,ra)), rra(ra) = yes ; ) ;
2546   
2547  order = 0 ;
2548  loop(ra$rra(ra),
2549     order = order + 1 ;
2550     ifFirst = 1 ;
2552        put order:0:0, ',"', ra.te(ra):card(ra.te), ' (', ra.tl:card(ra.tl),')",' ;
2554     loop(rp$mapra(ra,rp),
2555        if(ifFirst,
2557              put '"', rp.te(rp):card(rp.te), ' (', rp.tl:card(rp.tl), ')' ;
2558              ifFirst = 0 ;
2560        else
2561           put ', ', rp.te(rp):card(rp.te), ' (', rp.tl:card(rp.tl), ')' ;
2562        ) ;
2563     ) ;
2565        put '"' / ;
2567  ) ;
2568   
2570   
2571  put / ;
2572   
2573  *  Output the aggregate activity dimensions
2574   
2576   
2577  order = 0 ;
2578  loop(aga,
2579     order = order + 1 ;
2580     ifFirst = 1 ;
2582        put order:0:0, ',"', aga.te(aga):card(aga.te), ' (', aga.tl:card(aga.tl),')",' ;
2584     loop(mapaga(aga,actf),
2585        if(ifFirst,
2587              put '"', actf.te(actf):card(actf.te), ' (', actf.tl:card(actf.tl), '-a)' ;
2588              ifFirst = 0 ;
2590        else
2591           put ', ', actf.te(actf):card(actf.te), ' (', actf.tl:card(actf.tl), '-a)' ;
2592        ) ;
2593     ) ;
2595        put '"' / ;
2597  ) ;
2598   
2600   
2601  put / ;
2602   
2603  *  Output the aggregate commodity dimensions
2604   
2606   
2607  order = 0 ;
2608  loop(ia,
2609     order = order + 1 ;
2610     ifFirst = 1 ;
2612        put order:0:0, ',"', ia.te(ia):card(ia.te), ' (', ia.tl:card(ia.tl),')",' ;
2614     loop(mapia(ia,commf),
2615        if(ifFirst,
2617              put '"', commf.te(commf):card(commf.te), ' (', commf.tl:card(commf.tl), '-c)' ;
2618              ifFirst = 0 ;
2620        else
2621           put ', ', commf.te(commf):card(commf.te), ' (', commf.tl:card(commf.tl), '-c)' ;
2622        ) ;
2623     ) ;
2625        put '"' / ;
2627  ) ;
2628   
2630   
2631  put / ;
2633   
2634  * ------------------------------------------------------------------------------
2635  *
2636  *  Load and aggregate land use data
2637  *
2638  * ------------------------------------------------------------------------------
2639   
2641   
2642  * ------------------------------------------------------------------------------
2643  *
2644  *  Aggregate the GTAP data
2645  *
2646  * ------------------------------------------------------------------------------
2647   
2648  parameters
2649   
2650  *  From the standard database
2651   
2652     VDFB(COMM, ACTS, REG)            "Firm purchases of domestic goods at basic prices"
2653     VDFP(COMM, ACTS, REG)            "Firm purchases of domestic goods at purchaser prices"
2654     VMFB(COMM, ACTS, REG)            "Firm purchases of imported goods at basic prices"
2655     VMFP(COMM, ACTS, REG)            "Firm purchases of domestic goods at purchaser prices"
2656     VDPB(COMM, REG)                  "Private purchases of domestic goods at basic prices"
2657     VDPP(COMM, REG)                  "Private purchases of domestic goods at purchaser prices"
2658     VMPB(COMM, REG)                  "Private purchases of imported goods at basic prices"
2659     VMPP(COMM, REG)                  "Private purchases of domestic goods at purchaser prices"
2660     VDGB(COMM, REG)                  "Government purchases of domestic goods at basic prices"
2661     VDGP(COMM, REG)                  "Government purchases of domestic goods at purchaser prices"
2662     VMGB(COMM, REG)                  "Government purchases of imported goods at basic prices"
2663     VMGP(COMM, REG)                  "Government purchases of domestic goods at purchaser prices"
2664     VDIB(COMM, REG)                  "Investment purchases of domestic goods at basic prices"
2665     VDIP(COMM, REG)                  "Investment purchases of domestic goods at purchaser prices"
2666     VMIB(COMM, REG)                  "Investment purchases of imported goods at basic prices"
2667     VMIP(COMM, REG)                  "Investment purchases of domestic goods at purchaser prices"
2668   
2669     EVFB(ENDW, ACTS, REG)            "Primary factor purchases at basic prices"
2670     EVFP(ENDW, ACTS, REG)            "Primary factor purchases at purchaser prices"
2671     EVOS(ENDW, ACTS, REG)            "Factor remuneration after income tax"
2672   
2673     VXSB(COMM, REG, REG)             "Exports at basic prices"
2674     VFOB(COMM, REG, REG)             "Exports at FOB prices"
2675     VCIF(COMM, REG, REG)             "Import at CIF prices"
2676     VMSB(COMM, REG, REG)             "Imports at basic prices"
2677   
2678     VST(MARG, REG)                   "Exports of trade and transport services"
2679     VTWR(MARG, COMM, REG, REG)       "Margins by margin commodity"
2680   
2681     SAVE(REG)                        "Net saving, by region"
2682     VDEP(REG)                        "Capital depreciation"
2683     VKB(REG)                         "Capital stock"
2684     POP(REG)                         "Population"
2685   
2686     MAKS(COMM,ACTS,REG)              "Make matrix at supply prices"
2687     MAKB(COMM,ACTS,REG)              "Make matrix at basic prices (incl taxes)"
2688     PTAX(COMM,ACTS,REG)              "Output taxes"
2689   
2690  *  Auxiliary data
2691   
2692     VOA(ACTS, REG)                   "Value of output pre-tax"
2693  ;
2694   
2695  *  Load the GTAP data base
2696   
2697  execute_load "../GTAP10POW/GSDFDAT.gdx",
2698     vdfb, vdfp, vmfb, vmfp,
2699     vdpb, vdpp, vmpb, vmpp,
2700     vdgb, vdgp, vmgb, vmgp,
2701     vdib, vdip, vmib, vmip,
2702     evfb, evfp, evos,
2703     vxsb, vfob, vcif, vmsb,
2704     vst, vtwr,
2705     save, vdep, vkb, pop,
2706     maks, makb, ptax
2707  ;
2708   
      $include "EUTRADE.gms"
      * abort "Temp" ;
2713   
2714  voa(acts,reg) = sum(comm, maks(comm,acts,reg)) ;
2715  file xpcsv / xp.csv / ;
2716  if(0,
2717     put xpcsv ;
2718     put "Region,Acts,Value" / ;
2719     xpcsv.pc=5 ;
2720     xpcsv.nd=9 ;
2721     loop((acts,reg),
2722        put reg.tl, acts.tl, voa(acts,reg) / ;
2723     ) ;
2724     abort$1 "Temporary" ;
2725  ) ;
2726  parameter
2727     gdpmp(reg)
2728  ;
2729   
2730  alias(reg,dst) ; alias(reg,src) ;
2731   
2732  file gdpcsv / gdp.csv / ;
2733  if(0,
2734     put gdpcsv ;
2735     put "Var,Reg,Value" / ;
2736     gdpcsv.pc=5 ;
2737     gdpcsv.nd=9 ;
2738     loop(reg,
2739        gdpmp(reg) = sum(comm, vdpp(comm,reg) + vmpp(comm,reg)
2740                   +           vdgp(comm,reg) + vmgp(comm,reg)
2741                   +           vdip(comm,reg) + vmip(comm,reg)
2742                   + sum(dst,  vfob(comm,reg,dst))
2743                   - sum(src,  vcif(comm,src,reg)))
2744                   + sum(marg, vst(marg,reg)) ;
2745        put "GDPMP", reg.tl, (gdpmp(reg)) / ;
2746        put "Pop",   reg.tl, (pop(reg)) / ;
2747     ) ;
2748     abort "Temp" ;
2749  ) ;
2750   
2751  *  Scale output -- takes care of advanced technologies
2752  display scaleXP ;
2753  vdfb(comm,acts,reg) = scaleXP(acts)*vdfb(comm,acts,reg) ;
2754  vdfp(comm,acts,reg) = scaleXP(acts)*vdfp(comm,acts,reg) ;
2755  vmfb(comm,acts,reg) = scaleXP(acts)*vmfb(comm,acts,reg) ;
2756  vmfp(comm,acts,reg) = scaleXP(acts)*vmfp(comm,acts,reg) ;
2757  evfb(endw,acts,reg) = scaleXP(acts)*evfb(endw,acts,reg) ;
2758  evfp(endw,acts,reg) = scaleXP(acts)*evfp(endw,acts,reg) ;
2759   
2761  file ecsv / "evfbV10AFG.csv" / ;
2762  if(0,
2763     if(1,
2764        execute_unload "evfbV10AFG.gdx", EVFB ;
2765     ) ;
2766     put ecsv ;
2767     put "Region,Factor,Activity,Value" / ;
2768     ecsv.pc=5 ;
2769     ecsv.nd=9 ;
2770     loop((reg,endw,acts),
2771        put reg.tl, endw.tl, acts.tl, evfb(endw,acts,reg) / ;
2772     ) ;
2773     Abort "TEMP" ;
2774  ) ;
2775   
2776  * ----------------------------------------------------------------------------------------
2777  *
2778  *  Declare the aggregated parameters
2779  *
2780  * ----------------------------------------------------------------------------------------
2781   
2782  alias(r,rp) ; alias(r,s) ; alias(r,d) ; alias(img,i) ; alias(a,a1) ;
2783  alias(reg,src) ; alias(reg,dst) ;
2784   
2785  parameters
2786     VDFB1(i, a, r)             "Firm purchases of domestic goods at basic prices"
2787     VDFP1(i, a, r)             "Firm purchases of domestic goods at purchaser prices"
2788     VMFB1(i, a, r)             "Firm purchases of imported goods at basic prices"
2789     VMFP1(i, a, r)             "Firm purchases of domestic goods at purchaser prices"
2790     VDPB1(i, r)                "Private purchases of domestic goods at basic prices"
2791     VDPP1(i, r)                "Private purchases of domestic goods at purchaser prices"
2792     VMPB1(i, r)                "Private purchases of imported goods at basic prices"
2793     VMPP1(i, r)                "Private purchases of domestic goods at purchaser prices"
2794     VDGB1(i, r)                "Government purchases of domestic goods at basic prices"
2795     VDGP1(i, r)                "Government purchases of domestic goods at purchaser prices"
2796     VMGB1(i, r)                "Government purchases of imported goods at basic prices"
2797     VMGP1(i, r)                "Government purchases of domestic goods at purchaser prices"
2798     VDIB1(i, r)                "Investment purchases of domestic goods at basic prices"
2799     VDIP1(i, r)                "Investment purchases of domestic goods at purchaser prices"
2800     VMIB1(i, r)                "Investment purchases of imported goods at basic prices"
2801     VMIP1(i, r)                "Investment purchases of domestic goods at purchaser prices"
2802   
2803     EVFB1(fp, a, r)            "Primary factor purchases at basic prices"
2804     EVFP1(fp, a, r)            "Primary factor purchases at purchaser prices"
2805     EVOS1(fp, a, r)            "Factor remuneration after income tax"
2806   
2807     VXSB1(i, r, r)             "Exports at basic prices"
2808     VFOB1(i, r, r)             "Exports at FOB prices"
2809     VCIF1(i, r, r)             "Import at CIF prices"
2810     VMSB1(i, r, r)             "Imports at basic prices"
2811   
2812     VST1(img, r)               "Exports of trade and transport services"
2813     VTWR1(img, i, r, r)        "Margins by margin commodity"
2814   
2815     SAVE1(r)                   "Net saving, by region"
2816     VDEP1(r)                   "Capital depreciation"
2817     VKB1(r)                    "Capital stock"
2818     POP1(r)                    "Population"
2819   
2820     MAKS1(i,a,r)               "Make matrix at supply prices"
2821     MAKB1(i,a,r)               "Make matrix at basic prices (incl taxes)"
2822     PTAX1(i,a,r)               "Output taxes"
2823   
2824  *  Auxiliary data
2825     voa1(a,r)                  "Value of output pre-tax"
2826     voi1(i,r)                  "Value of supply post-tax"
2827  ;
2828   
2829  *  Aggregate the GTAP matrices
2830   
2831  vdfb1(i,a,r) = sum((i0,a0,r0)$(mapi(i0,i) and mapa(a0,a) and mapr(r0,r)), vdfb(i0,a0,r0)) ;
2832  vdfp1(i,a,r) = sum((i0,a0,r0)$(mapi(i0,i) and mapa(a0,a) and mapr(r0,r)), vdfp(i0,a0,r0)) ;
2833  vmfb1(i,a,r) = sum((i0,a0,r0)$(mapi(i0,i) and mapa(a0,a) and mapr(r0,r)), vmfb(i0,a0,r0)) ;
2834  vmfp1(i,a,r) = sum((i0,a0,r0)$(mapi(i0,i) and mapa(a0,a) and mapr(r0,r)), vmfp(i0,a0,r0)) ;
2835   
2836  vdpb1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vdpb(i0,r0)) ;
2837  vdpp1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vdpp(i0,r0)) ;
2838  vmpb1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vmpb(i0,r0)) ;
2839  vmpp1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vmpp(i0,r0)) ;
2840   
2841  vdgb1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vdgb(i0,r0)) ;
2842  vdgp1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vdgp(i0,r0)) ;
2843  vmgb1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vmgb(i0,r0)) ;
2844  vmgp1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vmgp(i0,r0)) ;
2845   
2846  vdib1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vdib(i0,r0)) ;
2847  vdip1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vdip(i0,r0)) ;
2848  vmib1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vmib(i0,r0)) ;
2849  vmip1(i,r)   = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vmip(i0,r0)) ;
2850   
---- Begin of Active File List
Level Type         Line  Filename
---------------------------------
    0 INPUT         548  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggGTAP.gms
---- End of Active File List

---- Begin of Compile-time Variable List
Level SetVal                          Type       Text
-----------------------------------------------------
    0 basename                        SCOPED     ANX1
*   0 ifAlt                           SCOPED     ON
    0 model                           SCOPED     Env
    0 ifCSV                           SCOPED     1
    0 ifAggTrade                      SCOPED     1
    0 OPSYS                           SCOPED     DOS
    0 console                         SCOPED     con
    0 DIAG                            GLOBAL     ON
    0 DYN                             GLOBAL     ON
    0 MACRO                           GLOBAL     ON
    0 ifPower                         GLOBAL     ON
    0 ifBKSTOP                        GLOBAL     OFF
    0 ifWater                         GLOBAL     OFF
    0 NCO2                            GLOBAL     ON
    0 ELAST                           GLOBAL     OFF
    0 LAB                             GLOBAL     ON
    0 BoP                             GLOBAL     ON
    0 LU                              GLOBAL     OFF
    0 SAVEMAP                         GLOBAL     TXT
    0 ifMRIO                          GLOBAL     OFF
    0 ifR_D                           GLOBAL     ON
    0 DEPL                            GLOBAL     ON
    0 ifGENDER                        GLOBAL     OFF
    0 OVRRIDEGTAPARM                  GLOBAL     1
    0 OVRRIDEGTAPINC                  GLOBAL     1
    0 gtpDir                          GLOBAL     ../GTAP10POW
    0 GTAPBASE                        GLOBAL     GSDF
    0 SSPFile                         GLOBAL     ../SatAcct/sspScenV9_2.gdx
    0 DEPLFile                        GLOBAL     ../SatAcct/RystadGTAP2014.gdx
    0 giddLab                         GLOBAL     ../SatAcct/giddLab.gdx
    0 giddProj                        GLOBAL     ../SatAcct/giddProj.gdx
    0 EnvElast                        GLOBAL     ../SatAcct/EnvLinkElast10APOW.gdx
    0 ifDual                          GLOBAL     1
    0 SIGMA                           GLOBAL     1.0
    0 SIGMAM                          GLOBAL     1.5
    0 OMEGA                           GLOBAL     4
    0 ETAM                            GLOBAL     inf
    0 ETAE                            GLOBAL     inf
    0 ifCSV                           GLOBAL     
    0 ifAggTrade                      GLOBAL     
    0 VER                             GLOBAL     V10AFG
---- End of Compile-time Variable List

---- Begin of Macro List
$macro AGG1(v0,v,x0,x,mapx)  v(x)     = sum(x0$mapx(x0,x), v0(x0))
$macro AGG2(v0,v,x0,x,mapx,y0,y,mapy)  v(x,y)   = sum((x0,y0)$(mapx(x0,x) and mapy(y0,y)), v0(x0,y0))
$macro AGG3(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz)  v(x,y,z) = sum((x0,y0,z0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z)), v0(x0,y0,z0))
$macro AGG4
(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz,w0,w,mapw)  v(x,y,z,w) = sum((x0,y0,z0,w0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z) and mapw(w0
                                                                                                              ,w)), v0(x0,y0,z0,w0))
$macro IFLABOR  noLab
---- End of Macro List
2852   
2853  put screen ; put / ;
2856        evfb1(fp,a,r) = sum((fp0,a0,r0)$(mapf(fp0,fp) and mapa(a0,a) and mapr(r0,r)), evfb(fp0,a0,r0)) ;
2857        evfp1(fp,a,r) = sum((fp0,a0,r0)$(mapf(fp0,fp) and mapa(a0,a) and mapr(r0,r)), evfp(fp0,a0,r0)) ;
2858        evos1(fp,a,r) = sum((fp0,a0,r0)$(mapf(fp0,fp) and mapa(a0,a) and mapr(r0,r)), evos(fp0,a0,r0)) ;
2861  *  !!!!!!!! There are issues with the LU database--natlres label and no EVOA for natural resources
2862  * display evos1 ; abort "Temp" ;
2863   
2864  *  Deal with the backstops
2865   
2867   
2868  *!!!! Special treatment for the GENDER database
2869   
2871   
2872  VXSB1(i,r,rp) = sum((i0,r0,rp0)$(mapi(i0,i) and mapr(r0,r) and mapr(rp0,rp)), VXSB(i0,r0,rp0)) ;
2873  VFOB1(i,r,rp) = sum((i0,r0,rp0)$(mapi(i0,i) and mapr(r0,r) and mapr(rp0,rp)), VFOB(i0,r0,rp0)) ;
2874  VCIF1(i,r,rp) = sum((i0,r0,rp0)$(mapi(i0,i) and mapr(r0,r) and mapr(rp0,rp)), VCIF(i0,r0,rp0)) ;
2875  VMSB1(i,r,rp) = sum((i0,r0,rp0)$(mapi(i0,i) and mapr(r0,r) and mapr(rp0,rp)), VMSB(i0,r0,rp0)) ;
2876   
2877  VST1(img,r)   = sum((img0,r0)$(mapi(img0,img) and mapr(r0,r)), VST(img0,r0)) ;
2878   
2879  VTWR1(img,i,r,rp) = sum((img0,i0,r0,rp0)$(mapi(img0,img) and mapi(i0,i) and mapr(r0,r) and mapr(rp0,rp)), VTWR(img0,i0,r0,rp0)
      ) ;
2880   
2881  SAVE1(r)     = sum(r0$mapr(r0,r), SAVE(r0)) ;
2882  VDEP1(r)     = sum(r0$mapr(r0,r), VDEP(r0)) ;
2883  VKB1(r)     = sum(r0$mapr(r0,r), VKB(r0)) ;
2884  POP1(r)     = sum(r0$mapr(r0,r), POP(r0)) ;
2885   
2886  maks1(i,a,r) = sum((i0,a0,r0)$(mapi(i0,i) and mapa(a0,a) and mapr(r0,r)), maks(i0,a0,r0)) ;
2887  makb1(i,a,r) = sum((i0,a0,r0)$(mapi(i0,i) and mapa(a0,a) and mapr(r0,r)), makb(i0,a0,r0)) ;
2888  ptax1(i,a,r) = sum((i0,a0,r0)$(mapi(i0,i) and mapa(a0,a) and mapr(r0,r)), ptax(i0,a0,r0)) ;
2889   
2890  voa1(a,r) = sum(i, maks1(i,a,r)) ;
2891  voi1(i,r) = sum(a, makb1(i,a,r)) ;
2892   
2893  *  Move land to capital
2894   
2895  loop((cap,lnd,a)$mapt(a),
2896     evfp1(cap,a,r) = evfp1(cap,a,r) + evfp1(lnd,a,r) ;
2897     evfp1(lnd,a,r) = 0 ;
2898     evfb1(cap,a,r) = evfb1(cap,a,r) + evfb1(lnd,a,r) ;
2899     evfb1(lnd,a,r) = 0 ;
2900     evos1(cap,a,r) = evos1(cap,a,r) + evos1(lnd,a,r) ;
2901     evos1(lnd,a,r) = 0 ;
2902  ) ;
2903   
2904   
2905  *  Move natural resource to capital
2906   
2907  loop((cap,nrs,a)$mapn(a),
2908     evfp1(cap,a,r) = evfp1(cap,a,r) + evfp1(nrs,a,r) ;
2909     evfp1(nrs,a,r) = 0 ;
2910     evfb1(cap,a,r) = evfb1(cap,a,r) + evfb1(nrs,a,r) ;
2911     evfb1(nrs,a,r) = 0 ;
2912     evos1(cap,a,r) = evos1(cap,a,r) + evos1(nrs,a,r) ;
2913     evos1(nrs,a,r) = 0 ;
2914  ) ;
2915   
2916  *  Save the data
2917   
2918  execute_unload "ANX1/agg/ANX1Dat.gdx",
2919   
2920     vdfb1=vdfb, vdfp1=vdfp, vmfb1=vmfb, vmfp1=vmfp,
2921     vdpb1=vdpb, vdpp1=vdpp, vmpb1=vmpb, vmpp1=vmpp,
2922     vdgb1=vdgb, vdgp1=vdgp, vmgb1=vmgb, vmgp1=vmgp,
2923     vdib1=vdib, vdip1=vdip, vmib1=vmib, vmip1=vmip,
2924     evfb1=evfb, evfp1=evfp, evos1=evos,
2925     vxsb1=vxsb, vfob1=vfob, vcif1=vcif, vmsb1=vmsb,
2926     vst1=vst,   vtwr1=vtwr,
2927     save1=save, vdep1=vdep,
2928     vkb1=vkb,   pop1=pop,
2929     maks1=maks, makb1=makb, ptax1=ptax
2930  ;
2931   
2932  *  Save the NIPA accounts for dis-aggregated and aggregated database
2933  *  Save energy subsidies as well
2934   
2935  *$include "nipa.gms"
2936   
2937  *  Save the SAM if requested
2938   
2939  file csv / "ANX1/agg/ANX1Agg.csv" / ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggsam.gms
2941  if(1,
2942     put csv ;
2943     if(ifFirstPass,
2944        put "SAMLabel,Var,Region,RowLabel,ColLabel,Value" / ;
2945        csv.pc=5 ;
2946        csv.nd=9 ;
2947        ifFirstPass = 0 ;
2948     ) ;
2949   
2950  *  Production accounts
2951   
2952     loop((r,a),
2953        loop(i,
2954           put "AggGTAP", "SAM", r.tl, i.tl, a.tl, (vdfb1(i,a,r)+vmfb1(i,a,r)) / ;
2955        ) ;
2956        put "AggGTAP", "SAM", r.tl, "itax", a.tl, (sum(i,vdfp1(i,a,r)+vmfp1(i,a,r)-vdfb1(i,a,r)-vmfb1(i,a,r))) / ;
2957   
2958        loop(fp,
2959           put "AggGTAP", "SAM", r.tl, fp.tl, a.tl,(evfb1(fp,a,r)) / ;
2960        ) ;
2961        put "AggGTAP", "SAM", r.tl, "vtax", a.tl, (sum(fp,evfp1(fp,a,r) - evfb1(fp,a,r))) / ;
2962     ) ;
2963   
2964  *  Commodity supply
2965   
2966     loop((r,i),
2967        put "AggGTAP", "SAM", r.tl, "ptax", i.tl, (sum(a, ptax1(i,a,r))) / ;
2968        put "AggGTAP", "SAM", r.tl, "etax", i.tl, (sum(d, vfob1(i,r,d) - vxsb1(i,r,d))) / ;
2969        put "AggGTAP", "SAM", r.tl, "mtax", i.tl, (sum(s, vmsb1(i,s,r) - vcif1(i,s,r))) / ;
2970     ) ;
2971   
2972     loop(r,
2973        if(ifAggTrade,
2974           loop(i,
2975              put "AggGTAP", "SAM", r.tl, "BoP",  i.tl, (sum(s, vcif1(i,s,r))) / ;
2976           ) ;
2977        else
2978           loop(s,
2979              loop(i,
2980                 put "AggGTAP", "SAM", r.tl, s.tl,  i.tl, vcif1(i,s,r) / ;
2981              ) ;
2982              put "AggGTAP", "SAM", r.tl, "BoP",  s.tl, (sum(i, vcif1(i,s,r))) / ;
2983           ) ;
2984        ) ;
2985     ) ;
2986   
2987  *  Income distribution
2988   
2989     loop((r,fp),
2990        put "AggGTAP", "SAM", r.tl, "dtax", fp.tl, (sum(a, evfb1(fp,a,r)-evos1(fp,a,r))) / ;
2991        put "AggGTAP", "SAM", r.tl, "REGY",   fp.tl, (sum(a, evos1(fp,a,r))) / ;
2992     ) ;
2993   
2994     loop(r,
2995        put "AggGTAP", "SAM", r.tl, "REGY", "itax", (
2996  *        Production
2997           sum((i,a), vdfp1(i,a,r)+vmfp1(i,a,r)-vdfb1(i,a,r)-vmfb1(i,a,r))
2998  *        Private consumption
2999           + sum(i, vdpp1(i,r)+vmpp1(i,r)-vdpb1(i,r)-vmpb1(i,r))
3000  *        Public consumption
3001           + sum(i, vdgp1(i,r)+vmgp1(i,r)-vdgb1(i,r)-vmgb1(i,r))
3002  *        Investment
3003           + sum(i, vdip1(i,r)+vmip1(i,r)-vdib1(i,r)-vmib1(i,r))
3004        ) / ;
3005        put "AggGTAP", "SAM", r.tl, "REGY", "vtax", (sum((fp,a), evfp1(fp,a,r) - evfb1(fp,a,r))) / ;
3006        put "AggGTAP", "SAM", r.tl, "REGY", "ptax", (sum((i,a), ptax1(i,a,r))) / ;
3007        put "AggGTAP", "SAM", r.tl, "REGY", "etax", (sum((i,d), vfob1(i,r,d) - vxsb1(i,r,d))) / ;
3008        put "AggGTAP", "SAM", r.tl, "REGY", "mtax", (sum((i,s), vmsb1(i,s,r) - vcif1(i,s,r))) / ;
3009        put "AggGTAP", "SAM", r.tl, "REGY", "dtax", (sum(fp, sum(a, evfb1(fp,a,r) - evos1(fp,a,r)))) / ;
3010        put "AggGTAP", "SAM", r.tl, "DEPR", "REGY", (vdep1(r)) / ;
3011   
3012        put "AggGTAP", "SAM", r.tl, "PRIV", "REGY", (sum(i, vdpp1(i,r)+vmpp1(i,r))) / ;
3013        put "AggGTAP", "SAM", r.tl, "GOV",  "REGY", (sum(i, vdgp1(i,r)+vmgp1(i,r))) / ;
3014        put "AggGTAP", "SAM", r.tl, "INV",  "REGY", (save1(r)) / ;
3015     ) ;
3016   
3017  *  Domestic absorption
3018   
3019     loop((r,i),
3020        put "AggGTAP", "SAM", r.tl, i.tl, "PRIV", (vdpb1(i,r)+vmpb1(i,r)) / ;
3021        put "AggGTAP", "SAM", r.tl, i.tl, "GOV",  (vdgb1(i,r)+vmgb1(i,r)) / ;
3022        put "AggGTAP", "SAM", r.tl, i.tl, "INV",  (vdib1(i,r)+vmib1(i,r)) / ;
3023     ) ;
3024     loop(r,
3025        put "AggGTAP", "SAM", r.tl, "itax", "PRIV", (sum(i, vdpp1(i,r)+vmpp1(i,r)-vdpb1(i,r)-vmpb1(i,r))) / ;
3026        put "AggGTAP", "SAM", r.tl, "itax", "GOV",  (sum(i, vdgp1(i,r)+vmgp1(i,r)-vdgb1(i,r)-vmgb1(i,r))) / ;
3027        put "AggGTAP", "SAM", r.tl, "itax", "INV",  (sum(i, vdip1(i,r)+vmip1(i,r)-vdib1(i,r)-vmib1(i,r))) / ;
3028     ) ;
3029   
3030  *  Exports
3031   
3032     loop((r,img),
3033        put "AggGTAP", "SAM", r.tl, img.tl, "ITT",  (vst1(img,r)) / ;
3034     ) ;
3035     if(ifAggTrade,
3036        loop((r,i),
3037           put "AggGTAP", "SAM", r.tl, i.tl, "BOP",  (sum(d, vfob1(i,r,d))) / ;
3038        ) ;
3039     else
3040        loop((r,i,d),
3041           put "AggGTAP", "SAM", r.tl, i.tl, d.tl,  vfob1(i,r,d) / ;
3042        ) ;
3043        loop((r,d),
3044           put "AggGTAP", "SAM", r.tl, d.tl, "BOP",  (sum(i, vfob1(i,r,d))) / ;
3045        ) ;
3046     ) ;
3047   
3048  *  Closure
3049   
3050     loop(r,
3051        put "AggGTAP", "SAM", r.tl, "INV", "DEPR",  (vdep1(r)) / ;
3052        put "AggGTAP", "SAM", r.tl, "ITT", "BOP", (sum(img, vst1(img,r))) / ;
3053        put "AggGTAP", "SAM", r.tl, "INV", "BOP", (sum((i,s), vcif1(i,s,r) - vfob1(i,r,s)) - sum(img, vst1(img,r))) / ;
3054     ) ;
3055   
3056  *  Miscellaneous
3057   
3058     loop(r,
3059        put "AggGTAP", "MACRO", r.tl, "VKB", "", (VKB1(r)) / ;
3060        put "AggGTAP", "MACRO", r.tl, "POP", "", (POP1(r)) / ;
3061     ) ;
3062  ) ;
3063   
3064  * ------------------------------------------------------------------------------
3065  *
3066  *  Aggregate the GTAP parameters
3067  *
3068  * ------------------------------------------------------------------------------
3069   
3070  * ------------------------------------------------------------------------------
3071  *
3072  *  Aggregate GTAP parameters
3073  *
3074  * ------------------------------------------------------------------------------
3075   
3076  *  GTAP parameters
3077   
3078  parameters
3079     ESUBT(ACTS,REG)         "Top level production elasticity"
3080     ESUBC(ACTS,REG)         "Elasticity across intermedate inputs"
3081     ESUBVA(ACTS,REG)        "Inter-factor substitution elasticity"
3082     ETRAQ(ACTS,REG)         "CET make elasticity"
3083     ESUBQ(COMM,REG)         "CES make elasticity"
3084     INCPAR(COMM, REG)       "CDE expansion parameter"
3085     SUBPAR(COMM, REG)       "CDE substitution parameter"
3086     ESUBG(REG)              "CES government expenditure elasticity"
3087     ESUBI(REG)              "CES investment expenditure elasticity"
3088     ESUBD(COMM,REG)         "Top level Armington elasticity"
3089     ESUBM(COMM,REG)         "Second level Armington elasticity"
3090     ESUBS(MARG)             "CES margin elasticity"
3091     ETRAE(ENDW,REG)         "CET transformation elasticities for factors"
3092     RORFLEX(REG)            "Flexibility of expected net ROR wrt investment"
3093  ;
3094   
3095  *  Load the data
3096   
3097  execute_load "../GTAP10POW/GSDFpar.gdx",
3098     ESUBT, ESUBC, ESUBVA, ETRAQ, ESUBQ,
3099     INCPAR, SUBPAR, ESUBG, ESUBI,
3100     ESUBD, ESUBM, ESUBS, ETRAE, RORFLEX
3101  ;
3102   
3103  *  Aggregate to intermediate levels
3104   
3105  parameters
3106     ESUBT1(a,r)          "Top level production elasticity"
3107     ESUBC1(a,r)          "Elasticity across intermedate inputs"
3108     ESUBVA1(a,r)         "Inter-factor substitution elasticity"
3109  *  USER SUPPLIED
3110  *  ETRAQ1(a,r)          "CET make elasticity"
3111  *  ESUBQ1(i,r)          "CES make elasticity"
3112     INCPAR1(i,r)         "CDE expansion parameter"
3113     SUBPAR1(i,r)         "CDE substitution parameter"
3114  *  USER SUPPLIED
3115  *  ESUBG1(r)            "CES government expenditure elasticity"
3116  *  ESUBI1(r)            "CES investment expenditure elasticity"
3117     ESUBD1(i,r)          "Top level Armington elasticity"
3118     ESUBM1(i,r)          "Second level Armington elasticity"
3119  *  USER SUPPLIED
3120     ESUBS1(img)          "CES margin elasticity"
3121     RORFLEX1(r)          "Flexibility of expected net ROR wrt investment"
3122  ;
3123   
3124  *  Aggregate the data
3125   
3126  *  ESUBT -- use regional output as weight
3127   
3128  esubt1(a,r) = sum(a0$mapa(a0,a), sum(reg$mapr(reg,r), voa(a0, reg))) ;
3129  esubt1(a,r)$esubt1(a,r) = sum(a0$mapa(a0,a),
3130        sum(reg$mapr(reg,r), voa(a0, reg)*ESUBT(a0,reg))) / esubt1(a,r) ;
3131   
3132  *  ESUBC -- use regional intermediate demand at purchasers' prices as weight
3133   
3134  esubc1(a,r) = sum(a0$mapa(a0,a), sum((reg,i0)$mapr(reg,r), (vdfp(i0,a0,reg)+vmfp(i0,a0,reg)))) ;
3135  esubc1(a,r)$esubc1(a,r) = sum(a0$mapa(a0,a), sum((reg,i0)$mapr(reg,r),
3136        (vdfp(i0,a0,reg)+vmfp(i0,a0,reg))*ESUBC(a0,reg))) / esubc1(a,r) ;
3137   
3138  *  ESUBVA -- use regional value added at agents' prices as weight
3139   
3140  esubva1(a,r) = sum(a0$mapa(a0,a), sum((reg,fp0)$mapr(reg,r), evfp(fp0, a0, reg))) ;
3141  esubva1(a,r)$esubva1(a,r) = sum(a0$mapa(a0,a),
3142        sum((reg,fp0)$mapr(reg,r), evfp(fp0, a0, reg)*ESUBVA(a0,reg))) / esubva1(a,r) ;
3143   
3144  *  INCPAR, SUBPAR -- Use regional private demand at agents' prices
3145   
3146  incpar1(i,r) = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), vdpp(i0,r0) + vmpp(i0,r0)) ;
3147  subpar1(i,r) = incpar1(i,r) ;
3148  incpar1(i,r)$incpar1(i,r)
3149            = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), INCPAR(i0,r0)*(vdpp(i0,r0) + vmpp(i0,r0)))
3150            / incpar1(i,r) ;
3151  subpar1(i,r)$subpar1(i,r)
3152            = sum((i0,r0)$(mapi(i0,i) and mapr(r0,r)), SUBPAR(i0,r0)*(vdpp(i0,r0) + vmpp(i0,r0)))
3153            / subpar1(i,r) ;
3154   
3155  *  ESUBD -- Use regional aggregate Armington demand
3156   
3157  esubd1(i,r) = sum(i0$mapi(i0,i), sum(reg$mapr(reg,r),
3158                 sum(a0, vdfp(i0,a0,reg) + vmfp(i0,a0,reg))
3159            +            vdpp(i0,reg) + vmpp(i0,reg)
3160            +            vdgp(i0,reg) + vmgp(i0,reg)
3161            +            vdip(i0,reg) + vmip(i0,reg)
3162                 )) ;
3163  esubd1(i,r)$esubd1(i,r)
3164            = sum(i0$mapi(i0,i), sum(reg$mapr(reg,r), ESUBD(i0,reg)*(
3165                 sum(a0, vdfp(i0,a0,reg) + vmfp(i0,a0,reg))
3166            +            vdpp(i0,reg) + vmpp(i0,reg)
3167            +            vdgp(i0,reg) + vmgp(i0,reg)
3168            +            vdip(i0,reg) + vmip(i0,reg))))
3169            / esubd1(i,r) ;
3170   
3171  *  ESUBM -- Use regional aggregate import demand
3172   
3173  esubm1(i,r) = sum(i0$mapi(i0,i), sum(reg$mapr(reg,r),
3174              +  sum(a0, vmfp(i0,a0,reg))
3175              +          vmpp(i0,reg)
3176              +          vmgp(i0,reg)
3177              +          vmip(i0,reg))) ;
3178  esubm1(i,r)$esubm1(i,r)
3179              = sum(i0$mapi(i0,i), sum(reg$mapr(reg,r), ESUBM(i0,reg)*(
3180              +  sum(a0, vmfp(i0,a0,reg))
3181              +          vmpp(i0,reg)
3182              +          vmgp(i0,reg)
3183              +          vmip(i0,reg))))
3184              / esubm1(i,r) ;
3185   
3186  *  RORFLEX -- Use regional level of capital stock
3187   
3188  RORFLEX1(r) = sum(r0$mapr(r0,r), vkb(r0)) ;
3189  RORFLEX1(r)$RORFLEX1(r) =sum(r0$mapr(r0,r), RORFLEX(r0)*vkb(r0)) / RORFLEX1(r) ;
3190   
3191  *  Save the data
3192   
3193  execute_unload "ANX1/agg/ANX1Par.gdx",
3194     ESUBT1=ESUBT, ESUBC1=ESUBC, ESUBVA1=ESUBVA, ETRAQ1=ETRAQ, ESUBQ1=ESUBQ,
3195     INCPAR1=INCPAR, SUBPAR1=SUBPAR, ESUBG1=ESUBG, ESUBI1=ESUBI,
3196     ESUBD1=ESUBD, ESUBM1=ESUBM, ESUBS1=ESUBS, ETRAE1=ETRAE, RORFLEX1=RORFLEX
3197  ;
3198   
3199  * ------------------------------------------------------------------------------
3200  *
3201  *  Aggregate energy data
3202  *
3203  * ------------------------------------------------------------------------------
3204   
3205  *  Energy matrices
3206   
3207  parameters
3208     EDF(ERG, ACTS, REG)     "Usage of domestic products by firm"
3209     EMF(ERG, ACTS, REG)     "Usage of imported products by firm"
3210     EDP(ERG,REG)            "Private consumption of domestic goods"
3211     EMP(ERG,REG)            "Private consumption of imported goods"
3212     EDG(ERG,REG)            "Public consumption of domestic goods"
3213     EMG(ERG,REG)            "Public consumption of imported goods"
3214     EDI(ERG,REG)            "Investment consumption of domestic goods"
3215     EMI(ERG,REG)            "Investment consumption of imported goods"
3216     EXI(ERG, REG, REG)      "Bilateral trade in energy"
3217  ;
3218   
3219  execute_load "../GTAP10POW/GSDFvole.gdx",
3220     EDF, EMF, EDP, EMP, EDG, EMG, EDI, EMI, EXI
3221  ;
3222   
3223  parameters
3224     EDF1(i, a, r)           "Usage of domestic products by firm"
3225     EMF1(i, a, r)           "Usage of imported products by firm"
3226     EDP1(i, r)              "Private consumption of domestic goods"
3227     EMP1(i, r)              "Private consumption of imported goods"
3228     EDG1(i, r)              "Public consumption of domestic goods"
3229     EMG1(i, r)              "Public consumption of imported goods"
3230     EDI1(i, r)              "Investment consumption of domestic goods"
3231     EMI1(i, r)              "Investment consumption of imported goods"
3232     EXI1(i, r, rp)          "Bilateral trade in energy"
3233  ;
3234   
3235  edf1(i,a,r) = sum((ERG,a0,r0)$(mapi(ERG,i) and mapa(a0,a) and mapr(r0,r)), edf(ERG,a0,r0)) ;
3236  emf1(i,a,r) = sum((ERG,a0,r0)$(mapi(ERG,i) and mapa(a0,a) and mapr(r0,r)), emf(ERG,a0,r0)) ;
3237  edp1(i,r)   = sum((ERG,r0)$(mapi(ERG,i) and mapr(r0,r)), edp(ERG,r0)) ;
3238  emp1(i,r)   = sum((ERG,r0)$(mapi(ERG,i) and mapr(r0,r)), emp(ERG,r0)) ;
3239  edg1(i,r)   = sum((ERG,r0)$(mapi(ERG,i) and mapr(r0,r)), edg(ERG,r0)) ;
3240  emg1(i,r)   = sum((ERG,r0)$(mapi(ERG,i) and mapr(r0,r)), emg(ERG,r0)) ;
3241  edi1(i,r)   = sum((ERG,r0)$(mapi(ERG,i) and mapr(r0,r)), edi(ERG,r0)) ;
3242  emi1(i,r)   = sum((ERG,r0)$(mapi(ERG,i) and mapr(r0,r)), emi(ERG,r0)) ;
3243  exi1(i,r,rp) = sum((ERG,r0,rp0)$(mapi(ERG,i) and mapr(r0,r) and mapr(rp0,rp)), exi(ERG,r0,rp0)) ;
3244   
3245  edf1(i,a,r)$(voi1(i,r) = 0)  = 0 ;
3246  edp1(i,r)$(voi1(i,r) = 0)    = 0 ;
3247  edg1(i,r)$(voi1(i,r) = 0)    = 0 ;
3248  exi1(i,r,rp)$(voi1(i,r) = 0) = 0 ;
3249   
3250  *  Save the data
3251   
3252  execute_unload  "ANX1/agg/ANX1Vole.gdx",
3253     EDF1=EDF, EMF1=EMF,
3254     EDP1=EDP, EMP1=EMP,
3255     EDG1=EDG, EMG1=EMG,
3256     EDI1=EDI, EMI1=EMI,
3257     EXI1=EXI
3258  ;
3259   
3260  * ------------------------------------------------------------------------------
3261  *
3262  *  Aggregate CO2 emissions data
3263  *
3264  * ------------------------------------------------------------------------------
3265   
3266  *  CO2 Emission matrices
3267   
3268  parameters
3269     MDF(FUEL, ACTS, REG)          "Emissions from domestic product in current production, .."
3270     MMF(FUEL, ACTS, REG)          "Emissions from imported product in current production, .."
3271     MDP(FUEL, REG)                "Emissions from private consumption of domestic product, Mt CO2"
3272     MMP(FUEL, REG)                "Emissions from private consumption of imported product, Mt CO2"
3273     MDG(FUEL, REG)                "Emissions from govt consumption of domestic product, Mt CO2"
3274     MMG(FUEL, REG)                "Emissions from govt consumption of imported product, Mt CO2"
3275     MDI(FUEL, REG)                "Emissions from invt consumption of domestic product, Mt CO2"
3276     MMI(FUEL, REG)                "Emissions from invt consumption of imported product, Mt CO2"
3277  ;
3278   
3279  execute_load "../GTAP10POW/GSDFemiss.gdx",
3280     MDF, MMF, MDP, MMP, MDG, MMG, MDI, MMI
3281  ;
3282   
3283  parameters
3284     MDF1(i, a, r)         "Emissions from domestic product in current production, .."
3285     MMF1(i, a, r)         "Emissions from imported product in current production, .."
3286     MDP1(i, r)            "Emissions from private consumption of domestic product, Mt CO2"
3287     MMP1(i, r)            "Emissions from private consumption of imported product, Mt CO2"
3288     MDG1(i, r)            "Emissions from govt consumption of domestic product, Mt CO2"
3289     MMG1(i, r)            "Emissions from govt consumption of imported product, Mt CO2"
3290     MDI1(i, r)            "Emissions from invt consumption of domestic product, Mt CO2"
3291     MMI1(i, r)            "Emissions from invt consumption of imported product, Mt CO2"
3292  ;
3293   
3294  mdf1(i,a,r) = sum((fuel,a0,r0)$(mapi(fuel,i) and mapa(a0,a) and mapr(r0,r)), mdf(fuel,a0,r0)) ;
3295  mmf1(i,a,r) = sum((fuel,a0,r0)$(mapi(fuel,i) and mapa(a0,a) and mapr(r0,r)), mmf(fuel,a0,r0)) ;
3296  mdp1(i,r)   = sum((fuel,r0)$(mapi(fuel,i) and mapr(r0,r)), mdp(fuel,r0)) ;
3297  mmp1(i,r)   = sum((fuel,r0)$(mapi(fuel,i) and mapr(r0,r)), mmp(fuel,r0)) ;
3298  mdg1(i,r)   = sum((fuel,r0)$(mapi(fuel,i) and mapr(r0,r)), mdg(fuel,r0)) ;
3299  mmg1(i,r)   = sum((fuel,r0)$(mapi(fuel,i) and mapr(r0,r)), mmg(fuel,r0)) ;
3300  mdi1(i,r)   = sum((fuel,r0)$(mapi(fuel,i) and mapr(r0,r)), mdi(fuel,r0)) ;
3301  mmi1(i,r)   = sum((fuel,r0)$(mapi(fuel,i) and mapr(r0,r)), mmi(fuel,r0)) ;
3302   
3303  *  Save the data
3304   
3305  execute_unload  "ANX1/agg/ANX1Emiss.gdx",
3306     MDF1=MDF, MMF1=MMF, MDP1=MDP, MMP1=MMP, MDG1=MDG, MMG1=MMG, MDI1=MDI, MMI1=MMI
3307  ;
3308   
3309  * -------------------------------------------------------------------------------
3310  *
3311   
3312  *  Calculate the energy content of fossil fuel consumption
3313  *
3314  *  THIS IS A QUICK FIX AND NEEDS REVIEW
3315   
3316  parameters
3317     eaf(e0,a0,r0)     "Armington energy consumption by firms"
3318     phiNRG(f0,a0,r0)  "Rate of burning of fossil fuels"
3319     nrgCOMB(f0,a0,r0) "Energy combusted"
3320     nrgCOMB1(i,a,r)   "Aggregated combusted energy"
3321  ;
3322   
3323  *  Convert to c_mtoe
3324   
3325  co2_mtoe(f0) = co2_mtoe(f0)*12/44 ;
3326   
3327  *  Total energy
3328  eaf(e0,a0,r0) = edf(e0,a0,r0) + emf(e0,a0,r0) ;
3329   
3330  *  Calculate combustion based on the standard emissions coefficient
3331  nrgCOMB(f0,a0,r0) = ((mdf(f0,a0,r0)+mmf(f0,a0,r0))/co2_mtoe(f0))$(etr0(f0) and atr0(a0))
3332                    +  eaf(f0,a0,r0)$(not (etr0(f0) and atr0(a0))) ;
3333   
3334  *  Cap combustion to actual energy consumption
3335  nrgCOMB(f0,a0,r0) = eaf(f0,a0,r0)$(nrgCOMB(f0,a0,r0) > eaf(f0,a0,r0))
3336                    + nrgCOMB(f0,a0,r0)$(nrgCOMB(f0,a0,r0) <= eaf(f0,a0,r0))
3337                    ;
3338   
3339  *  Aggregate
3340  nrgCOMB1(i,a,r) = sum((r0,f0,a0)$(mapr(r0,r) and mapi(f0,i) and mapa(a0,a)), nrgCOMB(f0,a0,r0)) ;
3341   
      file xcsv / nrgComb.csv / ;
      put xcsv ;
      put "Var,Region,Input,Activity,Value" / ;
      xcsv.pc=5 ;
      xcsv.nd=9 ;
       
      loop((f0,i0,r0),
         put "MDF",r0.tl,f0.tl,i0.tl,mdf(f0,i0,r0) / ;
         put "MMF",r0.tl,f0.tl,i0.tl,mmf(f0,i0,r0) / ;
         put "EDF",r0.tl,f0.tl,i0.tl,edf(f0,i0,r0) / ;
         put "EMF",r0.tl,f0.tl,i0.tl,emf(f0,i0,r0) / ;
         put "EAF",r0.tl,f0.tl,i0.tl,eaf(f0,i0,r0) / ;
         put "nrgComb",r0.tl,f0.tl,i0.tl,nrgComb(f0,i0,r0) / ;
      ) ;
      loop((i,a,r),
         put "MDF1",r.tl,i.tl,a.tl,mdf1(i,a,r) / ;
         put "MMF1",r.tl,i.tl,a.tl,mmf1(i,a,r) / ;
         put "EDF1",r.tl,i.tl,a.tl,edf1(i,a,r) / ;
         put "EMF1",r.tl,i.tl,a.tl,emf1(i,a,r) / ;
      ) ;
      loop((i,a,r),
         put "nrgComb1",r.tl,i.tl,a.tl,nrgComb1(i,a,r) / ;
      ) ;
       
      putclose xcsv ;
3369   
3370  * ------------------------------------------------------------------------------
3371  *
3372  *  Load and aggregate satellite accounts if requested
3373  *
3374  * ------------------------------------------------------------------------------
3375   
3377   
3378  * ------------------------------------------------------------------------------
3379  *
3380  *  Aggregate non-CO2 emissions data
3381  *
3382  * ------------------------------------------------------------------------------
3383   
3384  *  Mostly NON-CO2 emission matrices
3385   
3386  sets
3387     LU       "Land use categories"
3388     LUType   "Land use sub-categories"
3389     AR       "IPCC Assessment Reports"
3390  ;
3391   
GDXIN   F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\../GTAP10POW/GSDFnco2.gdx
--- LOAD  LU = 10:LU
--- LOAD  LUType = 11:LUType
--- LOAD  AR = 1:AR
3394   
3395  parameters
3396     EMI_IO(EM, COMM, ACTS, REG)         "IO-based emissions in Mmt"
3397     EMI_IOP(EM, COMM, ACTS, REG)        "IO-based process emissions in Mmt"
3398     EMI_ENDW(EM, ENDW, ACTS, REG)       "Endowment-based emissions in Mmt"
3399     EMI_QO(EM, ACTS, REG)               "Output-based emissions in Mmt"
3400     EMI_HH(EM, COMM, REG)               "Private consumption-based emissions in Mmt"
3401     EMI_LU(GHG,LU,LUType,REG)           "Land-use based emissions"
3402     GWP(ghg, reg, ar)                   "Global warming potential"
3403  ;
3404   
3405  *  Load the data
3406   
3407  execute_loaddc "../GTAP10POW/GSDFnco2.gdx",
3408     EMI_IO, EMI_IOP, EMI_ENDW, EMI_QO, EMI_HH, EMI_LU, GWP ;
3409  ;
3410   
3411  parameters
3412     EMI_IO1(EM, i, a, r)          "IO-based emissions in Mmt"
3413     EMI_IOP1(EM, i, a, r)         "IO-based process emissions in Mmt"
3414     EMI_ENDW1(EM, fp, a, r)       "Endowment-based emissions in Mmt"
3415     EMI_QO1(EM, a, r)             "Output-based emissions in Mmt"
3416     EMI_HH1(EM, i, r)             "Private consumption-based emissions in Mmt"
3417     EMI_LU1(GHG,LU,LUType,r)      "Land-use based emissions"
3418     GWP1(ghg, r, ar)              "Global warming potential"
3419  ;
3420   
3421  file prcsv / procEmi.csv / ;
3422  if(0,
3423     put prcsv ;
3424     prcsv.pc=5 ;
3425     prcsv.nd=10 ;
3426     if(0,
3427        put "GHG,Activity,Value" / ;
3428        loop((ghg,acts),
3429           put ghg.tl, acts.tl, (sum(reg, gwp(ghg,reg,"AR4")*(sum(comm, emi_iop(ghg,comm,acts,reg))
3430              + sum(endw, EMI_ENDW(ghg,endw,acts,reg))
3431              + emi_qo(ghg,acts,reg)))) / ;
3432        ) ;
3433     else
3434        put '' ; loop(ghg, put ghg.tl ; ) put / ;
3435        loop(acts,
3436           put acts.tl ;
3437           loop(ghg,
3438              put (sum(reg, gwp(ghg,reg,"AR4")*(sum(comm, emi_iop(ghg,comm,acts,reg))
3439                    + sum(endw, EMI_ENDW(ghg,endw,acts,reg))
3440                    + emi_qo(ghg,acts,reg)))) ;
3441           ) ;
3442           put / ;
3443        ) ;
3444     ) ;
3445   
3446     abort "Temp" ;
3447  ) ;
3448   
3449  *  Aggregate the data
3450   
3451  EMI_IO1(EM, i, a, r)
3452     =sum((mapi(comm,i), mapa(acts,a), mapr(reg,r)), EMI_IO(EM, COMM, ACTS, REG)) ;
3453   
3454  EMI_IOP1(EM, i, a, r)
3455     =sum((mapi(comm,i), mapa(acts,a), mapr(reg,r)), EMI_IOP(EM, COMM, ACTS, REG)) ;
3456   
3457  EMI_ENDW1(EM, fp, a, r)
3458     =sum((mapf(ENDW,fp), mapa(acts,a), mapr(reg,r)), EMI_ENDW(EM, ENDW, ACTS, REG)) ;
3459   
3460  EMI_QO1(EM, a, r)
3461     =sum((mapa(acts,a), mapr(reg,r)), EMI_QO(EM, ACTS, REG)) ;
3462   
3463  display emi_qo1, emi_qo ;
3464   
3465  EMI_HH1(EM, i, r)
3466     =sum((mapi(comm,i), mapr(reg,r)), EMI_HH(EM, COMM, REG)) ;
3467   
3468  EMI_LU1(GHG,LU,LUType,r)
3469     =sum((mapr(reg,r)), EMI_LU(GHG,LU,LUType,REG)) ;
3470   
3471  *  !!!! Should we add LU emissions?
3472   
3473  GWP1(ghg,r,ar) = sum(mapr(REG,R),
3474       sum((COMM, ACTS), EMI_IO(GHG, COMM, ACTS, REG) + EMI_IOP(GHG, COMM, ACTS, REG))
3475     + sum((ENDW, ACTS), EMI_ENDW(GHG, ENDW, ACTS, REG))
3476     + sum((ACTS), EMI_QO(GHG, ACTS, REG))
3477     + sum((COMM), EMI_HH(GHG, COMM, REG))) ;
3478   
3479  GWP1(ghg,r,ar) = (sum(mapr(REG,R), GWP(ghg,REG,ar)*(
3480       sum((COMM, ACTS), EMI_IO(GHG, COMM, ACTS, REG) + EMI_IOP(GHG, COMM, ACTS, REG))
3481     + sum((ENDW, ACTS), EMI_ENDW(GHG, ENDW, ACTS, REG))
3482     + sum((ACTS), EMI_QO(GHG, ACTS, REG))
3483     + sum((COMM), EMI_HH(GHG, COMM, REG)))) / GWP1(ghg,r,ar))$GWP1(ghg,r,ar)
3484  *  IF THERE ARE NO EMISSIONS
3485     + (sum(mapr(REG,R), GWP(ghg,REG,ar)) / sum(mapr(REG,R), 1))$(GWP1(ghg,r,ar) eq 0)
3486     ;
3487   
3488  *  Save the data
3489   
3490  execute_unload "ANX1/agg/ANX1NCO2.gdx",
3491     ar, i=comm, fp=endw, a=acts, r=reg, em, emn, ghg, nghg, lu, luType,
3492     gwp1=GWP, emi_IO1=emi_IO, emi_IOP1=emi_IOP,
3493     emi_ENDW1=emi_ENDW, emi_QO1=emi_QO, emi_HH1=emi_HH, emi_LU1=emi_LU ;
3494  ;
3495   
3496  *  Save the energy and emissions data to the CSV file if requested
3497   
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggNRG.gms
3499  if(1,
3500     put csv ;
3501   
3502  *  Production
3503   
3504     loop((r,a),
3505        loop(i$(edf1(i,a,r) + emf1(i,a,r)),
3506           put "AggGTAP", "NRG", r.tl, i.tl, a.tl, (edf1(i,a,r) + emf1(i,a,r)) / ;
3507        ) ;
3508        loop(i$(mdf1(i,a,r) + mmf1(i,a,r)),
3509           put "AggGTAP", "CO2", r.tl, i.tl, a.tl, (mdf1(i,a,r) + mmf1(i,a,r)) / ;
3510        ) ;
3511        loop(i$(mdf1(i,a,r) + mmf1(i,a,r)),
3512           put "AggGTAP", "CO2_CEQ", r.tl, i.tl, a.tl, (GWP1("CO2",r,"AR5")*(mdf1(i,a,r) + mmf1(i,a,r))) / ;
3513        ) ;
3514   
3516           loop(em,
3517              loop(i$(EMI_IO1(EM, i, a, r)),
3518                 put "AggGTAP", em.tl, r.tl, i.tl, a.tl, (EMI_IO1(EM, i, a, r)) / ;
3519              ) ;
3520              loop(i$(EMI_IOP1(EM, i, a, r)),
3521                 csv.pc=2 ; put '"AggGTAP","', em.tl:card(em.tl),'_PR"' ; csv.pc=5 ;
3522                 put r.tl, i.tl, a.tl, (EMI_IOP1(EM, i, a, r)) / ;
3523              ) ;
3524              loop(fp$(EMI_ENDW1(EM, fp, a, r)),
3525                 put "AggGTAP", em.tl, r.tl, fp.tl, a.tl, (EMI_ENDW1(EM, fp, a, r)) / ;
3526              ) ;
3527              put$(EMI_QO1(EM, a, r)) "AggGTAP", em.tl, r.tl, "qo", a.tl, (EMI_QO1(EM, a, r)) / ;
3528           ) ;
3529   
3530  *        Output same in CO2eq
3531   
3532           loop(GHG,
3533              loop(i$(EMI_IO1(GHG, i, a, r)),
3534                 csv.pc=2 ; put '"AggGTAP","', GHG.tl:card(ghg.tl),'_CEQ"' ; csv.pc=5 ;
3535                 put r.tl, i.tl, a.tl, (GWP1(GHG,r,"AR5")*EMI_IO1(GHG, i, a, r)) / ;
3536              ) ;
3537              loop(i$(EMI_IOP1(GHG, i, a, r)),
3538                 csv.pc=2 ; put '"AggGTAP","', GHG.tl:card(ghg.tl),'_PR_CEQ"' ; csv.pc=5 ;
3539                 put r.tl, i.tl, a.tl, (GWP1(GHG,r,"AR5")*EMI_IOP1(GHG, i, a, r)) / ;
3540              ) ;
3541              loop(fp$(EMI_ENDW1(GHG, fp, a, r)),
3542                 csv.pc=2 ; put '"AggGTAP","', GHG.tl:card(ghg.tl),'_CEQ"' ; csv.pc=5 ;
3543                 put r.tl, fp.tl, a.tl, (GWP1(GHG,r,"AR5")*EMI_ENDW1(GHG, fp, a, r)) / ;
3544              ) ;
3545              csv.pc=2 ; put '"AggGTAP","', GHG.tl:card(ghg.tl),'_CEQ"' ; csv.pc=5 ;
3546              put r.tl, "qo", a.tl, (GWP1(GHG,r,"AR5")*EMI_QO1(GHG, a, r)) / ;
3547           ) ;
3549     ) ;
3550   
3551  *  Final demand
3552   
3553     loop(r,
3554        loop(i$(edp1(i,r) + emp1(i,r)),
3555           put "AggGTAP", "NRG", r.tl, i.tl, "PRIV", (edp1(i,r) + emp1(i,r)) / ;
3556        ) ;
3557        loop(i$(mdp1(i,r) + mmp1(i,r)),
3558           put "AggGTAP", "CO2", r.tl, i.tl, "PRIV", (mdp1(i,r) + mmp1(i,r)) / ;
3559        ) ;
3560        loop(i$(mdp1(i,r) + mmp1(i,r)),
3561           put "AggGTAP", "CO2_CEQ", r.tl, i.tl, "PRIV", (GWP1("CO2",r,"AR5")*(mdp1(i,r) + mmp1(i,r))) / ;
3562        ) ;
3563   
3565           loop(em,
3566              loop(i$EMI_HH1(em, i, r),
3567                 put "AggGTAP", em.tl, r.tl, i.tl, "PRIV", (EMI_HH1(em, i, r)) / ;
3568              ) ;
3569           ) ;
3570   
3571  *        Output same in CO2eq
3572   
3573           loop(ghg,
3574              loop(i$EMI_HH1(GHG, i, r),
3575                 csv.pc=2 ; put '"AggGTAP","', GHG.tl:card(ghg.tl),'_CEQ"' ; csv.pc=5 ;
3576                 put r.tl, i.tl, "PRIV", (GWP1(GHG,r,"AR5")*EMI_HH1(GHG, i, r)) / ;
3577              ) ;
3578           ) ;
3580   
3581        loop(i$(edg1(i,r) + emg1(i,r)),
3582           put "AggGTAP", "NRG", r.tl, i.tl, "GOV", (edg1(i,r) + emg1(i,r)) / ;
3583        ) ;
3584        loop(i$(mdg1(i,r) + mmg1(i,r)),
3585           put "AggGTAP", "CO2", r.tl, i.tl, "GOV", (mdg1(i,r) + mmg1(i,r)) / ;
3586        ) ;
3587        loop(i$(edi1(i,r) + emi1(i,r)),
3588           put "AggGTAP", "NRG", r.tl, i.tl, "INV", (edi1(i,r) + emi1(i,r)) / ;
3589        ) ;
3590        loop(i$(mdi1(i,r) + mmi1(i,r)),
3591           put "AggGTAP", "CO2", r.tl, i.tl, "INV", (mdi1(i,r) + mmi1(i,r)) / ;
3592        ) ;
3593   
3594     ) ;
3595   
3596  *  Exports
3597   
3598     if(ifAggTrade,
3599        loop((r,i)$(sum(rp, EXI1(i,r,rp))),
3600           put "AggGTAP", "NRG", r.tl, i.tl, "BOP",  (sum(rp, EXI1(i,r,rp))) / ;
3601        ) ;
3602     else
3603        loop((r,i,rp)$(EXI1(i,r,rp)),
3604           put "AggGTAP", "NRG", r.tl, i.tl, rp.tl,  EXI1(i,r,rp) / ;
3605        ) ;
3606     ) ;
3607  ) ;
3608   
3610   
3612   
3613  * ------------------------------------------------------------------------------
3614  *
3615  *  Additional BoP accounts -- from GMiG and GDyn
3616  *
3617  * ------------------------------------------------------------------------------
3618   
3619  parameters
3620     remit(lab,reg,reg)   "Initial remittances"
3621     yqtf(reg)            "Initial outflow of capital income"
3622     yqht(reg)            "Initial inflow of capital income"
3623     ODAIn(reg)           "Initial ODA inflows"
3624     ODAOut(reg)          "Initial ODA outflows"
3625  ;
3626   
3627  parameters
3628     remit1(l,s,d)        "Initial remittances"
3629     yqtf1(r)             "Initial outflow of capital income"
3630     yqht1(r)             "Initial inflow of capital income"
3631     ODAIn1(r)            "Initial ODA inflows"
3632     ODAOut1(r)           "Initial ODA outflows"
3633  ;
3634   
3635  *  Remittances and flow of profits
3636   
3638     execute_load "../GTAP10POW/GSDFBOP.gdx", remit, yqtf, yqht, ODAIn, ODAOut ;
3639   
3640     remit1(l,s,d) = sum((lab,r0,rp0)$(mapf(lab,l) and mapr(r0,s) and mapr(rp0,d)), remit(lab,r0,rp0)) ;
3641     yqtf1(r)     = sum(r0$mapr(r0,r), yqtf(r0)) ;
3642     yqht1(r)     = sum(r0$mapr(r0,r), yqht(r0)) ;
3643     ODAIn1(r)     = sum(r0$mapr(r0,r), ODAIn(r0)) ;
3644     ODAOut1(r)     = sum(r0$mapr(r0,r), ODAOut(r0)) ;
3646   
3647  execute_unload "ANX1/agg/ANX1BoP.gdx",
3648     REMIT1=REMIT, YQTF1=YQTF, YQHT1=YQHT, ODAIn1=ODAIn, ODAOut1=ODAOut ;
3649   
3651   
3653   
3655   
3656  parameters
3657   
3658  *  Input data from ILO
3659   
3660     labvol(lab,acts,reg)    "Labor volumes in millions"
3661     wageILO(lab, acts, reg) "Wages imputed from ILO"
3662   
3663  *  Labor/VA (from GIDD)
3664   
3665     emplg(lg, acts, reg)    "Labor volumes emanating from GIDD"
3666     evfbg(lg, acts, reg)    "Labor value added at basic prices emanating from GIDD"
3667     evfpg(lg, acts, reg)    "Labor value added at purchasers prices emanating from GIDD"
3668     empl2014(reg, lg)       "Aging of GIDD volumes"
3669   
3670     evfbg1(l, a, r)         "Labor value added at basic prices emanating from GIDD"
3671     evfpg1(l, a, r)         "Labor value added at purchasers prices emanating from GIDD"
3672     emplg1(l, a, r)         "GIDD employment data"
3673   
3674     premg0(l, a, r)         "Base wage premium"
3675     wageBar(l, r)           "Base avg. wage"
3676     labShr(l, a, r)         "Labor share share of GIDD"
3677     tlabg(l, r)             "Total labor"
3678   
3679  *  Output vectors
3680   
3681     empl1(l, a, r)         "Employment data in person years"
3682     wage1(l, a, r)         "Imputed wages"
3683     emplz(l,z,r)           "Total employment by zone"
3684  ;
3685   
3686  file wcsv / wages.csv / ;
3687   
3688  if(noLab = noLab,
3689   
3690  *  Just set wages to 1 and employment to evfb1
3691   
3692     empl1(l,a,r) = evfb1(l,a,r) ;
3693   
3694  elseif(noLab = agLab),
3695   
3696  *  Read the labor volumes and do a two-sector aggregation
3697   
3698     execute_load "../GTAP10POW//GSDFWages.gdx" labvol=q, wageILO=w ;
3699     if(0,
3700        put wcsv ;
3701        put "Region,Variable,Skill,Sector,Value" / ;
3702        wcsv.pc=5 ;
3703        wcsv.nd=9 ;
3704        loop((lab,acts,reg),
3705           put reg.tl, "LabVol", lab.tl, acts.tl, labvol(lab,acts,reg) / ;
3706           put reg.tl, "Wage", lab.tl, acts.tl, wageILO(lab,acts,reg) / ;
3707           put reg.tl, "VFM", lab.tl, acts.tl, evfb(lab,acts,reg) / ;
3708        ) ;
3709     ) ;
3710   
3711     loop(z$(not sameas(z,"nsg")),
3712   
3713  *     Employment equals remuneration divided by average wage by zone
3714   
3715  *     Total employment in zone z
3716        emplz(l,z,r) = sum(a$mapz(z,a),
3717           sum((lab, a0, r0)$(mapf(lab,l) and mapa(a0,a) and mapr(r0,r)), labvol(lab,a0,r0))) ;
3718        display emplz ;
3719  *     Average wage in zone z (Total remuneration in z divided by total employment in z)
3720        emplz(l,z,r)$emplz(l,z,r) = sum(a$mapz(z,a), evfb1(l,a,r)) /  emplz(l,z,r) ;
3721        display emplz ;
3722  *     And thus employment by activity
3723        empl1(l,a,r)$(mapz(z,a) and emplz(l,z,r)) = evfb1(l,a,r)/emplz(l,z,r) ;
3724        display empl1 ;
3725     ) ;
3726   
3727  elseif(noLab = allLab),
3728   
3729  *  Read the labor volumes and make wages fully sector-specific
3730   
3731     execute_load "../GTAP10POW//GSDFWages.gdx" labvol=q ;
3732   
3733     empl1(l,a,r) = sum((lab,a0,r0)$(mapf(lab,l) and mapa(a0,a) and mapr(r0,r)), labvol(lab,a0,r0)) ;
3734   
3735  elseif(noLab = giddLab),
3736   
3738  *     Read the GIDD data
3739  *     !!!! THIS SECTION NEEDS WORK -- FOR EXAMPLE IF USING ALL 5 LABOR SKILLS IN GTAP, re-balancing, etc.
3740   
3741        execute_load "../SatAcct/giddLab.gdx"  evfbg=vfmg, evfpg=evfag, emplg=empl ;
3742   
3743  *     !!!! NEED TO REBALANCE EVFB AND EMPL
3744   
3745        evfbg1(l,a,r) = sum((lg,a0,r0)$(maplGIDD(lg,l) and mapa(a0,a) and mapr(r0,r)), evfbg(lg,a0,r0)) ;
3746        evfpg1(l,a,r) = sum((lg,a0,r0)$(maplGIDD(lg,l) and mapa(a0,a) and mapr(r0,r)), evfpg(lg,a0,r0)) ;
3747        emplg1(l,a,r) = sum((lg,a0,r0)$(maplGIDD(lg,l) and mapa(a0,a) and mapr(r0,r)), emplg(lg,a0,r0)) ;
3748   
3749        if(ver eq 10,
3750   
3751  *        This is a temporary fix to wages and volumes to re-base 2011 to 2014
3752   
3753  *        Calculate wage premium from the GIDD (calibrated to GTAP v9)
3754   
3755           wageBar(l,r)   = sum(a, evfpg1(l,a,r)) / sum(a, emplg1(l,a,r)) ;
3756           premg0(l,a,r)$emplg1(l,a,r) = (evfpg1(l,a,r)/emplg1(l,a,r)) / wageBar(l,r) ;
3757   
3758  *        Get projected labor volumes
3759   
3760           execute_load "../SatAcct/GIDDV10.gdx", empl2014 ;
3761   
3762  *        display empl2014 ;
3763   
3764  *        Aggregate projected labor volumes
3765   
3766           tlabg(l, r) = sum((r0,lg)$(mapr(r0,r) and maplGIDD(lg,l)), empl2014(r0, lg)) ;
3767   
3768  *        Calculate labor value shares
3769   
3770           labshr(l,a,r) = evfb1(l,a,r) / sum(a1, evfb1(l,a1,r)) ;
3771   
3772  *        display premg0, labshr, tlabg ;
3773   
3774  *        Calulate employment consistent with new employment level and assuming
3775  *        'old' wage premia
3776   
3777           empl1(l,a,r)$premg0(l,a,r) = tlabg(l, r)
3778                        * (labshr(l, a, r)/premg0(l,a,r))
3779                        / sum(a1$premg0(l,a1,r), labshr(l,a1,r)/premg0(l,a1,r)) ;
3780        else
3781   
3782           empl1(l,a,r) = emplg1(l,a,r) ;
3783        ) ;
3784   
3786   
3787  *  Re-scale labor
3788   
3789     empl1(l,a,r) = 1*empl1(l,a,r) ;
3790   
3791  ) ;
3792   
      file xxx / gidd.csv / ;
      if(0,
         put xxx ;
         put "Var,Lab,Act,Reg,Value" / ;
         xxx.pc=5 ;
         xxx.nd=9 ;
         loop((l,a,r),
            put "Empl",  l.tl, a.tl, r.tl, empl1(l,a,r) / ;
            put "EmplG", l.tl, a.tl, r.tl, emplg1(l,a,r) / ;
            put "EVFB",  l.tl, a.tl, r.tl, evfb1(l,a,r) / ;
            put "EVFP",  l.tl, a.tl, r.tl, evfp1(l,a,r) / ;
            put "EVFBG",  l.tl, a.tl, r.tl, evfbg1(l,a,r) / ;
            put "EVFPG",  l.tl, a.tl, r.tl, evfpg1(l,a,r) / ;
            put "PREMG0", l.tl, a.tl, r.tl, premg0(l,a,r) / ;
         ) ;
         abort "Temp" ;
      ) ;
3812   
3813  wage1(l,a,r)$empl1(l,a,r) = evfb1(l,a,r) / empl1(l,a,r) ;
3814  empl1(l,a,r) = 1e6*empl1(l,a,r) ;
3815   
3816  execute_unload "ANX1/agg/ANX1Wages.gdx",
3817     EMPL1=q, wage1=wage ;
3818   
3820   
3821  * ------------------------------------------------------------------------------
3822  *
3823  *  Deal with water volumes
3824  *
3825  * ------------------------------------------------------------------------------
3826   
3827  Parameter
3828  *  Water data
3829     h2ocrp(reg, i0)            "Water withdrawal for activities"
3830     h2oUse(wbnd0, reg)         "Water withdrawal for aggregate uses"
3831     h2ocrp1(a, r)              "Water withdrawal for activities"
3832     h2oUse1(wbnd0, r)          "Water withdrawal for aggregate uses"
3833  ;
3834   
3836   
3837  h2oCrp1(a,r)      = 0 ;
3838  h2oUse1(wbnd0, r) = 0 ;
3839   
3841   
3842  execute_unload "ANX1/agg/ANX1Sat.gdx"
3843     nrgComb1=nrgComb, h2ocrp1=h2ocrp, h2ouse1=h2ouse
3844  ;
3845   
3846  * ------------------------------------------------------------------------------
3847  *
3848  *  Aggregate the MRIO database
3849  *
3850  * ------------------------------------------------------------------------------
3851   
3853   
3854  * ------------------------------------------------------------------------------
3855  *
3856  *  Load and aggregate land use data
3857  *
3858  * ------------------------------------------------------------------------------
3859   
3861   
3862  * ------------------------------------------------------------------------------
3863  *
3864  *  Load and aggregate the fossil fuel reserve data
3865  *
3866  * ------------------------------------------------------------------------------
3867   
3869   
3870  sets
3871     ri0               "Rystad production sectors" /
3872                          OIL   "Crude Oil"
3873                          CND   "Condensate"
3874                          RFG   "Refinery gains"
3875                          XLQ   "Other liquids"
3876                          GAS   "Natural gas"
3877                          NGL   "NGL"
3878                          IGS   "Injected gas--unsold"
3879                          FGS   "Flared gas--unsold"
3880                       /
3881     ffl(i0)           / coa, oil, gas /
3882     mapRysp(ffl,ri0)  "Mapping from GTAP FFL to Rystad production types" /
3883                          oil.(oil,cnd,rfg,xlq)
3884                          gas.(gas,ngl,igs,fgs)
3885                       /
3886     rf0               "Resource types" /
3887                          ABD   "Abandoned"
3888                          PRD   "Producing"
3889                          UDV   "Under development"
3890                          DSC   "Discovery"
3891                          YTD   "Undiscovered, or yet-to-find"
3892                       /
3893     resType           "Reserve type"       / res, ytd /
3894     mapRysr(resType,rf0) /
3895                          res.(abd, prd, udv, dsc)
3896                          ytd.(ytd)
3897                       /
3898     s0                "Rystad scenarios"   / hi, lo, mid, std /
3899     pt                "Envisage scenarios" / hi, lo, mid, ref /
3900     mappt(s0,pt)      "Scenario mapping"   / (hi.hi), (lo.lo), (mid.mid), (std.ref) /
3901  ;
3902   
3903  parameters
3904     RysProd(reg,ri0)        "Production in KB/D"
3905     RysRes(reg,ri0,s0,rf0)  "Rystad reserves in MB"
3906     r_p_coa0(reg)           "Resource to production ratio for coal"
3907   
3908     extraction(r,a)         "Base year production from reserves in MTOE"
3909     reserves(r,a,pt)        "Proven reserves in MTOE"
3910     ytdreserves(r,a,pt)     "Unproven reserves in MTOE"
3911     r_p(r,a,pt)             "Base year reserve to production ratio"
3912  ;
3913   
3914  *  Load the data
3915   
3917   
3918  execute_loaddc "../SatAcct/RystadGTAP2014.gdx", RysProd=xp1, RysRes=Res1, r_p_coa0 ;
3919   
3920  set eu Energy units /
3921     toe      Tons of oil equivalent
3922     mtoe     Millions of tons of oil equivalent
3923     tj       Terajoules
3924     ej       Exajoules
3925     cal      Calories
3926     gCal     Giga calories
3927     kwh      Kilowatt hour
3928     mWh      Megawatt hour
3929     gWh      Gigawatt hour
3930     mBTU     Million BTU
3931     mbd      Million barrels of oil equivalent per day
3932     mb       Million barrels of oil equivalent
3933     bcm      Billion cubic meters
3934     mt       Million tons of coal equivalent
3935  /
3936   
3937  alias(eu, eup) ;
3938   
3939  Table emat(eu, eup) Energy conversion matrix
3940   
3941  *         TO:
3942                      TOE           MTOE             TJ              EJ            CAL            kWh            mWh            
      gWh          mBTU            gCal           mbd            mb              bcm             mt
3943  *  FROM:    multiply by:
3944     TOE   1.00000000E+00 1.00000000E-06 4.18680000E-02  4.18680000E-08 1.00000000E+10 1.16309304E+04 1.16309304E+01 1.16309304E
      -02 3.96815468E+01 1.00000000E+01 2.09000000E-08 7.62850000E-06  1.21170000E-06 1.98140000E-06
3945     MTOE  1.00000000E+06 1.00000000E+00 4.18680000E+04  4.18680000E-02 1.00000000E+16 1.16309304E+10 1.16309304E+07 1.16309304E
      +04 3.96815468E+07 1.00000000E+07 2.09000000E-02 7.62850000E+00  1.21170000E+00 1.98140000E+00
3946     TJ    2.38845897E+01 2.38845897E-05 1.00000000E+00  1.00000000E-06 2.38845897E+11 2.77800000E+05 2.77800000E+02 2.77800000E
      -01 9.47777462E+02 2.38845897E+02 4.99187924E-07 1.82203592E-04  2.89409573E-05 4.73249260E-05
3947     EJ    2.38845897E+07 2.38845897E+01 1.00000000E+06  1.00000000E+00 2.38845897E+17 2.77800000E+11 2.77800000E+08 2.77800000E
      +05 9.47777462E+08 2.38845897E+08 4.99187924E-01 1.82203592E+02  2.89409573E+01 4.73249260E+01
3948     CAL   1.00000000E-10 1.00000000E-16 4.18680000E-12  4.18680000E-18 1.00000000E+00 1.16309304E-06 1.16309304E-09 1.16309304E
      -12 3.96815468E-09 1.00000000E-09 2.09000000E-18 7.62850000E-16  1.21170000E-16 1.98140000E-16
3949     kWh   8.59776446E-05 8.59776446E-11 3.59971202E-06  3.59971202E-12 8.59776446E+05 1.00000000E+00 1.00000000E-03 1.00000000E
      -06 3.41172592E-03 8.59776446E-04 1.79693277E-12 6.55880461E-10  1.04179112E-10 1.70356105E-10
3950     mWh   8.59776446E-02 8.59776446E-08 3.59971202E-03  3.59971202E-09 8.59776446E+08 1.00000000E+03 1.00000000E+00 1.00000000E
      -03 3.41172592E+00 8.59776446E-01 1.79693277E-09 6.55880461E-07  1.04179112E-07 1.70356105E-07
3951     gWh   8.59776446E+01 8.59776446E-05 3.59971202E+00  3.59971202E-06 8.59776446E+11 1.00000000E+06 1.00000000E+03 1.00000000E
      +00 3.41172592E+03 8.59776446E+02 1.79693277E-06 6.55880461E-04  1.04179112E-04 1.70356105E-04
3952     mBTU  2.52006306E-02 2.52006306E-08 1.05510000E-03  1.05510000E-09 2.52006306E+08 2.93106780E+02 2.93106780E-01 2.93106780E
      -04 1.00000000E+00 2.52006306E-01 5.26693179E-10 1.92243010E-07  3.05356040E-08 4.99325294E-08
3953     Gcal  1.00000000E-01 1.00000000E-07 4.18680000E-03  4.18680000E-09 1.00000000E+09 1.16309304E+03 1.16309304E+00 1.16309304E
      -03 3.96815468E+00 1.00000000E+00 2.09000000E-09 7.62850000E-07  1.21170000E-07 1.98140000E-07
3954     mbd   4.78468900E+07 4.78468900E+01 2.00325359E+06  2.00325359E+00 4.78468900E+17 5.56503847E+11 5.56503847E+08 5.56503847E
      +05 1.89863860E+09 4.78468900E+08 1.00000000E+00 3.65000000E+02  5.79760766E+01 9.48038278E+01
3955     mb    1.31087370E+05 1.31087370E-01 5.48836600E+03  5.48836600E-03 1.31087370E+15 1.52466807E+09 1.52466807E+06 1.52466807E
      +03 5.20174959E+06 1.31087370E+06 2.73972603E-03 1.00000000E+00  1.58838566E-01 2.59736515E-01
3956     bcm   8.25286787E+05 8.25286787E-01 3.45531072E+04  3.45531072E-02 8.25286787E+15 9.59885318E+09 9.59885318E+06 9.59885318E
      +03 3.27486562E+07 8.25286787E+06 1.72484939E-02 6.29570027E+00  1.00000000E+00 1.63522324E+00
3957     mt    5.04693651E+05 5.04693651E-01 2.11305138E+04  2.11305138E-02 5.04693651E+15 5.87005673E+09 5.87005673E+06 5.87005673E
      +03 2.00270247E+07 5.04693651E+06 1.05480973E-02 3.85005551E+00  6.11537297E-01 1.00000000E+00
3958  ;
3959   
3960  *  Convert the data to MTOE
3961   
3962  RysProd(reg,ri0)       = RysProd(reg,ri0)*0.001*emat("mbd","MTOE") ;
3963  RysRes(reg,ri0,s0,rf0) = RysRes(reg,ri0,s0,rf0)*emat("MB", "MTOE") ;
3964   
3965  file dcsv / Rystad.csv / ;
3966  if(0,
3967     put dcsv ;
3968     put "Var,Region,Fuel,Scenario,Type,Value" / ;
3969     dcsv.pc=5 ;
3970     dcsv.nd=9 ;
3971     loop((reg,ffl),
3972        put "Production", reg.tl, ffl.tl, "", "", sum(mapRysp(ffl,ri0), RysProd(reg,ri0)) / ;
3973        loop((s0,restype),
3974           put "Reserves", reg.tl, ffl.tl, s0.tl, resType.tl,
3975              sum(mapRysp(ffl,ri0), sum(mapRysr(resType,rf0),RysRes(reg,ri0,s0,rf0))) / ;
3976        ) ;
3977     ) ;
3978     Abort "Temp" ;
3979  ) ;
3980   
3981  loop(mapa(ffl,a),
3982     extraction(r,a)     = sum(mapr(reg,r), sum(mapRysp(ffl,ri0), RysProd(reg,ri0))) ;
3983     reserves(r,a,pt)    = sum(mapr(reg,r), sum(mapRysp(ffl,ri0), sum(mappt(s0,pt), sum(rf0$(not sameas(rf0, "YTD")), RysRes(reg
      ,ri0,s0,rf0))))) ;
3984     ytdreserves(r,a,pt) = sum(mapr(reg,r), sum(mapRysp(ffl,ri0), sum(mappt(s0,pt), sum(rf0$(sameas(rf0, "YTD")), RysRes(reg,ri0
      ,s0,rf0))))) ;
3985  ) ;
3986   
3987  *  !!!! Assumes 1 to 1 mapping between ffl, i0 and a
3988   
3989  loop(mapa(ffl,a),
3990   
3991     if(sameas(ffl,"coa"),
3992   
3993        r_p(r,a,pt) = sum(mapr(reg,r), voa(ffl, reg)) ;
3994        r_p(r,a,pt)$r_p(r,a,pt) = sum(mapr(reg,r), voa(ffl,reg)*r_p_coa0(reg))/r_p(r,a,pt) ;
3995   
3996     else
3997   
3998        r_p(r,a,pt)$extraction(r,a) = reserves(r,a,pt)/extraction(r,a) ;
3999   
4000     ) ;
4001  ) ;
4002   
4003  display extraction, reserves, ytdreserves, r_p ;
4004  execute_unload "ANX1/Fnl/ANX1Depl.gdx" extraction, reserves, ytdreserves, r_p ;
4005   
4007   
4009   
4010  file cmap / ANX1CMap.txt / ;
4011  if(0,
4012   
4013  *  Save the regional mappings
4014   
4015     put cmap ;
4016   
4017     put 'set c "World economies" /' / ;
4018     loop(c,
4019        put '   ', c.tl:<8, '"', c.te(c), '"' / ;
4020     ) ;
4021     put "/ ;" / / ;
4022   
4023     put 'set r0 "GTAP Regions" /' / ;
4024     loop(r0,
4025        put '   ', r0.tl:<8, '"', r0.te(r0), '"' / ;
4026     ) ;
4027     put "/ ;" / / ;
4028   
4029     put 'set r "Project Regions" /' / ;
4030     loop(r,
4031        put '   ', r.tl:<8, '"', r.te(r), '"' / ;
4032     ) ;
4033     put "/ ;" / / ;
4034   
4035     put 'set cMap(r,c) "Mapping of countries to project regions / ' / ;
4036     loop((r,r0,c)$(mapr(r0,r) and mapc(r0,c)),
4037        put "   ", r.tl:<15, ".", c.tl / ;
4038     ) ;
4039     put "/ ;" / / ;
4040   
4041     put 'set rMap(r,r0) "Mapping of GTAP regions to project regions / ' / ;
4042     loop((r,r0)$mapr(r0,r),
4043        put "   ", r.tl:<15, ".", r0.tl / ;
4044     ) ;
4045     put "/ ;" / / ;
4046  ) ;
4047   
4048  * ------------------------------------------------------------------------------
4049  *
4050  *  Aggregate the dynamic scenarios
4051  *
4052  * ------------------------------------------------------------------------------
4053   
4054  sets GHGCodes ;
4055   
4056  Parameters
4057     tPop(scen, c, tranche, tssp)
4058     popScen(scen, c, sex, tranche, ed, tssp)
4059     gdpScen(mod, ssp, var, c, tssp)
4060     popHist(c, tranche, th)
4061     ghghist(ghgcodes,c,th)
4062     tpop1(scen, r, tranche, tssp)
4063     popScen1(scen, r, tranche, edj, tssp)
4064     gdpScen1(mod, ssp, var, r, tssp)
4065     popHist1(r, tranche, th)
4066     ghghist1(ghgcodes,r,th)
4067  ;
4068   
4069  *  Load the SSP database
4070   
4071  * !!!! THIS NEEDS FIXING !!!!
GDXIN   F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\../SatAcct/sspScenV9_2.gdx
--- LOAD  GHGCodes = 7:GHGCodes
4075  execute_load "../SatAcct/sspScenV9_2.gdx", tPop=pop, popScen, gdpScen, popHist ;
4076  execute_load "../SatAcct/sspScenV9_2.gdx", ghghist ;
4077   
4078  *  Aggregate population (ignore gender)
4079   
4080  tpop1(scen, r, tranche, tssp)           = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), tpop(scen, c, tranche, tssp)) ;
4081  popScen1(scen, r, tranche, edj, tssp)   = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), sum((sexx,ed)$mape1(edj,ed), popScen(scen, c
      , sexx, tranche, ed, tssp))) ;
4082  popHist1(r, tranche, th)                = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), popHist(c, tranche, th)) ;
4083   
4084  *  Aggregate GDP
4085   
4086  gdpScen1(mod, ssp, "gdp", r, tssp)      = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), gdpScen(mod, ssp, "gdp", c, tssp)) ;
4087  gdpScen1(mod, ssp, "gdpppp05", r, tssp) = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), gdpScen(mod, ssp, "gdpppp05", c, tssp)) ;
4088  gdpScen1(mod, ssp, "gdppc", r, tssp)$tpop1(ssp,r,"PTOTL",tssp)
4089     = (1e6)*gdpScen1(mod, ssp, "gdp", r, tssp) / tpop1(ssp, r, "PTOTL", tssp) ;
4090   
4091  *  Aggregate GHG
4092   
4093  ghghist1(ghgcodes,r,th)$(not sameas(ghgcodes,"NRGUSE")) = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), ghghist(ghgcodes, c, th)) ;
4094  *  Energy is evaluated in per capita terms
4095  ghghist1("NRGUSE",r,th) = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), popHist(c,"PTOTL",th)) ;
4096  ghghist1("NRGUSE",r,th)$ghghist1("NRGUSE",r,th)
4097     = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), ghghist("NRGUSE", c, th)*popHist(c,"PTOTL",th))
4098     / ghghist1("NRGUSE",r,th) ;
4099   
4100  * ------------------------------------------------------------------------------
4101  *
4102  *  Aggregate the GIDD population/education scenarios
4103  *
4104  * ------------------------------------------------------------------------------
4105   
4106  parameters
4107     GIDDPopProj(r0, edw, tranche, tssp)
4108     GIDDPopProj1(r, edw, tranche, tssp)
4109  ;
4110   
4111  execute_load "../SatAcct/giddProj.gdx", GIDDPopProj ;
4112   
4113  *  Load the GIDD scenario
4114   
4115  popScen1("GIDD", r, tranche, edj, tssp) = sum(r0$mapr(r0,r), sum(edw$mape2(edj, edw), GiDDPopProj(r0, edw, tranche, tssp))) ;
4116   
4117  popScen1(scen,r,trs,"elevt",tssp) = sum(edj$(not sameas(edj,"elevt")), popScen1(scen,r,trs,edj,tssp)) ;
4118  popScen1(scen,r,"ptotl",edj,tssp) = sum(trs, popScen1(scen,r,trs,edj,tssp)) ;
4119  tpop1("GIDD",r,tranche,tssp) = popScen1("GIDD",r,tranche,"elevt",tssp) ;
4120   
4121  * --------------------------------------------------------------------------------------------------
4122  *
4123  *  Aggregate the WEO targets
4124  *
4125  * --------------------------------------------------------------------------------------------------
4126   
4127  sets
4128     weo   "Set of WEO forecasts"
4129     ind   "Set of WEO indicators"
4130  ;
4131   
4132  Parameter
4133     WEOData(weo,c,ind,tt) "WEO data"
4134  ;
4135   
GDXIN   F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\../SatAcct/WEOData.gdx
4137  * Andre modified this line to get the WEO data working
4138   
--- LOAD  weo = 1:WEO
--- LOAD  ind = 3:ind
4140   
4141  execute_loaddc "../SatAcct/WEOData.gdx", WEOData ;
4142  * Andre modified this line to get the WEO data working
4143   
4144   
4145  set vWEO "WEO variables"   /
4146        RGDPD2014   "Real GDP in 2014 dollars"
4147     /
4148     WEOFlag(weo,tt)
4149  ;
4150   
4151  Parameter
4152     RGDPD2014(weo, c, tt)
4153     WEOData1(weo, r, vWEO, tt)
4154  ;
4155   
4156  weoFlag(weo,tt)$sum(c,WEOData(weo, c, "PPPGDP", tt)) = yes ;
4157   
4158  RGDPD2014(weo, c, "2014") = WEOData(weo, c, "NGDPD", "2014") ;
4159   
4160  *  !!!! Special for Spring 2020
4161   
4162  RGDPD2014("WEOSPRING2020", c, "2014") = WEOData("WEOFALL2019", c, "NGDPD", "2014") ;
4163   
4164  loop((weo,tt)$(tt.val gt 2014 and weoFlag(weo,tt)),
4165     RGDPD2014(weo, c, tt) = RGDPD2014(weo, c, tt-1)*(1 + 0.01*WEOData(weo, c, "NGDP_RPCH", tt)) ;
4166  ) ;
4167   
4168  scalar period ;
4169   
4170  for(period=2014 downto 1980 by 1,
4171     loop(tt$(tt.val = period),
4172        RGDPD2014(weo, c, tt-1) = RGDPD2014(weo, c, tt)/(1 + 0.01*WEOData(weo, c, "NGDP_RPCH", tt)) ;
4173     ) ;
4174  ) ;
4175   
4176   
4177  WEOData1(weo, r, "RGDPD2014", tt) = sum((r0,c)$(mapr(r0,r) and mapc(r0,c)), RGDPD2014(weo, c, tt)) ;
4178   
4179  execute_unload "ANX1/agg/ANX1Scn.gdx",
4180     weo, vWEO,
4181     tpop1=popscen, gdpscen1=gdpscen, popHist1=popHist, popScen1=educScen, weoData1=WEOData,
4182     ghgcodes, ghghist1=ghghist ;
4183  ;
4184   
4186   
4187  * ------------------------------------------------------------------------------
4188  *
4189  *  Create the set definitions for the model(s)
4190  *
4191  * ------------------------------------------------------------------------------
4192   
4193  file fsetAlt / "ANX1/alt/ANX1Sets.gms" / ;
4194  file fsetMod / "ANX1/fnl/ANX1Sets.gms" / ;
4195   
4196  *  Create the 'sets' file for AlterTax if requested
4197   
4199   
4200     put fsetAlt ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makeset.gms
4202  * ----------------------------------------------------------------------------------------
4203  *
4204  *  Create 'dimension' file for models
4205  *  The code herein is valid for Altertax, GTAP and Envisage
4206  *
4207  * ----------------------------------------------------------------------------------------
4208   
4209  put '$onempty' / / ;
4210   
4211  parameter
4212     strlen
4213     maxstrlen
4214     maxcol1
4215  ;
4216   
4217  maxstrlen = smax(a, card(a.tl))+2 ;
4218  maxstrlen = max(maxstrlen, smax(i, card(i.tl))+2) ;
4219  maxstrlen = max(maxstrlen, smax(fp, card(fp.tl))) ;
4220  maxstrlen = max(maxstrlen, smax(r, card(r.tl))) ;
4221  maxstrlen = max(maxstrlen, smax(stdlab, card(stdlab.tl))) ;
4222  maxstrlen = max(maxstrlen, smax(actf, card(actf.tl))+2) ;
4223  maxstrlen = max(maxstrlen, smax(commf, card(commf.tl))+2) ;
4224  maxstrlen = max(maxstrlen, smax(wb, card(wb.tl))+2) ;
4225   
4226  put 'set a0 "Original activities" /' / ;
4227  loop(a,
4228     put '   ', a.tl:<maxstrlen, '     "', a.te(a), '"' / ;
4229  ) ;
4230  put '/ ;' / / ;
4231   
4232  put 'set i0(a0) "Original commodities" /' / ;
4233  loop(i,
4234     put '   ', i.tl:<maxstrlen, '     "', i.te(i), '"' / ;
4235  ) ;
4236  put '/ ;' / / ;
4237   
4238  put '* --------------------------------------------------------------------' / ;
4239  put '*' / ;
4240  put '*   USER CAN MODIFY ACTIVITY/COMMODITY AGGREGATION' / ;
4241  put '*   USER MUST FILL IN SUBSETS WHERE NEEDED' / ;
4242  put '*' / ;
4243  put '* --------------------------------------------------------------------' / /;
4244   
4245  put / '* >>>> PLACE TO CHANGE ACTIVITIES, i.e. model activities' / / ;
---- Begin of Active File List
Level Type         Line  Filename
---------------------------------
    1 BATINCLUDE     45  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makeset.gms
                         %1  AlterTax
    0 INPUT        1930  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggGTAP.gms
---- End of Active File List

---- Begin of Compile-time Variable List
Level SetVal                          Type       Text
-----------------------------------------------------
    0 basename                        SCOPED     ANX1
    0 ifAlt                           SCOPED     ON
    0 model                           SCOPED     Env
    0 ifCSV                           SCOPED     1
    0 ifAggTrade                      SCOPED     1
    0 OPSYS                           SCOPED     DOS
    0 console                         SCOPED     con
    0 DIAG                            GLOBAL     ON
    0 DYN                             GLOBAL     ON
    0 MACRO                           GLOBAL     ON
    0 ifPower                         GLOBAL     ON
    0 ifBKSTOP                        GLOBAL     OFF
    0 ifWater                         GLOBAL     OFF
    0 NCO2                            GLOBAL     ON
    0 ELAST                           GLOBAL     OFF
    0 LAB                             GLOBAL     ON
    0 BoP                             GLOBAL     ON
    0 LU                              GLOBAL     OFF
    0 SAVEMAP                         GLOBAL     TXT
    0 ifMRIO                          GLOBAL     OFF
    0 ifR_D                           GLOBAL     ON
    0 DEPL                            GLOBAL     ON
    0 ifGENDER                        GLOBAL     OFF
    0 OVRRIDEGTAPARM                  GLOBAL     1
    0 OVRRIDEGTAPINC                  GLOBAL     1
    0 gtpDir                          GLOBAL     ../GTAP10POW
    0 GTAPBASE                        GLOBAL     GSDF
    0 SSPFile                         GLOBAL     ../SatAcct/sspScenV9_2.gdx
    0 DEPLFile                        GLOBAL     ../SatAcct/RystadGTAP2014.gdx
    0 giddLab                         GLOBAL     ../SatAcct/giddLab.gdx
    0 giddProj                        GLOBAL     ../SatAcct/giddProj.gdx
    0 EnvElast                        GLOBAL     ../SatAcct/EnvLinkElast10APOW.gdx
    0 ifDual                          GLOBAL     1
    0 SIGMA                           GLOBAL     1.0
    0 SIGMAM                          GLOBAL     1.5
    0 OMEGA                           GLOBAL     4
    0 ETAM                            GLOBAL     inf
    0 ETAE                            GLOBAL     inf
    0 ifCSV                           GLOBAL     
    0 ifAggTrade                      GLOBAL     
    0 VER                             GLOBAL     V10AFG
---- End of Compile-time Variable List

---- Begin of Macro List
$macro AGG1(v0,v,x0,x,mapx)  v(x)     = sum(x0$mapx(x0,x), v0(x0))
$macro AGG2(v0,v,x0,x,mapx,y0,y,mapy)  v(x,y)   = sum((x0,y0)$(mapx(x0,x) and mapy(y0,y)), v0(x0,y0))
$macro AGG3(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz)  v(x,y,z) = sum((x0,y0,z0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z)), v0(x0,y0,z0))
$macro AGG4
(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz,w0,w,mapw)  v(x,y,z,w) = sum((x0,y0,z0,w0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z) and mapw(w0
                                                                                                              ,w)), v0(x0,y0,z0,w0))
$macro IFLABOR  noLab
---- End of Macro List
4247  put 'set act "Modeled activities" /' / ;
4248  if(AlterTax eq AlterTax,
4249  *  AlterTax assumes diagonality
4250     loop(a,
4251        strlen = card(a.tl) ;
4252        put '   ', a.tl:<strlen, '-a', '':(maxstrlen-strlen-2), '     "', a.te(a), '"' / ;
4253     ) ;
4254  else
4255  *  Use the model aggregation
4256     loop(mapActSort(sortOrder,actf),
4257        strlen = card(actf.tl) ;
4258        put '   ', actf.tl:<strlen, '-a', '':(maxstrlen-strlen-2), '     "', actf.te(actf), '"' / ;
4260     ) ;
4261  ) ;
4262  put '/ ;' / / ;
4263   
4264  put '* >>>> PLACE TO CHANGE COMMODITIES, i.e. model commodities' / / ;
4265   
4266  put 'set comm "Modeled commodities" /' / ;
4267  if(AlterTax eq AlterTax,
4268  *  AlterTax assumes diagonality
4269     loop(i,
4270        strlen = card(i.tl) ;
4271        put '   ', i.tl:<strlen, '-c', '':(maxstrlen-strlen-2), '     "', i.te(i), '"' / ;
4272     ) ;
4273  else
4274  *  Use the model aggregation
4275     loop(mapCommSort(sortOrder,commf),
4276        strlen = card(commf.tl) ;
4277        put '   ', commf.tl:<strlen, '-c', '':(maxstrlen-strlen-2), '     "', commf.te(commf), '"' / ;
4278     ) ;
4279  ) ;
4280  put '/ ;' / / ;
4281   
4282  put 'set endw "Modeled production factors" /' / ;
4283  loop(fp$((ifWater=OFF and not Wat(fp)) or ifWater=ON),
4284     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
4285  ) ;
4286  put '/ ;' / / ;
4287   
4288  put 'set stdlab "Standard SAM labels" /' / ;
4289  loop(stdlab,
4290     put '   ', stdlab.tl:<maxstrlen, '     "', stdlab.te(stdlab), '"' / ;
4291  ) ;
4292  put '/ ;' / / ;
4293   
4294  put 'set findem(stdlab) "Final demand accounts" /' / ;
4295  loop(stdlab$fd(stdlab),
4296     put '   ', stdlab.tl:<maxstrlen, '     "', stdlab.te(stdlab), '"' / ;
4297  ) ;
4298  put '/ ;' / / ;
4299   
4300  put 'set reg "Modeled regions" /' / ;
4301  loop(mapRegSort(sortOrder,r),
4302     put '   ', r.tl:<maxstrlen, '     "', r.te(r), '"' / ;
4303  ) ;
4304  put '/ ;' / / ;
4305   
4306  put 'set is "SAM accounts for aggregated SAM" /' / /;
4307   
4308  put '*  User-defined activities' / /;
4309   
4310  put '   set.act' / / ;
4311   
4312   
4313  put '*  User-defined commodities' / / ;
4314   
4315  put '   set.comm' / / ;
4316   
4317  put '*  User-defined factors' / / ;
4318   
4319  put '   set.endw' / / ;
4320   
4321  put '*  Standard SAM accounts' / / ;
4322   
4323  put '   set.stdlab' / / ;
4324   
4325  put '*  User-defined regions' / / ;
4326   
4327  put '   set.reg' / / ;
4328   
4329  put '/ ;' / / ;
4330   
4331  put 'alias(is, js) ;' / / ;
4332   
4333  put 'set aa(is) "Armington agents" /' / /;
4334   
4335  put '   set.act' / / ;
4336   
4337  put '   set.findem' / / ;
4338   
4339  put '/ ;' / / ;
4340   
4341  put 'set a(aa) "Activities" /' / /;
4342   
4343  put '   set.act' / / ;
4344   
4345  put '/ ;' / / ;
4346   
4347  put 'set i(is) "Commodities" /' / /;
4348   
4349  put '   set.comm' / / ;
4350   
4351  put '/ ;' / / ;
4352   
4353  put 'alias(i, j) ;' / / ;
4354   
4355  put 'set fp(is) "Factors of production" /' / /;
4356   
4357  put '   set.endw' / / ;
4358   
4359  put '/ ;' / / ;
4360   
4361  put 'set l(fp) "Labor factors" /' / /;
4362  loop(fp$l(fp),
4363     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
4364  ) ;
4365  put '/ ;' / / ;
4366   
4367  *!!!! For compatibility -- assume first labor bundle has the unskilled workers
4368   
4369  put '*   Subsets ul(l) and sl(l) included for backward compatibility' / / ;
4370  put 'set ul(l) "Unskilled labor" /' / / ;
4371  loop(mapl(wb,l)$(ord(wb) eq 1),
4372     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
4373  ) ;
4374  put '/ ;' / / ;
4375   
4376  put 'set sl(l) "Skilled labor" /' / / ;
4377  loop(mapl(wb,l)$(ord(wb) ne 1),
4378     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
4379  ) ;
4380  put '/ ;' / / ;
4381   
4382  put 'set wb "Intermediate labor bundle(s)" /' / ;
4383  loop(wb,
4384     put '   ', wb.tl:<maxstrlen, '     "', wb.te(wb), '"' / ;
4385  ) ;
4386  put '/ ;' / / ;
4387   
4388  put 'set maplab1(wb) "Mapping of intermediate labor demand bundle(s) to LAB1" /' / ;
4389  loop(wb$maplab1(wb),
4390     put '   ', wb.tl:<maxstrlen, '     "', wb.te(wb), '"' / ;
4391  ) ;
4392  put '/ ;' / / ;
4393   
4394  put 'set mapl(wb,l) "Mapping of labor categories to intermedate demand bundle(s)" /' / ;
4395  loop(mapl(wb,l),
4396     strlen = card(wb.tl) ;
4397     put '   ', wb.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:card(l.tl) / ;
4398  ) ;
4399  put '/ ;' / / ;
4400   
4401  put 'set lr(l) "Reference labor for skill premium" /' / /;
4402  loop(l$(lr(l)),
4403     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
4404  ) ;
4405  put '/ ;' / / ;
4406   
4407  put 'set cap(fp) "Capital" /' / /;
4408  loop(fp$cap(fp),
4409     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
4410  ) ;
4411  put '/ ;' / / ;
4412   
4413  put 'set lnd(fp) "Land endowment" /' / / ;
4414  loop(fp$lnd(fp),
4415     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
4416  ) ;
4417  put '/ ;' / / ;
4418   
4419  put 'set nrs(fp) "Natural resource" /' / /;
4420  loop(fp$nrs(fp),
4421     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
4422  ) ;
4423  put '/ ;' / / ;
4424   
4425  if(AlterTax=Env,
4426     put 'set wat(fp) "Water resource" /' / /;
4427     loop(fp$wat(fp),
4428        put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
4429     ) ;
4430     put '/ ;' / / ;
4431  ) ;
4432   
4433  put '* >>>> CAN MODIFY MOBILE VS. NON-MOBILE FACTORS' / / ;
4434   
4435  put 'set fm(fp) "Mobile factors" /' / / ;
4436   
4437  loop(fp,
4438     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
4439  ) ;
4440  put '/ ;' / / ;
4441   
4442  put 'set fnm(fp) "Non-mobile factors" /' / / ;
4443   
4444  put '/ ;' / / ;
4445   
4446  put 'set fd(aa) "Domestic final demand agents" /' / / ;
4447  if(AlterTax = Env,
4448     loop(fd$(not tmg(fd)),
4449        put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
4450     ) ;
4451  else
4452     put '   set.findem' / / ;
4453  ) ;
4454  put '/ ;' / / ;
4455   
4456  put 'set h(fd) "Households" /' / ;
4457  loop(fd$h(fd),
4458     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
4459  ) ;
4460  put '/ ;' / / ;
4461   
4462  put 'singleton set gov(fd) "Government" /' / ;
4463  loop(fd$gov(fd),
4464     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
4465  ) ;
4466  put '/ ;' / / ;
4467   
4468   
4470  put 'singleton set r_d(fd) "Research and development" /' / ;
4471  loop(fd$r_d(fd),
4472     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
4473  ) ;
4474  put '/ ;' / / ;
4476   
4478   
4479  put 'singleton set inv(fd) "Investment" /' / ;
4480  loop(fd$inv(fd),
4481     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
4482  ) ;
4483  put '/ ;' / / ;
4484   
4485  put 'set fdc(fd) "Final demand accounts with CES expenditure function" /' / ;
4486  loop(fd$(not (h(fd) or tmg(fd))),
4487     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
4488  ) ;
4489  put '/ ;' / / ;
4490   
4491  if(AlterTax ne Env,
4492     put 'set tmg(fd) "Domestic supply of trade margins services" /' / ;
4493     loop(fd$tmg(fd),
4494        put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
4495     ) ;
4496     put '/ ;' / / ;
4497  ) ;
4498   
4499  put 'set r(is) "Regions" /' / /;
4500   
4501  put '   set.reg' / / ;
4502   
4503  put '/ ;' / / ;
4504   
4505  put 'alias(r, rp) ; alias(r, s) ; alias(r, d) ;' / / ;
4506   
4507  put '* >>>> MUST INSERT RESIDUAL REGION (ONLY ONE)' / / ;
4508   
4509  put 'set rres(r) "Residual region" /' / ;
4510  loop(r$rres(r),
4511     put '   ', r.tl:<maxstrlen, '     "', r.te(r), '"' / ;
4512  ) ;
4513  put '/ ;' / / ;
4514   
4515  put '* >>>> MUST INSERT MUV REGIONS (ONE OR MORE)' / / ;
4516   
4517  put 'set rmuv(r) "MUV regions" /' / ;
4518  loop(r$rmuv(r),
4519     put '   ', r.tl:<maxstrlen, '     "', r.te(r), '"' / ;
4520  ) ;
4521  put '/ ;' / / ;
4522   
4523  put '* >>>> MUST INSERT MUV COMMODITIES (ONE OR MORE)' / / ;
4524   
4525  put 'set imuv(i) "MUV commodities" /' / ;
4526  if(AlterTax eq AlterTax,
4527   
4528  *  Make all commodities MUV
4529   
4530     put '   set.comm' / / ;
4531   
4532  else
4533   
4534     loop(commf$imuvf(commf),
4535        strlen = card(commf.tl) ;
4536        put '   ', commf.tl:<strlen, '-c' / ;
4537     ) ;
4538  ) ;
4539  put '/ ;' / / ;
4540   
4541  *  Emission sets
4542   
4543  if(AlterTax ne Env,
4544     put 'set em "Emissions" /' / ;
4545     loop(em,
4546        put '   ', em.tl:<maxstrlen, '     "', em.te(em), '"' / ;
4547     ) ;
4548     put '/ ;' / / ;
4549   
4550     put 'set emn(em) "Non-CO2 emissions" /' / ;
4551     loop(em$emn(em),
4552        put '   ', em.tl:<maxstrlen, '     "', em.te(em), '"' / ;
4553     ) ;
4554     put '/ ;' / / ;
4555   
4556     put 'alias(emn, nco2) ;' / / ;
4557  ) ;
4558   
4559  *  Aggregation sets
4560   
4561  put 'set ia "Aggregate commodities for model output" /' / ;
4562  if(AlterTax ne Altertax,
4563     loop(commf,
4564        strlen = card(commf.tl) ;
4565        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', commf.te(commf), '"' / ;
4566     ) ;
4567     put / ;
4568     loop(ia,
4569        strlen = card(ia.tl) ;
4570        put '   ', ia.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', ia.te(ia), '"' / ;
4571     ) ;
4572  else
4573     strlen = 5 ;
4574     put '   ', 'Total':<strlen, ' ':(maxstrlen-(strlen)+5), '"Aggregation of all commodities"' / ;
4575  ) ;
4576  put '/ ;' / / ;
4577   
4578  if(AlterTax ne Altertax,
4579     put 'set mapi(ia,i) "Mapping for aggregate commodities" /' / ;
4580     loop(commf,
4581        strlen = card(commf.tl) ;
4582        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+1), '.', commf.tl:card(commf.tl), '-c' / ;
4583     ) ;
4584     put / ;
4585     loop(mapia(ia,commf),
4586        strlen = card(ia.tl) ;
4587        put '   ', ia.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', commf.tl:card(commf.tl), '-c' / ;
4588     ) ;
4589     put '/ ;' / / ;
4590  else
4591     put 'set mapi(ia,i) "Mapping for aggregate commodities" ;' / ;
4592     put 'mapi("Total",i) = yes ;' / / ;
4593  ) ;
4594   
4595  put 'set iaa(ia) "Aggregate commodities only" ;' / ;
4596  put 'loop((i,ia)$(not sameas(i,ia)), iaa(ia) = yes ; ) ;' / / ;
4597   
4598  put 'set aga "Aggregate activities for model output" /' / ;
4599  if(AlterTax ne Altertax,
4600     loop(actf,
4601        strlen = card(actf.tl) ;
4602        put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
4604     ) ;
4605     put / ;
4606     loop(aga,
4607        strlen = card(aga.tl) ;
4608        put '   ', aga.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', aga.te(aga), '"' / ;
4609     ) ;
4610  else
4611     strlen = 5 ;
4612     put '   ', 'Total':<strlen, ' ':(maxstrlen-(strlen)+5), '"Aggregation of all activities"' / ;
4613  ) ;
4614  put '/ ;' / / ;
4615   
4616  if(AlterTax ne Altertax,
4617     put 'set mapaga(aga,a) "Mapping for aggregate activities" /' / ;
4618     loop(actf,
4619        strlen = card(actf.tl) ;
4620        put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+1), '.', actf.tl:card(actf.tl), '-a' / ;
4622     ) ;
4623     put / ;
4624     loop(mapaga(aga,actf),
4625        strlen = card(aga.tl) ;
4626        put '   ', aga.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', actf.tl:card(actf.tl), '-a' / ;
4627     ) ;
4629     put '/ ;' / / ;
4630  else
4631     put 'set mapaga(aga,a) "Mapping for aggregate activities" ;' / ;
4632     put 'mapaga("Total",a) = yes ;' / / ;
4633  ) ;
4634   
4635  put 'set agaa(aga) "Aggregate activities only" ;' / ;
4636  put 'loop((a,aga)$(not sameas(a,aga)), agaa(aga) = yes ; ) ;' / / ;
4637   
4638  put 'set ra "Aggregate regions for emission regimes and model output" /' / ;
4639  loop(r,
4640     strlen = card(r.tl) ;
4641     put '   ', r.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', r.te(r), '"' / ;
4642  ) ;
4643  put / ;
4644  loop(ra,
4645     strlen = card(ra.tl) ;
4646     put '   ', ra.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', ra.te(ra), '"' / ;
4647  ) ;
4648  put '/ ;' / / ;
4649   
4650  put 'set mapr(ra,r) "Mapping for aggregate regions" /' / ;
4651  loop(r,
4652     strlen = card(r.tl) ;
4653     put '   ', r.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', r.tl:card(r.tl) / ;
4654  ) ;
4655  put / ;
4656  loop(mapra(ra,r),
4657     strlen = card(ra.tl) ;
4658     put '   ', ra.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', r.tl:card(r.tl) / ;
4659  ) ;
4660  put '/ ;' / / ;
4661   
4662  put 'set rra(ra) "Aggregate regions only" ;' / ;
4663  put 'loop((r,ra)$(not sameas(r,ra)), rra(ra) = yes ; ) ;' / / ;
4664   
4665  put 'set lagg "Aggregate labor for output" /' / ;
4666  loop(l,
4667     strlen = card(l.tl) ;
4668     put '   ', l.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', l.te(l), '"' / ;
4669  ) ;
4670  put / ;
4671  loop(lagg,
4672     strlen = card(lagg.tl) ;
4673     put '   ', lagg.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', lagg.te(lagg), '"' / ;
4674  ) ;
4675  put '/ ;' / / ;
4676   
4677  put 'set maplagg(lagg,l) "Mapping for aggregate regions" /' / ;
4678  loop(l,
4679     strlen = card(l.tl) ;
4680     put '   ', l.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:card(l.tl) / ;
4681  ) ;
4682  put / ;
4683  loop(maplagg(lagg,l),
4684     strlen = card(lagg.tl) ;
4685     put '   ', lagg.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:card(l.tl) / ;
4686  ) ;
4687  put '/ ;' / / ;
4688   
4689  put '* >>>> CAN CHANGE ACTIVITY MAPPING' / / ;
4690   
4691  *  !!!! FOR ALTERTAX -- ONE-TO-ONE MAPPING
4692   
4693  put 'set mapa0(a0, a) "Mapping from original activities to new activities" /' / ;
4694  if(AlterTax eq AlterTax,
4695     loop(a,
4696        strlen = card(a.tl) ;
4697        put '   ', a.tl:<maxstrlen, '.', a.tl:<strlen, '-a' / ;
4698     ) ;
4699  else
4700     loop(mapaf(a,actf),
4701        strlen = card(a.tl) ;
4702        put '   ', a.tl:<maxstrlen, '.', actf.tl:<card(actf.tl), '-a' / ;
4703     ) ;
4704  ) ;
4705  put '/ ;' / / ;
4706   
4707  put '* >>>> CAN CHANGE COMMODITY MAPPING' / / ;
4708   
4709  *  !!!! FOR ALTERTAX -- ONE-TO-ONE MAPPING
4710   
4711  put 'set mapi0(i0, i) "Mapping from original commodities to new commodities" /' / ;
4712  if(AlterTax eq AlterTax,
4713     loop(i,
4714        strlen = card(i.tl) ;
4715        put '   ', i.tl:<maxstrlen, '.', i.tl:<strlen, '-c' / ;
4716     ) ;
4717  else
4718     loop(mapif(i,commf),
4719        strlen = card(i.tl) ;
4720        put '   ', i.tl:<maxstrlen, '.', commf.tl:<card(commf.tl), '-c' / ;
4721     ) ;
4722  ) ;
4723  put '/ ;' / / ;
4724   
4726   
4727  put 'set var "GDP variables" /' / ;
4728  loop(var,
4729     strlen = card(var.tl) ;
4730     put '   ', var.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', var.te(var), '"' / ;
4731  ) ;
4732  put '/ ;' / / ;
4733   
4734  put 'set scen "Scenarios" /' / ;
4735  loop(scen,
4736     strlen = card(scen.tl) ;
4737     put '   ', scen.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', scen.te(scen), '"' / ;
4738  ) ;
4739  put '/ ;' / / ;
4740   
4741  put 'set ssp(scen) "SSP Scenarios" /' / ;
4742  loop(scen$ssp(scen),
4743     strlen = card(scen.tl) ;
4744     put '   ', scen.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', scen.te(scen), '"' / ;
4745  ) ;
4746  put '/ ;' / / ;
4747   
4748  put 'set mod "Models" /' / ;
4749  loop(mod,
4750     strlen = card(mod.tl) ;
4751     put '   ', mod.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', mod.te(mod), '"' / ;
4752  ) ;
4753  put '/ ;' / / ;
4754   
4755  put 'set tranche "Population cohorts" /' / ;
4756  loop(tranche,
4757     strlen = card(tranche.tl) ;
4758     put '   ', tranche.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', tranche.te(tranche), '"' / ;
4759  ) ;
4760  put '/ ;' / / ;
4761   
4762  put 'set trs(tranche) "Population cohorts" /' / ;
4763  loop(tranche$trs(tranche),
4764     strlen = card(tranche.tl) ;
4765     put '   ', tranche.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', tranche.te(tranche), '"' / ;
4766  ) ;
4767  put '/ ;' / / ;
4768   
4769  put 'set sex   "Gender categories" /' / ;
4770  loop(sex,
4771     strlen = card(sex.tl) ;
4772     put '   ', sex.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', sex.te(sex), '"' / ;
4773  ) ;
4774  put '/ ;' / / ;
4775   
4776  put 'set sexx(sex) "Gender categories excl total" /' / ;
4777  loop(sex$sexx(sex),
4778     strlen = card(sex.tl) ;
4779     put '   ', sex.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', sex.te(sex), '"' / ;
4780  ) ;
4781  put '/ ;' / / ;
4782   
4783  put 'set ed "Combined SSP/GIDD education levels" /' / ;
4784  loop(edj,
4785     strlen = card(edj.tl) ;
4786     put '   ', edj.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', edj.te(edj), '"' / ;
4787  ) ;
4788  put '/ ;' / / ;
4789   
4790  put 'set edx(ed) "Education levels excluding totals" /' / ;
4791  loop(edj$(not sameas("elevt", edj)),
4792     strlen = card(edj.tl) ;
4793     put '   ', edj.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', edj.te(edj), '"' / ;
4794  ) ;
4795  put '/ ;' / / ;
4796   
4797  *  Labor growth assumptions
4798   
4799  put 'set nsk(l) "Unskilled types for labor growth assumptions" /' / ;
4800  loop(l$(not skl(l)),
4801     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
4802  ) ;
4803  put '/ ;' / / ;
4804   
4805  put 'set skl(l)  "Skill types for labor growth assumptions" /' / ;
4806  loop(l$skl(l),
4807     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
4808  ) ;
4809  put '/ ;' / / ;
4810   
4811  put 'set educMap(r,l,ed) "Mapping of skills to education levels" /' / ;
4812  loop(educMap(r,l,elev),
4813     strlen = card(r.tl) ;
4814     put '   ', r.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:<maxstrlen, '.', elev.tl / ;
4815  ) ;
4816  put '/ ;' / / ;
4817   
4819   
4820  *  Create sort for SAM and other purposes
4821   
4822  if(AlterTax eq AlterTax,
4823  *  !!!! No longer need to substract 1 for CGDS
4824     order = card(a) + card(a) + card(fp) + card(stdlab) + card(r) ;
4825  else
4826     order = card(actf) + card(commf) + card(fp) + card(stdlab) + card(r) ;
4828  ) ;
4829   
4830  put 'set sortOrder / sort1*sort', order:0:0, ' / ;' / / ;
4831   
4832  put 'set mapOrder(sortOrder,is) / ' / ;
4833   
4834  order = 0 ;
4835   
4836  if(AlterTax eq AlterTax,
4837  *  AlterTax assumes diagonality and we'll forego putting a sort order for this
4838     loop(a,
4839        order = order + 1 ;
4840        put 'sort', order:0:0, '.', a.tl:card(a.tl), '-a' / ;
4841     ) ;
4842  else
4843  *  Use the model aggregation
4844     loop(mapActSort(sortOrder,actf),
4845        order = order + 1 ;
4846        put 'sort', order:0:0, '.', actf.tl:card(actf.tl), '-a' / ;
4848     ) ;
4849  ) ;
4850   
4851  if(AlterTax eq AlterTax,
4852  *  AlterTax assumes diagonality and we'll forego putting a sort order for this
4853     loop(a,
4854        order = order + 1 ;
4855        put 'sort', order:0:0, '.', a.tl:card(a.tl), '-c' / ;
4856     ) ;
4857  else
4858  *  Use the model aggregation
4859     loop(mapCommSort(sortOrder,commf),
4860        order = order + 1 ;
4861        put 'sort', order:0:0, '.', commf.tl:card(commf.tl), '-c' / ;
4862     ) ;
4863  ) ;
4864   
4865  loop(fp,
4866     order = order + 1 ;
4867     put 'sort', order:0:0, '.', fp.tl:card(fp.tl) / ;
4868  ) ;
4869   
4870  loop(stdlab,
4871     order = order + 1 ;
4872     put 'sort', order:0:0, '.', stdlab.tl:card(stdlab.tl) / ;
4873  ) ;
4874   
4875  loop(mapRegSort(sortOrder,r),
4876     order = order + 1 ;
4877     put 'sort', order:0:0, '.', r.tl:card(r.tl) / ;
4878  ) ;
4879   
4880  put '/ ;' / / ;
4881     putclose fsetAlt ;
4882   
4884   
4885  *  Create the 'final sets' file for the requested model
4886   
4888   
4889     put fsetMod ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makeset.gms
4891  * ----------------------------------------------------------------------------------------
4892  *
4893  *  Create 'dimension' file for models
4894  *  The code herein is valid for Altertax, GTAP and Envisage
4895  *
4896  * ----------------------------------------------------------------------------------------
4897   
4898  put '$onempty' / / ;
4899   
4900  parameter
4901     strlen
4902     maxstrlen
4903     maxcol1
4904  ;
4905   
4906  maxstrlen = smax(a, card(a.tl))+2 ;
4907  maxstrlen = max(maxstrlen, smax(i, card(i.tl))+2) ;
4908  maxstrlen = max(maxstrlen, smax(fp, card(fp.tl))) ;
4909  maxstrlen = max(maxstrlen, smax(r, card(r.tl))) ;
4910  maxstrlen = max(maxstrlen, smax(stdlab, card(stdlab.tl))) ;
4911  maxstrlen = max(maxstrlen, smax(actf, card(actf.tl))+2) ;
4912  maxstrlen = max(maxstrlen, smax(commf, card(commf.tl))+2) ;
4913  maxstrlen = max(maxstrlen, smax(wb, card(wb.tl))+2) ;
4914   
4915  put 'set a0 "Original activities" /' / ;
4916  loop(a,
4917     put '   ', a.tl:<maxstrlen, '     "', a.te(a), '"' / ;
4918  ) ;
4919  put '/ ;' / / ;
4920   
4921  put 'set i0(a0) "Original commodities" /' / ;
4922  loop(i,
4923     put '   ', i.tl:<maxstrlen, '     "', i.te(i), '"' / ;
4924  ) ;
4925  put '/ ;' / / ;
4926   
4927  put '* --------------------------------------------------------------------' / ;
4928  put '*' / ;
4929  put '*   USER CAN MODIFY ACTIVITY/COMMODITY AGGREGATION' / ;
4930  put '*   USER MUST FILL IN SUBSETS WHERE NEEDED' / ;
4931  put '*' / ;
4932  put '* --------------------------------------------------------------------' / /;
4933   
4934  put / '* >>>> PLACE TO CHANGE ACTIVITIES, i.e. model activities' / / ;
---- Begin of Active File List
Level Type         Line  Filename
---------------------------------
    1 BATINCLUDE     45  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makeset.gms
                         %1  Env
    0 INPUT        1946  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggGTAP.gms
---- End of Active File List

---- Begin of Compile-time Variable List
Level SetVal                          Type       Text
-----------------------------------------------------
    0 basename                        SCOPED     ANX1
    0 ifAlt                           SCOPED     ON
    0 model                           SCOPED     Env
    0 ifCSV                           SCOPED     1
    0 ifAggTrade                      SCOPED     1
    0 OPSYS                           SCOPED     DOS
    0 console                         SCOPED     con
    0 DIAG                            GLOBAL     ON
    0 DYN                             GLOBAL     ON
    0 MACRO                           GLOBAL     ON
    0 ifPower                         GLOBAL     ON
    0 ifBKSTOP                        GLOBAL     OFF
    0 ifWater                         GLOBAL     OFF
    0 NCO2                            GLOBAL     ON
    0 ELAST                           GLOBAL     OFF
    0 LAB                             GLOBAL     ON
    0 BoP                             GLOBAL     ON
    0 LU                              GLOBAL     OFF
    0 SAVEMAP                         GLOBAL     TXT
    0 ifMRIO                          GLOBAL     OFF
    0 ifR_D                           GLOBAL     ON
    0 DEPL                            GLOBAL     ON
    0 ifGENDER                        GLOBAL     OFF
    0 OVRRIDEGTAPARM                  GLOBAL     1
    0 OVRRIDEGTAPINC                  GLOBAL     1
    0 gtpDir                          GLOBAL     ../GTAP10POW
    0 GTAPBASE                        GLOBAL     GSDF
    0 SSPFile                         GLOBAL     ../SatAcct/sspScenV9_2.gdx
    0 DEPLFile                        GLOBAL     ../SatAcct/RystadGTAP2014.gdx
    0 giddLab                         GLOBAL     ../SatAcct/giddLab.gdx
    0 giddProj                        GLOBAL     ../SatAcct/giddProj.gdx
    0 EnvElast                        GLOBAL     ../SatAcct/EnvLinkElast10APOW.gdx
    0 ifDual                          GLOBAL     1
    0 SIGMA                           GLOBAL     1.0
    0 SIGMAM                          GLOBAL     1.5
    0 OMEGA                           GLOBAL     4
    0 ETAM                            GLOBAL     inf
    0 ETAE                            GLOBAL     inf
    0 ifCSV                           GLOBAL     
    0 ifAggTrade                      GLOBAL     
    0 VER                             GLOBAL     V10AFG
---- End of Compile-time Variable List

---- Begin of Macro List
$macro AGG1(v0,v,x0,x,mapx)  v(x)     = sum(x0$mapx(x0,x), v0(x0))
$macro AGG2(v0,v,x0,x,mapx,y0,y,mapy)  v(x,y)   = sum((x0,y0)$(mapx(x0,x) and mapy(y0,y)), v0(x0,y0))
$macro AGG3(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz)  v(x,y,z) = sum((x0,y0,z0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z)), v0(x0,y0,z0))
$macro AGG4
(v0,v,x0,x,mapx,y0,y,mapy,z0,z,mapz,w0,w,mapw)  v(x,y,z,w) = sum((x0,y0,z0,w0)$(mapx(x0,x) and mapy(y0,y) and mapz(z0,z) and mapw(w0
                                                                                                              ,w)), v0(x0,y0,z0,w0))
$macro IFLABOR  noLab
---- End of Macro List
4936  put 'set act "Modeled activities" /' / ;
4937  if(Env eq AlterTax,
4938  *  AlterTax assumes diagonality
4939     loop(a,
4940        strlen = card(a.tl) ;
4941        put '   ', a.tl:<strlen, '-a', '':(maxstrlen-strlen-2), '     "', a.te(a), '"' / ;
4942     ) ;
4943  else
4944  *  Use the model aggregation
4945     loop(mapActSort(sortOrder,actf),
4946        strlen = card(actf.tl) ;
4947        put '   ', actf.tl:<strlen, '-a', '':(maxstrlen-strlen-2), '     "', actf.te(actf), '"' / ;
4949     ) ;
4950  ) ;
4951  put '/ ;' / / ;
4952   
4953  put '* >>>> PLACE TO CHANGE COMMODITIES, i.e. model commodities' / / ;
4954   
4955  put 'set comm "Modeled commodities" /' / ;
4956  if(Env eq AlterTax,
4957  *  AlterTax assumes diagonality
4958     loop(i,
4959        strlen = card(i.tl) ;
4960        put '   ', i.tl:<strlen, '-c', '':(maxstrlen-strlen-2), '     "', i.te(i), '"' / ;
4961     ) ;
4962  else
4963  *  Use the model aggregation
4964     loop(mapCommSort(sortOrder,commf),
4965        strlen = card(commf.tl) ;
4966        put '   ', commf.tl:<strlen, '-c', '':(maxstrlen-strlen-2), '     "', commf.te(commf), '"' / ;
4967     ) ;
4968  ) ;
4969  put '/ ;' / / ;
4970   
4971  put 'set endw "Modeled production factors" /' / ;
4972  loop(fp$((ifWater=OFF and not Wat(fp)) or ifWater=ON),
4973     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
4974  ) ;
4975  put '/ ;' / / ;
4976   
4977  put 'set stdlab "Standard SAM labels" /' / ;
4978  loop(stdlab,
4979     put '   ', stdlab.tl:<maxstrlen, '     "', stdlab.te(stdlab), '"' / ;
4980  ) ;
4981  put '/ ;' / / ;
4982   
4983  put 'set findem(stdlab) "Final demand accounts" /' / ;
4984  loop(stdlab$fd(stdlab),
4985     put '   ', stdlab.tl:<maxstrlen, '     "', stdlab.te(stdlab), '"' / ;
4986  ) ;
4987  put '/ ;' / / ;
4988   
4989  put 'set reg "Modeled regions" /' / ;
4990  loop(mapRegSort(sortOrder,r),
4991     put '   ', r.tl:<maxstrlen, '     "', r.te(r), '"' / ;
4992  ) ;
4993  put '/ ;' / / ;
4994   
4995  put 'set is "SAM accounts for aggregated SAM" /' / /;
4996   
4997  put '*  User-defined activities' / /;
4998   
4999  put '   set.act' / / ;
5000   
5001   
5002  put '*  User-defined commodities' / / ;
5003   
5004  put '   set.comm' / / ;
5005   
5006  put '*  User-defined factors' / / ;
5007   
5008  put '   set.endw' / / ;
5009   
5010  put '*  Standard SAM accounts' / / ;
5011   
5012  put '   set.stdlab' / / ;
5013   
5014  put '*  User-defined regions' / / ;
5015   
5016  put '   set.reg' / / ;
5017   
5018  put '/ ;' / / ;
5019   
5020  put 'alias(is, js) ;' / / ;
5021   
5022  put 'set aa(is) "Armington agents" /' / /;
5023   
5024  put '   set.act' / / ;
5025   
5026  put '   set.findem' / / ;
5027   
5028  put '/ ;' / / ;
5029   
5030  put 'set a(aa) "Activities" /' / /;
5031   
5032  put '   set.act' / / ;
5033   
5034  put '/ ;' / / ;
5035   
5036  put 'set i(is) "Commodities" /' / /;
5037   
5038  put '   set.comm' / / ;
5039   
5040  put '/ ;' / / ;
5041   
5042  put 'alias(i, j) ;' / / ;
5043   
5044  put 'set fp(is) "Factors of production" /' / /;
5045   
5046  put '   set.endw' / / ;
5047   
5048  put '/ ;' / / ;
5049   
5050  put 'set l(fp) "Labor factors" /' / /;
5051  loop(fp$l(fp),
5052     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
5053  ) ;
5054  put '/ ;' / / ;
5055   
5056  *!!!! For compatibility -- assume first labor bundle has the unskilled workers
5057   
5058  put '*   Subsets ul(l) and sl(l) included for backward compatibility' / / ;
5059  put 'set ul(l) "Unskilled labor" /' / / ;
5060  loop(mapl(wb,l)$(ord(wb) eq 1),
5061     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
5062  ) ;
5063  put '/ ;' / / ;
5064   
5065  put 'set sl(l) "Skilled labor" /' / / ;
5066  loop(mapl(wb,l)$(ord(wb) ne 1),
5067     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
5068  ) ;
5069  put '/ ;' / / ;
5070   
5071  put 'set wb "Intermediate labor bundle(s)" /' / ;
5072  loop(wb,
5073     put '   ', wb.tl:<maxstrlen, '     "', wb.te(wb), '"' / ;
5074  ) ;
5075  put '/ ;' / / ;
5076   
5077  put 'set maplab1(wb) "Mapping of intermediate labor demand bundle(s) to LAB1" /' / ;
5078  loop(wb$maplab1(wb),
5079     put '   ', wb.tl:<maxstrlen, '     "', wb.te(wb), '"' / ;
5080  ) ;
5081  put '/ ;' / / ;
5082   
5083  put 'set mapl(wb,l) "Mapping of labor categories to intermedate demand bundle(s)" /' / ;
5084  loop(mapl(wb,l),
5085     strlen = card(wb.tl) ;
5086     put '   ', wb.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:card(l.tl) / ;
5087  ) ;
5088  put '/ ;' / / ;
5089   
5090  put 'set lr(l) "Reference labor for skill premium" /' / /;
5091  loop(l$(lr(l)),
5092     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
5093  ) ;
5094  put '/ ;' / / ;
5095   
5096  put 'set cap(fp) "Capital" /' / /;
5097  loop(fp$cap(fp),
5098     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
5099  ) ;
5100  put '/ ;' / / ;
5101   
5102  put 'set lnd(fp) "Land endowment" /' / / ;
5103  loop(fp$lnd(fp),
5104     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
5105  ) ;
5106  put '/ ;' / / ;
5107   
5108  put 'set nrs(fp) "Natural resource" /' / /;
5109  loop(fp$nrs(fp),
5110     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
5111  ) ;
5112  put '/ ;' / / ;
5113   
5114  if(Env=Env,
5115     put 'set wat(fp) "Water resource" /' / /;
5116     loop(fp$wat(fp),
5117        put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
5118     ) ;
5119     put '/ ;' / / ;
5120  ) ;
5121   
5122  put '* >>>> CAN MODIFY MOBILE VS. NON-MOBILE FACTORS' / / ;
5123   
5124  put 'set fm(fp) "Mobile factors" /' / / ;
5125   
5126  loop(fp,
5127     put '   ', fp.tl:<maxstrlen, '     "', fp.te(fp), '"' / ;
5128  ) ;
5129  put '/ ;' / / ;
5130   
5131  put 'set fnm(fp) "Non-mobile factors" /' / / ;
5132   
5133  put '/ ;' / / ;
5134   
5135  put 'set fd(aa) "Domestic final demand agents" /' / / ;
5136  if(Env = Env,
5137     loop(fd$(not tmg(fd)),
5138        put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
5139     ) ;
5140  else
5141     put '   set.findem' / / ;
5142  ) ;
5143  put '/ ;' / / ;
5144   
5145  put 'set h(fd) "Households" /' / ;
5146  loop(fd$h(fd),
5147     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
5148  ) ;
5149  put '/ ;' / / ;
5150   
5151  put 'singleton set gov(fd) "Government" /' / ;
5152  loop(fd$gov(fd),
5153     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
5154  ) ;
5155  put '/ ;' / / ;
5156   
5157   
5159  put 'singleton set r_d(fd) "Research and development" /' / ;
5160  loop(fd$r_d(fd),
5161     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
5162  ) ;
5163  put '/ ;' / / ;
5165   
5167   
5168  put 'singleton set inv(fd) "Investment" /' / ;
5169  loop(fd$inv(fd),
5170     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
5171  ) ;
5172  put '/ ;' / / ;
5173   
5174  put 'set fdc(fd) "Final demand accounts with CES expenditure function" /' / ;
5175  loop(fd$(not (h(fd) or tmg(fd))),
5176     put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
5177  ) ;
5178  put '/ ;' / / ;
5179   
5180  if(Env ne Env,
5181     put 'set tmg(fd) "Domestic supply of trade margins services" /' / ;
5182     loop(fd$tmg(fd),
5183        put '   ', fd.tl:<maxstrlen, '     "', fd.te(fd), '"' / ;
5184     ) ;
5185     put '/ ;' / / ;
5186  ) ;
5187   
5188  put 'set r(is) "Regions" /' / /;
5189   
5190  put '   set.reg' / / ;
5191   
5192  put '/ ;' / / ;
5193   
5194  put 'alias(r, rp) ; alias(r, s) ; alias(r, d) ;' / / ;
5195   
5196  put '* >>>> MUST INSERT RESIDUAL REGION (ONLY ONE)' / / ;
5197   
5198  put 'set rres(r) "Residual region" /' / ;
5199  loop(r$rres(r),
5200     put '   ', r.tl:<maxstrlen, '     "', r.te(r), '"' / ;
5201  ) ;
5202  put '/ ;' / / ;
5203   
5204  put '* >>>> MUST INSERT MUV REGIONS (ONE OR MORE)' / / ;
5205   
5206  put 'set rmuv(r) "MUV regions" /' / ;
5207  loop(r$rmuv(r),
5208     put '   ', r.tl:<maxstrlen, '     "', r.te(r), '"' / ;
5209  ) ;
5210  put '/ ;' / / ;
5211   
5212  put '* >>>> MUST INSERT MUV COMMODITIES (ONE OR MORE)' / / ;
5213   
5214  put 'set imuv(i) "MUV commodities" /' / ;
5215  if(Env eq AlterTax,
5216   
5217  *  Make all commodities MUV
5218   
5219     put '   set.comm' / / ;
5220   
5221  else
5222   
5223     loop(commf$imuvf(commf),
5224        strlen = card(commf.tl) ;
5225        put '   ', commf.tl:<strlen, '-c' / ;
5226     ) ;
5227  ) ;
5228  put '/ ;' / / ;
5229   
5230  *  Emission sets
5231   
5232  if(Env ne Env,
5233     put 'set em "Emissions" /' / ;
5234     loop(em,
5235        put '   ', em.tl:<maxstrlen, '     "', em.te(em), '"' / ;
5236     ) ;
5237     put '/ ;' / / ;
5238   
5239     put 'set emn(em) "Non-CO2 emissions" /' / ;
5240     loop(em$emn(em),
5241        put '   ', em.tl:<maxstrlen, '     "', em.te(em), '"' / ;
5242     ) ;
5243     put '/ ;' / / ;
5244   
5245     put 'alias(emn, nco2) ;' / / ;
5246  ) ;
5247   
5248  *  Aggregation sets
5249   
5250  put 'set ia "Aggregate commodities for model output" /' / ;
5251  if(Env ne Altertax,
5252     loop(commf,
5253        strlen = card(commf.tl) ;
5254        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', commf.te(commf), '"' / ;
5255     ) ;
5256     put / ;
5257     loop(ia,
5258        strlen = card(ia.tl) ;
5259        put '   ', ia.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', ia.te(ia), '"' / ;
5260     ) ;
5261  else
5262     strlen = 5 ;
5263     put '   ', 'Total':<strlen, ' ':(maxstrlen-(strlen)+5), '"Aggregation of all commodities"' / ;
5264  ) ;
5265  put '/ ;' / / ;
5266   
5267  if(Env ne Altertax,
5268     put 'set mapi(ia,i) "Mapping for aggregate commodities" /' / ;
5269     loop(commf,
5270        strlen = card(commf.tl) ;
5271        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+1), '.', commf.tl:card(commf.tl), '-c' / ;
5272     ) ;
5273     put / ;
5274     loop(mapia(ia,commf),
5275        strlen = card(ia.tl) ;
5276        put '   ', ia.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', commf.tl:card(commf.tl), '-c' / ;
5277     ) ;
5278     put '/ ;' / / ;
5279  else
5280     put 'set mapi(ia,i) "Mapping for aggregate commodities" ;' / ;
5281     put 'mapi("Total",i) = yes ;' / / ;
5282  ) ;
5283   
5284  put 'set iaa(ia) "Aggregate commodities only" ;' / ;
5285  put 'loop((i,ia)$(not sameas(i,ia)), iaa(ia) = yes ; ) ;' / / ;
5286   
5287  put 'set aga "Aggregate activities for model output" /' / ;
5288  if(Env ne Altertax,
5289     loop(actf,
5290        strlen = card(actf.tl) ;
5291        put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5293     ) ;
5294     put / ;
5295     loop(aga,
5296        strlen = card(aga.tl) ;
5297        put '   ', aga.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', aga.te(aga), '"' / ;
5298     ) ;
5299  else
5300     strlen = 5 ;
5301     put '   ', 'Total':<strlen, ' ':(maxstrlen-(strlen)+5), '"Aggregation of all activities"' / ;
5302  ) ;
5303  put '/ ;' / / ;
5304   
5305  if(Env ne Altertax,
5306     put 'set mapaga(aga,a) "Mapping for aggregate activities" /' / ;
5307     loop(actf,
5308        strlen = card(actf.tl) ;
5309        put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+1), '.', actf.tl:card(actf.tl), '-a' / ;
5311     ) ;
5312     put / ;
5313     loop(mapaga(aga,actf),
5314        strlen = card(aga.tl) ;
5315        put '   ', aga.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', actf.tl:card(actf.tl), '-a' / ;
5316     ) ;
5318     put '/ ;' / / ;
5319  else
5320     put 'set mapaga(aga,a) "Mapping for aggregate activities" ;' / ;
5321     put 'mapaga("Total",a) = yes ;' / / ;
5322  ) ;
5323   
5324  put 'set agaa(aga) "Aggregate activities only" ;' / ;
5325  put 'loop((a,aga)$(not sameas(a,aga)), agaa(aga) = yes ; ) ;' / / ;
5326   
5327  put 'set ra "Aggregate regions for emission regimes and model output" /' / ;
5328  loop(r,
5329     strlen = card(r.tl) ;
5330     put '   ', r.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', r.te(r), '"' / ;
5331  ) ;
5332  put / ;
5333  loop(ra,
5334     strlen = card(ra.tl) ;
5335     put '   ', ra.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', ra.te(ra), '"' / ;
5336  ) ;
5337  put '/ ;' / / ;
5338   
5339  put 'set mapr(ra,r) "Mapping for aggregate regions" /' / ;
5340  loop(r,
5341     strlen = card(r.tl) ;
5342     put '   ', r.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', r.tl:card(r.tl) / ;
5343  ) ;
5344  put / ;
5345  loop(mapra(ra,r),
5346     strlen = card(ra.tl) ;
5347     put '   ', ra.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', r.tl:card(r.tl) / ;
5348  ) ;
5349  put '/ ;' / / ;
5350   
5351  put 'set rra(ra) "Aggregate regions only" ;' / ;
5352  put 'loop((r,ra)$(not sameas(r,ra)), rra(ra) = yes ; ) ;' / / ;
5353   
5354  put 'set lagg "Aggregate labor for output" /' / ;
5355  loop(l,
5356     strlen = card(l.tl) ;
5357     put '   ', l.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', l.te(l), '"' / ;
5358  ) ;
5359  put / ;
5360  loop(lagg,
5361     strlen = card(lagg.tl) ;
5362     put '   ', lagg.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', lagg.te(lagg), '"' / ;
5363  ) ;
5364  put '/ ;' / / ;
5365   
5366  put 'set maplagg(lagg,l) "Mapping for aggregate regions" /' / ;
5367  loop(l,
5368     strlen = card(l.tl) ;
5369     put '   ', l.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:card(l.tl) / ;
5370  ) ;
5371  put / ;
5372  loop(maplagg(lagg,l),
5373     strlen = card(lagg.tl) ;
5374     put '   ', lagg.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:card(l.tl) / ;
5375  ) ;
5376  put '/ ;' / / ;
5377   
5378  put '* >>>> CAN CHANGE ACTIVITY MAPPING' / / ;
5379   
5380  *  !!!! FOR ALTERTAX -- ONE-TO-ONE MAPPING
5381   
5382  put 'set mapa0(a0, a) "Mapping from original activities to new activities" /' / ;
5383  if(Env eq AlterTax,
5384     loop(a,
5385        strlen = card(a.tl) ;
5386        put '   ', a.tl:<maxstrlen, '.', a.tl:<strlen, '-a' / ;
5387     ) ;
5388  else
5389     loop(mapaf(a,actf),
5390        strlen = card(a.tl) ;
5391        put '   ', a.tl:<maxstrlen, '.', actf.tl:<card(actf.tl), '-a' / ;
5392     ) ;
5393  ) ;
5394  put '/ ;' / / ;
5395   
5396  put '* >>>> CAN CHANGE COMMODITY MAPPING' / / ;
5397   
5398  *  !!!! FOR ALTERTAX -- ONE-TO-ONE MAPPING
5399   
5400  put 'set mapi0(i0, i) "Mapping from original commodities to new commodities" /' / ;
5401  if(Env eq AlterTax,
5402     loop(i,
5403        strlen = card(i.tl) ;
5404        put '   ', i.tl:<maxstrlen, '.', i.tl:<strlen, '-c' / ;
5405     ) ;
5406  else
5407     loop(mapif(i,commf),
5408        strlen = card(i.tl) ;
5409        put '   ', i.tl:<maxstrlen, '.', commf.tl:<card(commf.tl), '-c' / ;
5410     ) ;
5411  ) ;
5412  put '/ ;' / / ;
5413   
5415   
5416  put 'set var "GDP variables" /' / ;
5417  loop(var,
5418     strlen = card(var.tl) ;
5419     put '   ', var.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', var.te(var), '"' / ;
5420  ) ;
5421  put '/ ;' / / ;
5422   
5423  put 'set scen "Scenarios" /' / ;
5424  loop(scen,
5425     strlen = card(scen.tl) ;
5426     put '   ', scen.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', scen.te(scen), '"' / ;
5427  ) ;
5428  put '/ ;' / / ;
5429   
5430  put 'set ssp(scen) "SSP Scenarios" /' / ;
5431  loop(scen$ssp(scen),
5432     strlen = card(scen.tl) ;
5433     put '   ', scen.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', scen.te(scen), '"' / ;
5434  ) ;
5435  put '/ ;' / / ;
5436   
5437  put 'set mod "Models" /' / ;
5438  loop(mod,
5439     strlen = card(mod.tl) ;
5440     put '   ', mod.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', mod.te(mod), '"' / ;
5441  ) ;
5442  put '/ ;' / / ;
5443   
5444  put 'set tranche "Population cohorts" /' / ;
5445  loop(tranche,
5446     strlen = card(tranche.tl) ;
5447     put '   ', tranche.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', tranche.te(tranche), '"' / ;
5448  ) ;
5449  put '/ ;' / / ;
5450   
5451  put 'set trs(tranche) "Population cohorts" /' / ;
5452  loop(tranche$trs(tranche),
5453     strlen = card(tranche.tl) ;
5454     put '   ', tranche.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', tranche.te(tranche), '"' / ;
5455  ) ;
5456  put '/ ;' / / ;
5457   
5458  put 'set sex   "Gender categories" /' / ;
5459  loop(sex,
5460     strlen = card(sex.tl) ;
5461     put '   ', sex.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', sex.te(sex), '"' / ;
5462  ) ;
5463  put '/ ;' / / ;
5464   
5465  put 'set sexx(sex) "Gender categories excl total" /' / ;
5466  loop(sex$sexx(sex),
5467     strlen = card(sex.tl) ;
5468     put '   ', sex.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', sex.te(sex), '"' / ;
5469  ) ;
5470  put '/ ;' / / ;
5471   
5472  put 'set ed "Combined SSP/GIDD education levels" /' / ;
5473  loop(edj,
5474     strlen = card(edj.tl) ;
5475     put '   ', edj.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', edj.te(edj), '"' / ;
5476  ) ;
5477  put '/ ;' / / ;
5478   
5479  put 'set edx(ed) "Education levels excluding totals" /' / ;
5480  loop(edj$(not sameas("elevt", edj)),
5481     strlen = card(edj.tl) ;
5482     put '   ', edj.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', edj.te(edj), '"' / ;
5483  ) ;
5484  put '/ ;' / / ;
5485   
5486  *  Labor growth assumptions
5487   
5488  put 'set nsk(l) "Unskilled types for labor growth assumptions" /' / ;
5489  loop(l$(not skl(l)),
5490     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
5491  ) ;
5492  put '/ ;' / / ;
5493   
5494  put 'set skl(l)  "Skill types for labor growth assumptions" /' / ;
5495  loop(l$skl(l),
5496     put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
5497  ) ;
5498  put '/ ;' / / ;
5499   
5500  put 'set educMap(r,l,ed) "Mapping of skills to education levels" /' / ;
5501  loop(educMap(r,l,elev),
5502     strlen = card(r.tl) ;
5503     put '   ', r.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:<maxstrlen, '.', elev.tl / ;
5504  ) ;
5505  put '/ ;' / / ;
5506   
5508   
5509  *  Create sort for SAM and other purposes
5510   
5511  if(Env eq AlterTax,
5512  *  !!!! No longer need to substract 1 for CGDS
5513     order = card(a) + card(a) + card(fp) + card(stdlab) + card(r) ;
5514  else
5515     order = card(actf) + card(commf) + card(fp) + card(stdlab) + card(r) ;
5517  ) ;
5518   
5519  put 'set sortOrder / sort1*sort', order:0:0, ' / ;' / / ;
5520   
5521  put 'set mapOrder(sortOrder,is) / ' / ;
5522   
5523  order = 0 ;
5524   
5525  if(Env eq AlterTax,
5526  *  AlterTax assumes diagonality and we'll forego putting a sort order for this
5527     loop(a,
5528        order = order + 1 ;
5529        put 'sort', order:0:0, '.', a.tl:card(a.tl), '-a' / ;
5530     ) ;
5531  else
5532  *  Use the model aggregation
5533     loop(mapActSort(sortOrder,actf),
5534        order = order + 1 ;
5535        put 'sort', order:0:0, '.', actf.tl:card(actf.tl), '-a' / ;
5537     ) ;
5538  ) ;
5539   
5540  if(Env eq AlterTax,
5541  *  AlterTax assumes diagonality and we'll forego putting a sort order for this
5542     loop(a,
5543        order = order + 1 ;
5544        put 'sort', order:0:0, '.', a.tl:card(a.tl), '-c' / ;
5545     ) ;
5546  else
5547  *  Use the model aggregation
5548     loop(mapCommSort(sortOrder,commf),
5549        order = order + 1 ;
5550        put 'sort', order:0:0, '.', commf.tl:card(commf.tl), '-c' / ;
5551     ) ;
5552  ) ;
5553   
5554  loop(fp,
5555     order = order + 1 ;
5556     put 'sort', order:0:0, '.', fp.tl:card(fp.tl) / ;
5557  ) ;
5558   
5559  loop(stdlab,
5560     order = order + 1 ;
5561     put 'sort', order:0:0, '.', stdlab.tl:card(stdlab.tl) / ;
5562  ) ;
5563   
5564  loop(mapRegSort(sortOrder,r),
5565     order = order + 1 ;
5566     put 'sort', order:0:0, '.', r.tl:card(r.tl) / ;
5567  ) ;
5568   
5569  put '/ ;' / / ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makesetEnv.gms
5571  * ----------------------------------------------------------------------------------------
5572  *
5573  *  Put in additional dimensions for Envisage
5574  *
5575  * ----------------------------------------------------------------------------------------
5576   
5577  put 'set gy(is) "Government revenue streams" /' / ;
5578  put '   itax        "Indirect taxes"' / ;
5579  put '   ptax        "Production taxes"' / ;
5580  put '   vtax        "Factor taxes"' / ;
5581  put '   mtax        "Import taxes"' / ;
5582  put '   etax        "Export taxes"' / ;
5583  put '   wtax        "Waste taxes"' / ;
5584  put '   ctax        "Carbon taxes"' / ;
5585  put '   dtax        "Direct taxes"' / ;
5586  put '/ ;' / / ;
5587   
5588  put 'set itx(gy) / itax / ;' / ;
5589  put 'set ptx(gy) / ptax / ;' / ;
5590  put 'set vtx(gy) / vtax / ;' / ;
5591  put 'set mtx(gy) / mtax / ;' / ;
5592  put 'set etx(gy) / etax / ;' / ;
5593  put 'set wtx(gy) / wtax / ;' / ;
5594  put 'set ctx(gy) / ctax / ;' / ;
5595  put 'set dtx(gy) / dtax / ;' / / ;
5596   
5597  put 'set tot(is) "Total" /' / ;
5598  put '   tot         "Total for row/column sums"' / ;
5599  put '/ ;' / /;
5600   
5601  put 'set acr(a) "Crop activities" /' / ;
5602  loop(actf$acr(actf),
5603     strlen = card(actf.tl) ;
5604     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5605  ) ;
5606  put '/ ;' / / ;
5607   
5608  put 'set alv(a) "Livestock activities" /' / ;
5609  loop(actf$alv(actf),
5610     strlen = card(actf.tl) ;
5611     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5612  ) ;
5613  put '/ ;' / / ;
5614   
5615  put 'set ax(a) "All other activities" /' / ;
5616  loop(actf$(not (acr(actf) or alv(actf))),
5617     strlen = card(actf.tl) ;
5618     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5620  ) ;
5621  put '/ ;' / / ;
5622   
5623  put 'set agr(a) "Agricultural activities" /' / ;
5624  loop(actf$agr(actf),
5625     strlen = card(actf.tl) ;
5626     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5627  ) ;
5628  put '/ ;' / / ;
5629   
5630  put 'set man(a) "Manufacturing activities" /' / ;
5631  loop(actf$man(actf),
5632     strlen = card(actf.tl) ;
5633     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5634  ) ;
5636  put '/ ;' / / ;
5637   
5638  put 'set srv(a) "Service activities" /' / ;
5639  loop(actf$(not (agr(actf) or man(actf))),
5640     strlen = card(actf.tl) ;
5641     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5642  ) ;
5644  put '/ ;' / / ;
5645   
5646  put 'set aenergy(a) "Energy activities" /' / ;
5647  loop(actf$aenergy(actf),
5648     strlen = card(actf.tl) ;
5649     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5650  ) ;
5652  put '/ ;' / / ;
5653   
5654  put 'set affl(a) "Fossil fuel activities" /' / ;
5655  loop(actf$affl(actf),
5656     strlen = card(actf.tl) ;
5657     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5658  ) ;
5659  put '/ ;' / / ;
5660   
5661  put 'set aw(a) "Water services activities" /' / ;
5662  loop(actf$aw(actf),
5663     strlen = card(actf.tl) ;
5664     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5665  ) ;
5666  put '/ ;' / / ;
5667   
5668  put 'set z "Labor market zones" /' / ;
5669  loop(z,
5670     strlen = card(z.tl) ;
5671     put '   ', z.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', z.te(z), '"' / ;
5672  ) ;
5673  put '/ ;' / / ;
5674   
5675  put 'set rur(z) "Rural zone" /' / ;
5676  loop(z$rur(z),
5677     strlen = card(z.tl) ;
5678     put '   ', z.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', z.te(z), '"' / ;
5679  ) ;
5680  put '/ ;' / / ;
5681   
5682  put 'set urb(z) "Urban zone" /' / ;
5683  loop(z$urb(z),
5684     strlen = card(z.tl) ;
5685     put '   ', z.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', z.te(z), '"' / ;
5686  ) ;
5687  put '/ ;' / / ;
5688   
5689  put 'set nsg(z) "Both zones" /' / ;
5690  loop(z$nsg(z),
5691     strlen = card(z.tl) ;
5692     put '   ', z.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', z.te(z), '"' / ;
5693  ) ;
5694  put '/ ;' / / ;
5695   
5696  maxcol1 = smax(z, card(z.tl)) ;
5697  put 'set mapz(z,a) "Mapping of activities to zones" /' / ;
5698  loop(mapzf(z,actf)$(not nsg(z)),
5699     strlen = card(actf.tl) ;
5700     put '   ', z.tl:<maxcol1, '.', actf.tl:<strlen, '-a' / ;
5701  ) ;
5702  put '/ ;' / / ;
5703   
5704  put 'mapz("nsg", a) = yes ;' / / ;
5705   
5706  *  >>>>> Commodity sets and subsets
5707   
5708  put 'set frt(i) "Fertilizer commodities" /' / ;
5709  loop(commf$frt(commf),
5710     strlen = card(commf.tl) ;
5711     put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', commf.te(commf), '"' / ;
5712  ) ;
5713  put '/ ;' / / ;
5714   
5715  put 'set feed(i) "Feed commodities" /' / ;
5716  loop(commf$feed(commf),
5717     strlen = card(commf.tl) ;
5718     put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', commf.te(commf), '"' / ;
5719  ) ;
5720  put '/ ;' / / ;
5721   
5722  put 'set iw(i) "Water services commodities" /' / ;
5723  loop(commf$iw(commf),
5724     strlen = card(commf.tl) ;
5725     put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', commf.te(commf), '"' / ;
5726  ) ;
5727  put '/ ;' / / ;
5728   
5729  put 'set e(i) "Energy commodities" /' / ;
5730  loop(commf$e(commf),
5731     strlen = card(commf.tl) ;
5732     put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', commf.te(commf), '"' / ;
5733  ) ;
5734  put '/ ;' / / ;
5735   
5736  put 'set elyc(i) "Electricity commodities" /' / ;
5737  loop(commf$elyc(commf),
5738     strlen = card(commf.tl) ;
5739     put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', commf.te(commf), '"' / ;
5740  ) ;
5741  put '/ ;' / / ;
5742   
5743  put 'set fuel(e) "Fuel commodities" /' / ;
5744  loop(e$f(e),
5745     strlen = card(e.tl) ;
5746     put '   ', e.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', e.te(e), '"' / ;
5747  ) ;
5748  put '/ ;' / / ;
5749   
5750  set imga(commf) ;
5751  loop(mapi(img0,i),
5752     imga(commf)$mapif(i,commf) = yes ;
5753  ) ;
5754   
5755  put 'set img(i) "Margin commodities" /' / ;
5756  loop(commf$imga(commf),
5757     strlen = card(commf.tl) ;
5758     put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+5), '"', commf.te(commf), '"' / ;
5759  ) ;
5760  put '/ ;' / / ;
5761   
5762  put 'set k "Household commodities" /' / ;
5763  loop(k,
5764     strlen = card(k.tl) ;
5765     put '   ', k.tl:<strlen, '-k', ' ':(maxstrlen-(strlen+2)+5), '"', k.te(k), '"' / ;
5766  ) ;
5767  put '/ ;' / / ;
5768   
5769  put 'set fud(k) "Household food commodities" /' / ;
5770  loop(k$fud(k),
5771     strlen = card(k.tl) ;
5772     put '   ', k.tl:<strlen, '-k', ' ':(maxstrlen-(strlen+2)+5), '"', k.te(k), '"' / ;
5773  ) ;
5774  put '/ ;' / / ;
5775   
5776  put 'set mapk(i,k) "Mapping from i to k" /' / ;
5777  loop(mapk(commf,k),
5778     strlen = card(commf.tl) ;
5779     put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+1), '.', k.tl:card(k.tl), '-k' / ;
5780  ) ;
5781  put '/ ;' / / ;
5782   
5783  put 'set CPINDX "Categories of CPI indices" /' / ;
5784  loop(cpindx,
5785     strlen = card(cpindx.tl) ;
5786     put '   ', cpindx.tl:<strlen, ' ':(maxstrlen-(strlen+2)+5), '"', cpindx.te(cpindx), '"' / ;
5787  ) ;
5788  put '/ ;' / / ;
5789   
5790  put 'set mapCPI(cpindx,i) "Mapping from i to CPINDX" /' / ;
5791  loop(mapCPI(cpindx,commf),
5792     strlen = card(cpindx.tl) ;
5793     put '   ', cpindx.tl:<strlen, ' ':(maxstrlen-(strlen+2)+1), '.', commf.tl:card(commf.tl), '-c' / ;
5794  ) ;
5795  put '/ ;' / / ;
5796   
5797  put 'set elya(a) "Power activities" /' / ;
5798  loop(actf$elya(actf),
5799     strlen = card(actf.tl) ;
5800     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5801  ) ;
5803  put '/ ;' / / ;
5804   
5805  put 'set etd(a) "Electricity transmission and distribution activities" /' / ;
5806  loop(actf$etd(actf),
5807     strlen = card(actf.tl) ;
5808     put '   ', actf.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', actf.te(actf), '"' / ;
5809  ) ;
5810  put '/ ;' / / ;
5811   
5812  put 'set primElya(a) "Primary power activities" /' / ;
5813  loop(elya$primElya(elya),
5814     strlen = card(elya.tl) ;
5815     put '   ', elya.tl:<strlen, '-a', ' ':(maxstrlen-(strlen+2)+5), '"', elya.te(elya), '"' / ;
5816  ) ;
5818  put '/ ;' / / ;
5819   
5820  put 'set pb "Power bundles in power aggregation" /' / ;
5821  loop(pb,
5822     strlen = card(pb.tl) ;
5823     put '   ', pb.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', pb.te(pb), '"' / ;
5824  ) ;
5825  put '/ ;' / / ;
5826   
5827  put 'set mappow(pb,elya) "Mapping of power activities to power bundles" /' / ;
5828  loop(mappow(pb,elya),
5829     strlen = card(pb.tl) ;
5830     put '   ', pb.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', elya.tl:card(elya.tl), '-a' / ;
5831  ) ;
5833  put '/ ;' / / ;
5834   
5835  put 'set lb "Land bundles" /' / ;
5836  loop(lb,
5837     strlen = card(lb.tl) ;
5838     put '   ', lb.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', lb.te(lb), '"' / ;
5839  ) ;
5840  put '/ ;' / / ;
5841   
5842  put 'set lb1(lb) "First land bundle" /' / ;
5843  loop(lb$lb1(lb),
5844     strlen = card(lb.tl) ;
5845     put '   ', lb.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', lb.te(lb), '"' / ;
5846  ) ;
5847  put '/ ;' / / ;
5848   
5849  put 'set maplb(lb,a) "Mapping of activities to land bundles" /' / ;
5850  loop(maplb(lb,actf),
5851     strlen = card(lb.tl) ;
5852     put '   ', lb.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', actf.tl:card(actf.tl), '-a' / ;
5853  ) ;
5854  put '/ ;' / / ;
5855   
5856  put 'set lh "Market condition flags" /' / ;
5857  put '   lo    "Market downswing"' / ;
5858  put '   hi    "Market upswing"' / ;
5859  put '/ ;' / / ;
5860   
5861  put 'set wbnd "Aggregate water markets" /' / ;
5862  loop(wbnd,
5863     strlen = card(wbnd.tl) ;
5864     put '   ', wbnd.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', wbnd.te(wbnd), '"' / ;
5865  ) ;
5866  put '/ ;' / / ;
5867   
5868  put 'set wbnd1(wbnd) "Top level water markets" /' / ;
5869  loop(wbnd$wbnd1(wbnd),
5870     strlen = card(wbnd.tl) ;
5871     put '   ', wbnd.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', wbnd.te(wbnd), '"' / ;
5872  ) ;
5873  put '/ ;' / / ;
5874   
5875  put 'set wbnd2(wbnd) "Second level water markets" /' / ;
5876  loop(wbnd$wbnd2(wbnd),
5877     strlen = card(wbnd.tl) ;
5878     put '   ', wbnd.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', wbnd.te(wbnd), '"' / ;
5879  ) ;
5880  put '/ ;' / / ;
5881   
5882  put 'set wbndex(wbnd) "Second level water markets" /' / ;
5883  loop(wbnd$wbndex(wbnd),
5884     strlen = card(wbnd.tl) ;
5885     put '   ', wbnd.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', wbnd.te(wbnd), '"' / ;
5886  ) ;
5887  put '/ ;' / / ;
5888   
5889  put 'set mapw1(wbnd,wbnd) "Mapping of first level water bundles" /' / ;
5890  loop(mapw1(wbnd1,wbnd2),
5891     strlen = card(wbnd1.tl) ;
5892     put '   ', wbnd1.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', wbnd2.tl / ;
5893  ) ;
5894  put '/ ;' / / ;
5895   
5896  put 'set mapw2(wbnd,a) "Mapping of second level water bundle" /' / ;
5897  loop(mapw2(wbnd2,actf),
5898     strlen = card(wbnd2.tl) ;
5899     put '   ', wbnd2.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', actf.tl:card(actf.tl), '-a' / ;
5900  ) ;
5901  put '/ ;' / / ;
5902   
5903  put 'set wbnda(wbnd) "Water bundles mapped one-to-one to activities" /' / ;
5904  loop(wbnd$wbnda(wbnd),
5905     strlen = card(wbnd.tl) ;
5906     put '   ', wbnd.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', wbnd.te(wbnd), '"' / ;
5907  ) ;
5908  put '/ ;' / / ;
5909   
5910  put 'set wbndi(wbnd) "Water bundles mapped to aggregate output" /' / ;
5911  loop(wbnd$wbndi(wbnd),
5912     strlen = card(wbnd.tl) ;
5913     put '   ', wbnd.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', wbnd.te(wbnd), '"' / ;
5914  ) ;
5915  put '/ ;' / / ;
5916   
5917  put 'set NRG "Energy bundles used in model" /' / ;
5918  loop(NRG,
5919     strlen = card(nrg.tl) ;
5920     put '   ', NRG.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', NRG.te(NRG), '"' / ;
5921  ) ;
5922  put '/ ;' / / ;
5923   
5924  put 'set coa(NRG) "Coal bundle used in model" /' / ;
5925  loop(nrg$coa(NRG),
5926     strlen = card(nrg.tl) ;
5927     put '   ', NRG.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', NRG.te(NRG), '"' / ;
5928  ) ;
5929  put '/ ;' / / ;
5930   
5931  put 'set oil(NRG) "Oil bundle used in model" /' / ;
5932  loop(nrg$oil(NRG),
5933     strlen = card(nrg.tl) ;
5934     put '   ', NRG.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', NRG.te(NRG), '"' / ;
5935  ) ;
5936  put '/ ;' / / ;
5937   
5938  put 'set gas(NRG) "Gas bundle used in model" /' / ;
5939  loop(nrg$gas(NRG),
5940     strlen = card(nrg.tl) ;
5941     put '   ', NRG.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', NRG.te(NRG), '"' / ;
5942  ) ;
5943  put '/ ;' / / ;
5944   
5945  put 'set ely(NRG) "Electricity bundle used in model" /' / ;
5946  loop(nrg$ely(NRG),
5947     strlen = card(nrg.tl) ;
5948     put '   ', NRG.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', NRG.te(NRG), '"' / ;
5949  ) ;
5950  put '/ ;' / / ;
5951   
5952  put 'set mape(NRG,e) "Mapping of energy commodities to energy bundles" /' / ;
5953  loop(mape(nrg,e),
5954     strlen = card(nrg.tl) ;
5955     put '   ', nrg.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', e.tl:card(e.tl), '-c' / ;
5956  ) ;
5957  put '/ ;' / / ;
5958   
5959  put 'set pt "Price trends" / lo, mid, ref, hi / ;' / / ;
5960   
5961  put 'set em "Emission types" /' / ;
5962  loop(em,
5963     strlen = card(em.tl) ;
5964     put '   ', em.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', em.te(em), '"' / ;
5965  ) ;
5966  put '/ ;' / / ;
5967   
5968  put 'set emn(em) "Non-CO2 emission types" /' / ;
5969  loop(em$emn(em),
5970     strlen = card(em.tl) ;
5971     put '   ', em.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', em.te(em), '"' / ;
5972  ) ;
5973  put '/ ;' / / ;
5974   
5975  put 'set ghg(em) "Greenhouse gas emission types" /' / ;
5976  loop(em$ghg(em),
5977     strlen = card(em.tl) ;
5978     put '   ', em.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', em.te(em), '"' / ;
5979  ) ;
5980  put '/ ;' / / ;
5981   
5982  put 'set nghg(em) "Non greenhouse gas emission types" /' / ;
5983  loop(em$nghg(em),
5984     strlen = card(em.tl) ;
5985     put '   ', em.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', em.te(em), '"' / ;
5986  ) ;
5987  put '/ ;' / / ;
5988   
5989  put 'set emq "Emission control aggregations" /' / ;
5990  put '   CO2         "Carbon dioxide"' / ;
5991  put '   CO2e        "Carbon dioxide equivalent"' / ;
5992  put '/ ;' / / ;
5993   
5994   
5995  put 'set mapEM(emq,em) /' / ;
5996  put 'CO2.CO2' / ;
5997  put '/ ;' / / ;
5998   
5999  put 'mapEM("CO2e",em)$ghg(em) = yes ;' / / ;
6000   
6001  put 'set mapi1(i,a) "Mapping of commodities to ND1 bundle" /' / ;
6002  loop(actf$acr(actf),
6003     loop(commf$(not frt(commf) and not e(commf) and not iw(commf)),
6004        strlen = card(commf.tl) ;
6005        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+1), '.', actf.tl:card(actf.tl), '-a' / ;
6006     ) ;
6007  ) ;
6008  loop(actf$alv(actf),
6009     loop(commf$(not feed(commf) and not e(commf) and not iw(commf)),
6010        strlen = card(commf.tl) ;
6011        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+1), '.', actf.tl:card(actf.tl), '-a' / ;
6012     ) ;
6013  ) ;
6014  loop(actf$(not acr(actf) and not alv(actf)),
6015     loop(commf$(not e(commf) and not iw(commf)),
6016        strlen = card(commf.tl) ;
6017        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+1), '.', actf.tl:card(actf.tl), '-a' / ;
6018     ) ;
6019  ) ;
6020  put '/ ;' / / ;
6021   
6022  put 'set mapi2(i,a) "Mapping of commodities to ND2 bundle" /' / ;
6023  loop(actf$acr(actf),
6024     loop(commf$frt(commf),
6025        strlen = card(commf.tl) ;
6026        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+1), '.', actf.tl:card(actf.tl), '-a' / ;
6027     ) ;
6028  ) ;
6029  loop(actf$alv(actf),
6030     loop(commf$feed(commf),
6031        strlen = card(commf.tl) ;
6032        put '   ', commf.tl:<strlen, '-c', ' ':(maxstrlen-(strlen+2)+1), '.', actf.tl:card(actf.tl), '-a' / ;
6033     ) ;
6034  ) ;
6035  put '/ ;' / / ;
6036   
      put 'set var "GDP variables" /' / ;
      loop(var,
         strlen = card(var.tl) ;
         put '   ', var.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', var.te(var), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set scen "Scenarios" /' / ;
      loop(scen,
         strlen = card(scen.tl) ;
         put '   ', scen.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', scen.te(scen), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set ssp(scen) "SSP Scenarios" /' / ;
      loop(scen$ssp(scen),
         strlen = card(scen.tl) ;
         put '   ', scen.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', scen.te(scen), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set mod "Models" /' / ;
      loop(mod,
         strlen = card(mod.tl) ;
         put '   ', mod.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', mod.te(mod), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set tranche "Population cohorts" /' / ;
      loop(tranche,
         strlen = card(tranche.tl) ;
         put '   ', tranche.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', tranche.te(tranche), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set trs(tranche) "Population cohorts" /' / ;
      loop(tranche$trs(tranche),
         strlen = card(tranche.tl) ;
         put '   ', tranche.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', tranche.te(tranche), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set sex   "Gender categories" /' / ;
      loop(sex,
         strlen = card(sex.tl) ;
         put '   ', sex.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', sex.te(sex), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set sexx(sex) "Gender categories excl total" /' / ;
      loop(sex$sexx(sex),
         strlen = card(sex.tl) ;
         put '   ', sex.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', sex.te(sex), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set ed "Combined SSP/GIDD education levels" /' / ;
      loop(edj,
         strlen = card(edj.tl) ;
         put '   ', edj.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', edj.te(edj), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set edx(ed) "Education levels excluding totals" /' / ;
      loop(edj$(not sameas("elevt", edj)),
         strlen = card(edj.tl) ;
         put '   ', edj.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', edj.te(edj), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      *  Labor growth assumptions
       
      put 'set nsk(l) "Unskilled types for labor growth assumptions" /' / /;
      loop(l$(not skl(l)),
         put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set skl(l)  "Skill types for labor growth assumptions" /' / /;
      loop(l$skl(l),
         put '   ', l.tl:<maxstrlen, '     "', l.te(l), '"' / ;
      ) ;
      put '/ ;' / / ;
       
      put 'set educMap(r,l,ed) "Mapping of skills to education levels" /' / ;
      loop(educMap(r,l,elev),
         strlen = card(r.tl) ;
         put '   ', r.tl:<strlen, ' ':(maxstrlen-(strlen)+1), '.', l.tl:<maxstrlen, '.', elev.tl / ;
      ) ;
      put '/ ;' / / ;
6129   
6130  put 'set GHGCodes "GHG codes from WB WDI database" /' / ;
6131  loop(GHGCodes,
6132     strlen = card(GHGCodes.tl) ;
6133     put '   ', GHGCodes.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', GHGCodes.te(GHGCodes), '"' / ;
6134  ) ;
6135  put '/ ;' / / ;
6136   
6137  *  Initialize carbon coalitions
6138   
6139  put 'set rq(ra) "Regions submitted to an emissions cap" ;' / ;
6140  put 'rq(ra) = no ;' / / ;
6141   
6142  put 'set aets "Agent specific ETS coalitions" /' / ;
6143  loop(aets,
6144     strlen = card(aets.tl) ;
6145     put '   ', aets.tl:<strlen, ' ':(maxstrlen-(strlen+2)+5), '"', aets.te(aets), '"' / ;
6146  ) ;
6147  * put '   ', '"All"':<5, ' ':(maxstrlen-(5+2)+5), '"', 'All agents', '"' / ;
6148  put '/ ;' / / ;
6149   
6150  put 'set mapETS(aets,aa) "Mapping of agents to ETS coalitions" /' / ;
6151  loop(mapETS(aets,aa),
6152     strlen = card(aets.tl) ;
6153     if(sum(actf$sameas(actf,aa), 1),
6154        put '   ', aets.tl:<strlen, ' ':(maxstrlen-(strlen+2)+1), '.', aa.tl:card(aa.tl), '-a' / ;
6155     else
6156        put '   ', aets.tl:<strlen, ' ':(maxstrlen-(strlen+2)+1), '.', aa.tl:card(aa.tl) / ;
6157     ) ;
6158  ) ;
6159  put '/ ;' /
6160  put 'mapETS("All", aa) = yes ;' / / ;
6161     putclose fsetMod ;
6162   
6164   
6165  * --------------------------------------------------------------------------------------------------
6166  *
6167  *  Aggregate the elasticities for the Env model
6168  *
6169  * --------------------------------------------------------------------------------------------------
6170   
6172   
6173  *  Set first param to 1 to override GTAP parameters
6174  *  Set second param to 1 to override GTAP income elasticities
6175   
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggEnvElast.gms
6177  * ------------------------------------------------------------------------------
6178  *
6179  *  Aggregate the parameters
6180  *
6181  * ------------------------------------------------------------------------------
6182   
6183  sets
6184     v     "Vintages"     / Old, New /
6185  ;
6186   
6187  alias(l0, lab) ; alias(cap0, capt) ; alias(lnd0, land) ; alias(nrf0, ntrs) ;alias(e0, erg) ;
6188   
6189  *  To override GTAP parameters set following two flags to 1
6190   
6191  scalars
6192     OVRRIDEGTAPARM    / 1 /
6193     OVRRIDEGTAPINC    / 1 /
6194  ;
6195   
6196  parameters
6197   
6198  *  Production elasticities
6199   
6200     sigmaxp(r0,a0,v)        "CES between GHG and XP"
6201     sigmap(r0,a0,v)         "CES between ND1 and VA"
6202     sigmav(r0,a0,v)         "CES between LAB1 and VA1 in crops and other, VA1 and VA2 in livestock"
6203     sigmav1(r0,a0,v)        "CES between ND2 (fert) and VA2 in crops, LAB1 and KEF in livestock and land and KEF in other"
6204     sigmav2(r0,a0,v)        "CES between land and KEF in crops, land and ND2 (feed) in livestock. Not used in other"
6205     sigmakef(r0,a0,v)       "CES between KF and NRG"
6206     sigmakf(r0,a0,v)        "CES between KSW and NRF"
6207     sigmakw(r0,a0,v)        "CES between KS and XWAT"
6208     sigmak(r0,a0,v)         "CES between LAB2 and K"
6209     sigmaul(r0,a0)          "CES across unskilled labor"
6210     sigmasl(r0,a0)          "CES across skilled labor"
6211     sigman1(r0,a0)          "CES across intermediate demand in ND1 bundle"
6212     sigman2(r0,a0)          "CES across intermediate demand in ND2 bundle"
6213     sigmawat(r0,a0)         "CES across intermediate demand in WAT bundle"
6214     sigmae(r0,a0,v)         "CES between ELY and NELY in energy bundle"
6215     sigmanely(r0,a0,v)      "CES between COA and OLG in energy bundle"
6216     sigmaolg(r0,a0,v)       "CES between OIL and GAS in energy bundle"
6217     sigmaNRG(r0,a0,NRG,v)   "CES within each of the NRG bundles"
6218   
6219  *  Make matrix elasticities (incl. power)
6220   
6221     omegas(r0,a0)           "Make matrix transformation elasticities: one activity --> many commodities"
6222     sigmas(r0,i0)           "Make matrix substitution elasticities: one commodity produced by many activities"
6223     sigmael(r0)             "Substitution between power and distribution and transmission"
6224     sigmapow(r0)            "Substitution across power bundles"
6225     sigmapb(r0)             "Substitution across power activities within power bundles"
6226   
6227  *  Final demand elasticities
6228   
6229     incElas(r0,i0)          "Income elasticities"
6230     nu(r0)                  "Elasticity of subsitution between energy and non-energy bundles in HH consumption"
6231     nunnrg(r0)              "Substitution elasticity across non-energy commodities in the non-energy bundle"
6232     nue(r0)                 "Substitution elasticity between ELY and NELY bundle"
6233     nunely(r0)              "Substitution elasticity beteen COL and OLG bundle"
6234     nuolg(r0)               "Substitution elasticity between OIL and GAS bundle"
6235     nuNRG(r0,NRG)           "Substitution elasticity within NRG bundles"
6236     sigma_gov(r0)           "CES expenditure elasticity for government"
6237     sigma_inv(r0)           "CES expenditure elasticity for investment"
6238   
6239  *  Trade elasticities
6240   
6241     sigmam(r0,i0)           "Top level Armington elasticity"
6242     sigmaw(r0,i0)           "Second level Armington elasticity"
6243     omegax(r0,i0)           "Top level CET export elasticity"
6244     omegaw(r0,i0)           "Second level CET export elasticity"
6245     sigmamg(i0)             "CES 'Make' elasticity for intl. trade and transport services"
6246   
6247  *  Factor supply elasticities
6248   
6249     omegak(r0)              "CET capital mobility elasticity in comp. stat. model"
6250     etat(r0)                "Aggregate land supply elasticity"
6251     landMax(r0)             "Initial ratio of land maximum wrt to land use"
6252     omegat(r0)              "Land elasticity between intermed. land bundle and first land bundle"
6253     omeganlb(r0)            "Land elasticity across intermediate land bundles"
6254     omegalb(r0,lb0)         "Land elasticity within land bundles"
6255     etanrf(r0,a0)           "Natural resource supply elasticity"
6256     invElas(r0,a0)          "Dis-investment elasticity"
6257   
6258     omegam(r0)              "Elasticity of migration"
6259  ;
6260   
6261  *  Load the disaggregated elasticities
6262   
6263  execute_load "../SatAcct/EnvLinkElast10APOW.gdx"
6264     sigmaxp=sigmaxp0, sigmap=sigmap0, sigman1=sigman10, sigman2=sigman20, sigmawat=sigmawat0,
6265     sigmav=sigmav0, sigmav1=sigmav10, sigmav2=sigmav20,
6266     sigmakef=sigmakef0, sigmakf=sigmakf0, sigmakw=sigmakw0, sigmak=sigmak0,
6267     sigmaul=sigmaul0, sigmasl=sigmasl0,
6268     sigmae=sigmae0, sigmanely=sigmanely0, sigmaolg=sigmaolg0, sigmaNRG=sigmaNRG0
6269     omegas=omegas0, sigmas=sigmas0,
6270     sigmael=sigmael0, sigmapow=sigmapow0, sigmapb=sigmapb0,
6271     incElas=incElas0, nu=nu0, nunnrg=nunnrg0,nue=nue0, nunely=nunely0, nuolg=nuolg0, nuNRG=nuNRG0
6272     sigma_gov=sigma_gov0, sigma_inv=sigma_inv0
6273     sigmam=sigmam0, sigmaw=sigmaw0, omegax=omegax0, omegaw=omegaw0, sigmamg=sigmamg0
6274     omegak=omegak0, invElas=invElas0, etat=etat0, landMax=landMax0,
6275     omegat=omegat0, omeganlb=omeganlb0, omegalb=omegalb0,
6276     etanrf=etanrf0, omegam=omegam0
6277  ;
6278  display sigmaNRG ;
6279   
6280  parameters
6281   
6282  *  Production elasticities
6283   
6284     sigmaxp0(r,actf,v)      "CES between GHG and XP"
6285     sigmap0(r,actf,v)       "CES between ND1 and VA"
6286     sigmav0(r,actf,v)       "CES between LAB1 and VA1 in crops and other, VA1 and VA2 in livestock"
6287     sigmav10(r,actf,v)      "CES between ND2 (fert) and VA2 in crops, LAB1 and KEF in livestock and land and KEF in other"
6288     sigmav20(r,actf,v)      "CES between land and KEF in crops, land and ND2 (feed) in livestock. Not used in other"
6289     sigmakef0(r,actf,v)     "CES between KF and NRG"
6290     sigmakf0(r,actf,v)      "CES between KSW and NRF"
6291     sigmakw0(r,actf,v)      "CES between KS and XWAT"
6292     sigmak0(r,actf,v)       "CES between LAB2 and K"
6293     sigmaul0(r,actf)        "CES across unskilled labor"
6294     sigmasl0(r,actf)        "CES across skilled labor"
6295     sigman10(r,actf)        "CES across intermediate demand in ND1 bundle"
6296     sigman20(r,actf)        "CES across intermediate demand in ND2 bundle"
6297     sigmawat0(r,actf)       "CES across intermediate demand in XWAT bundle"
6298     sigmae0(r,actf,v)       "CES between ELY and NELY in energy bundle"
6299     sigmanely0(r,actf,v)    "CES between COA and OLG in energy bundle"
6300     sigmaolg0(r,actf,v)     "CES between OIL and GAS in energy bundle"
6301     sigmaNRG0(r,actf,NRG,v) "CES within each of the NRG bundles"
6302   
6303  *  Make matrix elasticities (incl. power)
6304   
6305     omegas0(r,actf)         "Make matrix transformation elasticities: one activity --> many commodities"
6306     sigmas0(r,commf)        "Make matrix substitution elasticities: one commodity produced by many activities"
6307     sigmael0(r,elyc)        "Substitution between power and distribution and transmission"
6308     sigmapow0(r,elyc)       "Substitution across power bundles"
6309     sigmapb0(r,pb,elyc)     "Substitution across power activities within power bundles"
6310   
6311  *  Final demand elasticities
6312   
6313     incElas0(k,r)           "Income elasticities"
6314     nu0(r,k,h)              "Elasticity of subsitution between energy and non-energy bundles in HH consumption"
6315     nunnrg0(r,k,h)          "Substitution elasticity across non-energy commodities in the non-energy bundle"
6316     nue0(r,k,h)             "Substitution elasticity between ELY and NELY bundle"
6317     nunely0(r,k,h)          "Substitution elasticity beteen COL and OLG bundle"
6318     nuolg0(r,k,h)           "Substitution elasticity between OIL and GAS bundle"
6319     nuNRG0(r,k,h,NRG)       "Substitution elasticity within NRG bundles"
6320     sigmafd0(r,fd)          "CES expenditure elasticity for other final demand"
6321   
6322  *  Trade elasticities
6323   
6324     sigmam0(r,commf)        "Top level Armington elasticity"
6325     sigmaw0(r,commf)        "Second level Armington elasticity"
6326     omegax0(r,commf)        "Top level CET export elasticity"
6327     omegaw0(r,commf)        "Second level CET export elasticity"
6328     sigmamg0(commf)         "CES 'Make' elasticity for intl. trade and transport services"
6329   
6330  *  Factor supply elasticities
6331   
6332     omegak0(r)              "CET capital mobility elasticity in comp. stat. model"
6333     etat0(r)                "Aggregate land supply elasticity"
6334     landMax00(r)            "Initial ratio of land maximum wrt to land use"
6335     omegat0(r)              "Land elasticity between intermed. land bundle and first land bundle"
6336     omeganlb0(r)            "Land elasticity across intermediate land bundles"
6337     omegalb0(r,lb)          "Land elasticity within land bundles"
6338     etanrf0(r,actf)         "Natural resource supply elasticity"
6339     invElas0(r,actf)        "Dis-investment elasticity"
6340   
6341     omegam0(r,l)            "Elasticity of migration"
6342  ;
6343   
6344  *  Calculate weights
6345  *  !!!! NEED TO REVIEW AGGREGATION AND WEIGHTS
6346   
6347  Parameters
6348     xp0(r0,a0)        Production weights
6349     xpp0(r0,elya0)    Power production weights
6350     va0(r0,a0)        VA weights
6351     kap0(r0,a0)       K weights
6352     lab0(r0,a0)       Total labor weights
6353     nrg0(r0,a0)       Total energy weights
6354     nd0(r0,a0)        Intermediate weights
6355     nrg0(r0,a0)       Energy weights
6356     denom             Working variable
6357  ;
6358   
6359  xp0(r0,a0)  = voa(a0,r0) ;
6360  va0(r0,a0)  = sum(endw, evfp(endw, a0, r0)) ;
6361  lab0(r0,a0) = sum(l0, evfp(l0,a0,r0)) ;
6362  kap0(r0,a0) = sum(cap0, evfp(cap0, a0, r0)) ;
6363   
6364  *  Production elasticities
6365   
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6367  loop((r,actf),
6368     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), xp0(r0,a0)) ;
6369     sigmaxp0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), xp0(r0,a0)*sigmaxp(r0,a0,v))/denom
       ;
6370  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6372  loop((r,actf),
6373     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), xp0(r0,a0)) ;
6374     sigmap0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), xp0(r0,a0)*sigmap(r0,a0,v))/denom ;
6375  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6377  loop((r,actf),
6378     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)) ;
6379     sigmav0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)*sigmav(r0,a0,v))/denom ;
6380  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6382  loop((r,actf),
6383     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)) ;
6384     sigmav0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)*sigmav(r0,a0,v))/denom ;
6385  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6387  loop((r,actf),
6388     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)) ;
6389     sigmav10(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)*sigmav1(r0,a0,v))/denom
       ;
6390  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6392  loop((r,actf),
6393     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)) ;
6394     sigmav10(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)*sigmav2(r0,a0,v))/denom
       ;
6395  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6397  loop((r,actf),
6398     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)) ;
6399     sigmakef0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)*sigmakef(r0,a0,v))/den
      om ;
6400  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6402  loop((r,actf),
6403     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)) ;
6404     sigmakf0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)*sigmakf(r0,a0,v))/denom
       ;
6405  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6407  loop((r,actf),
6408     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)) ;
6409     sigmakf0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)*sigmakw(r0,a0,v))/denom
       ;
6410  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6412  loop((r,actf),
6413     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)) ;
6414     sigmak0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), va0(r0,a0)*sigmak(r0,a0,v))/denom ;
6415  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
6417  loop((r,actf),
6418     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), lab0(r0,a0)) ;
6419     sigmaul0(r,actf)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), lab0(r0,a0)*sigmaul(r0,a0))/denom ;
6420  ) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
6422  loop((r,actf),
6423     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), lab0(r0,a0)) ;
6424     sigmasl0(r,actf)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), lab0(r0,a0)*sigmasl(r0,a0))/denom ;
6425  ) ;
6426   
6427  nd0(r0,a0) = sum((i0,i,commf)$(mapi(i0,i) and mapif(i, commf) and not frt(commf) and not e(commf)), vdfp(i0,a0,r0) + vmfp(i0,a
      0,r0))$acr0(a0)
6428             + sum((i0,i,commf)$(mapi(i0,i) and mapif(i, commf) and not feed(commf) and not e(commf)), vdfp(i0,a0,r0) + vmfp(i0,
      a0,r0))$alv0(a0)
6429             + sum((i0,i,commf)$(mapi(i0,i) and mapif(i, commf) and not e(commf)), vdfp(i0,a0,r0) + vmfp(i0,a0,r0))$(not acr0(a0
      ) and not alv0(a0))
6430             ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
6432  loop((r,actf),
6433     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nd0(r0,a0)) ;
6434     sigman10(r,actf)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nd0(r0,a0)*sigman1(r0,a0))/denom ;
6435  ) ;
6436   
6437  nd0(r0,a0) = sum((i0,i,commf)$(mapi(i0,i) and mapif(i, commf) and frt(commf)), vdfp(i0,a0,r0) + vmfp(i0,a0,r0))$acr0(a0)
6438             + sum((i0,i,commf)$(mapi(i0,i) and mapif(i, commf) and feed(commf)), vdfp(i0,a0,r0) + vmfp(i0,a0,r0))$alv0(a0)
6439             + 0$(not acr0(a0) and not alv0(a0))
6440             ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
6442  loop((r,actf),
6443     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nd0(r0,a0)) ;
6444     sigman20(r,actf)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nd0(r0,a0)*sigman2(r0,a0))/denom ;
6445  ) ;
6446   
6447  nd0(r0,a0) = sum((i0,i,commf)$(mapi(i0,i) and mapif(i, commf) and iw(commf)), vdfp(i0,a0,r0) + vmfp(i0,a0,r0)) ;
6448   
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
6450  loop((r,actf),
6451     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nd0(r0,a0)) ;
6452     sigmawat0(r,actf)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nd0(r0,a0)*sigmawat(r0,a0))/denom ;
6453  ) ;
6454   
6455  nrg0(r0,a0) = sum((e0,i,e)$(mapi(e0,i) and mapif(i, e)), vdfp(e0,a0,r0) + vmfp(e0,a0,r0)) ;
6456   
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6458  loop((r,actf),
6459     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nrg0(r0,a0)) ;
6460     sigmae0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nrg0(r0,a0)*sigmae(r0,a0,v))/denom 
      ;
6461  ) ;
6462   
6463  nrg0(r0,a0) = sum((e0,i,e)$(mapi(e0,i) and mapif(i, e) and not mape("ely",e)), vdfp(e0,a0,r0) + vmfp(e0,a0,r0)) ;
6464   
6465  display nrg0, sigmanely ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6467  loop((r,actf),
6468     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nrg0(r0,a0)) ;
6469     sigmanely0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nrg0(r0,a0)*sigmanely(r0,a0,v))/
      denom ;
6470  ) ;
6471  display sigmanely0 ;
6472   
6473  nrg0(r0,a0) = sum((e0,i,e)$(mapi(e0,i) and mapif(i, e) and mape("oil",e) and mape("gas",e)), vdfp(e0,a0,r0) + vmfp(e0,a0,r0)) 
      ;
6474   
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
6476  loop((r,actf),
6477     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nrg0(r0,a0)) ;
6478     sigmaolg0(r,actf,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nrg0(r0,a0)*sigmaolg(r0,a0,v))/de
      nom ;
6479  ) ;
6480   
6481  loop(nrg,
6482     nrg0(r0,a0) = sum((e0,i,e)$(mapi(e0,i) and mapif(i, e) and mape(nrg,e)), vdfp(e0,a0,r0) + vmfp(e0,a0,r0)) ;
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrave.gms
6484  loop((r,actf),
6485     denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nrg0(r0,a0)) ;
6486     sigmaNRG0(r,actf,nrg,v)$denom = sum((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a, actf)), nrg0(r0,a0)*sigmaNRG(r0,a0,nr
      g,v))/denom ;
6487  ) ;
6488  ) ;
6489   
6490  *  Make matrix elasticities including power
6491   
6492  * !!!! There are no standard elasticities for 'make' matrix for the moment
6493   
6494  omegas0(r,actf) = 2 ;
6495  sigmas0(r,commf) = 2 ;
6496   
6497  *  !!!! There are no standard elasticities for 'power' bundle
6498   
6499  xpp0(r0,elya0) = sum(fp0, evfp(fp0, elya0, r0)) + sum(i0, vdfp(i0, elya0, r0) + vmfp(i0, elya0, r0)) ;
6500  loop((r,elyc),
6501  *  Calculate weight for power across regions
6502     denom = sum((r0,elya0)$mapr(r0,r), xpp0(r0,elya0)) ;
6503     sigmael0(r,elyc)$denom  = sum((r0,elya0)$mapr(r0,r), xpp0(r0,elya0)*sigmael(r0))/denom ;
6504     sigmapow0(r,elyc)$denom = sum((r0,elya0)$mapr(r0,r), xpp0(r0,elya0)*sigmapow(r0))/denom ;
6505     sigmapb0(r,pb,elyc)$denom = sum((r0,elya0)$mapr(r0,r), xpp0(r0,elya0)*sigmapb(r0))/denom ;
6506  ) ;
6507   
6508   
6509  *  Final demand elasticities
6510   
6511  *  Calculate the GTAP-based income elasticities
6512   
6513  Parameters
6514     b_c(k,r)       "Substitution parameter for final disaggregation"
6515     e_c(k,r)       "Expansion parameter for final disaggregation"
6516     s_c(k,r)       "Share parameter for final disaggregation"
6517     incElasG(k,r)  "GTAP income elasticity"
6518  ;
6519   
6520  alias(k,kp) ;
6521   
6522  s_c(k,r) = sum((i0,i,commf,r0)$(mapi(i0,i) and mapif(i,commf) and mapk(commf,k) and mapr(r0,r)), vdpp(i0,r0) + vmpp(i0,r0)) ;
6523  e_c(k,r)$s_c(k,r)
6524            = sum((i0,i,commf,r0)$(mapi(i0,i) and mapif(i,commf) and mapk(commf,k) and mapr(r0,r)), incPar(i0,r0)*(vdpp(i0,r0) +
       vmpp(i0,r0)))
6525            / s_c(k,r) ;
6526  b_c(k,r)$s_c(k,r)
6527            = sum((i0,i,commf,r0)$(mapi(i0,i) and mapif(i,commf) and mapk(commf,k) and mapr(r0,r)), subPar(i0,r0)*(vdpp(i0,r0) +
       vmpp(i0,r0)))
6528            / s_c(k,r) ;
6529   
6530  s_c(k,r) = s_c(k,r) / sum((i0,r0)$mapr(r0,r), vdpp(i0,r0) + vmpp(i0,r0)) ;
6531   
6532  incElasG(k,r) = (e_c(k,r)*b_c(k,r) - sum(kp, s_c(kp,r)*e_c(kp,r)*b_c(kp,r)))
6533                / sum(kp, s_c(kp,r)*e_c(kp,r))
6534                - (b_c(k,r)-1) + sum(kp, s_c(kp,r)*b_c(kp,r)) ;
6535   
6536  *  Aggregate the income elasticity in the default ENV parameter file
6537   
6538  incElas0(k,r) = sum((i0,i,commf,r0)$(mapi(i0,i) and mapif(i, commf) and mapk(commf,k) and mapr(r0,r)), vdpp(i0, r0) + vmpp(i0,
       r0)) ;
6539  incElas0(k,r)$incElas0(k,r) = sum((i0,i,commf,r0)$(mapi(i0,i) and mapif(i, commf) and mapk(commf,k) and mapr(r0,r)), incElas(r
      0,i0)*(vdpp(i0, r0) + vmpp(i0, r0)))/incElas0(k,r) ;
6540   
6541  * display b_c, e_c, s_c, incElasG, incElas0 ;
6542   
6543  if(OVRRIDEGTAPINC,
6544     incElasG(k,r) = incElas0(k,r) ;
6545  else
6546     incElas0(k,r) = incElasG(k,r) ;
6547  ) ;
6548   
6549  loop(r,
6550     denom = sum((r0,i0)$(mapr(r0,r)), vdpp(i0,r0) + vmpp(i0,r0)) ;
6551     nu0(r,k,h)$denom = sum((r0,i0)$(mapr(r0,r)), (vdpp(i0,r0) + vmpp(i0,r0))*nu(r0))/denom ;
6552     denom = sum((r0,i0)$(mapr(r0,r) and not e0(i0)), vdpp(i0,r0) + vmpp(i0,r0)) ;
6553     nunnrg0(r,k,h)$denom = sum((r0,i0)$(mapr(r0,r) and not e0(i0)), (vdpp(i0,r0) + vmpp(i0,r0))*nunnrg(r0))/denom ;
6554     denom = sum((r0,e0)$(mapr(r0,r)), vdpp(e0,r0) + vmpp(e0,r0)) ;
6555     nue0(r,k,h)$denom = sum((r0,e0)$(mapr(r0,r)), (vdpp(e0,r0) + vmpp(e0,r0))*nue(r0))/denom ;
6556     denom = sum((r0,e0,e)$(mapr(r0,r) and not mape("ely",e)), vdpp(e0,r0) + vmpp(e0,r0)) ;
6557     nunely0(r,k,h)$denom = sum((r0,e0,e)$(mapr(r0,r) and not mape("ely",e)), (vdpp(e0,r0) + vmpp(e0,r0))*nunely(r0))/denom ;
6558     denom = sum((r0,e0,e)$(mapr(r0,r) and (mape("oil",e) or mape("gas",e))), vdpp(e0,r0) + vmpp(e0,r0)) ;
6559     nuolg0(r,k,h)$denom = sum((r0,e0,e)$(mapr(r0,r) and (mape("oil",e) or mape("gas",e))), (vdpp(e0,r0) + vmpp(e0,r0))*nuolg(r0
      ))/denom ;
6560     loop(NRG,
6561        denom = sum((r0,e0,e)$(mapr(r0,r) and mape(nrg,e)), vdpp(e0,r0) + vmpp(e0,r0)) ;
6562        nuNRG0(r,k,h,NRG)$denom = sum((r0,e0,e)$(mapr(r0,r) and mape(nrg,e)), (vdpp(e0,r0) + vmpp(e0,r0))*nuNRG(r0,NRG))/denom ;
6563     ) ;
6564  ) ;
6565   
6566  loop(r,
6567  *  Government
6568     denom = sum((r0,i0)$(mapr(r0,r)), vdgp(i0,r0) + vmgp(i0,r0)) ;
6569     sigmafd0(r,gov)$denom = sum((r0,i0)$(mapr(r0,r)), (vdgp(i0,r0) + vmgp(i0,r0))*sigma_gov(r0))/denom ;
6570   
6571  *  Investment
6572     denom = sum((r0,i0)$(mapr(r0,r)), vdip(i0,r0) + vmip(i0,r0)) ;
6573     sigmafd0(r,inv)$denom = sum((r0,i0)$(mapr(r0,r)), (vdip(i0,r0) + vmip(i0,r0))*sigma_inv(r0))/denom ;
6574  ) ;
6575   
6576  *  Trade elasticities
6577   
6578  *  Top level Armington -- weight is domestic and import demand at agents' price
6579   
6580  *  !!!! NEED TO DEAL WITH NON-DIAGONAL MAKE MATRIX FOR EXAMPLE ELY-C
6581   
6582  sigmam0(r,commf) = sum((r0,i0,i)$(mapi(i0,i) and mapif(i,commf) and mapr(r0,r)),
6583     sum(a0, (vdfp(i0,a0,r0)+ vmfp(i0,a0,r0))) + (vdpp(i0,r0) + vmpp(i0,r0)) + (vdgp(i0, r0) + vmgp(i0, r0))) ;
6584   
6585  sigmam0(r,commf)$sigmam0(r,commf) = sum((r0,i0,i)$(mapi(i0,i) and mapif(i,commf) and mapr(r0,r)), sigmam(r0,i0)*
6586     (sum(a0, (vdfp(i0,a0,r0)+ vmfp(i0,a0,r0))) + (vdpp(i0,r0) + vmpp(i0,r0)) + (vdgp(i0, r0) + vmgp(i0, r0))))/sigmam0(r,commf)
       ;
6587   
6588  *  Second level Armington -- weight is import demand at agents' price
6589   
6590  sigmaw0(r,commf) = sum((r0,i0,i)$(mapi(i0,i) and mapif(i,commf) and mapr(r0,r)), sum(a0, vmfp(i0,a0,r0)) + vmpp(i0,r0) + vmgp(
      i0, r0)) ;
6591  sigmaw0(r,commf)$sigmaw0(r,commf) =
6592     sum((r0,i0,i)$(mapi(i0,i) and mapif(i,commf) and mapr(r0,r)), sigmaw(r0,i0)*(sum(a0, vmfp(i0,a0,r0)) + vmpp(i0,r0) + vmgp(i
      0, r0)))/sigmaw0(r,commf) ;
6593   
6594  *  !!!! LETS REVIEW -- We probably don't want to override here...
      if(OVRRIDEGTAPARM,
         esubd1(commf,r) = sigmam0(r,commf) ;
         esubm1(commf,r) = sigmaw0(r,commf) ;
      else
         sigmam0(r,commf) = esubd1(commf,r) ;
         sigmaw0(r,commf) = esubm1(commf,r) ;
      ) ;
6604   
6605  display omegax ;
6606  loop((r,commf),
6607   
6608  *  Top level CET -- weight is domestic demand at market price + exports at market price + exports of TT services
6609   
6610     denom = sum((r0,i0,i)$(mapi(i0,i) and mapif(i,commf) and mapr(r0,r)),
6611                 sum(a0, vdfb(i0,a0,r0)) + vdpb(i0,r0) + vdgb(i0, r0) + vdib(i0, r0) + sum(rp0, vxsb(i0,r0,rp0)))
6612           + sum((r0,marg,i)$(mapi(marg,i) and mapif(i,commf) and mapr(r0,r)), vst(marg,r0)) ;
6613     if(denom,
6614        omegax0(r,commf) = sum((r0,i0,i)$(mapi(i0,i) and mapif(i,commf) and mapr(r0,r)),
6615           (omegax(r0,i0)$(omegax(r0,i0) ne inf))*(sum(a0, vdfb(i0,a0,r0)) + vdpb(i0,r0) + vdgb(i0, r0) + vdib(i0, r0) + sum(rp0
      , vxsb(i0,r0,rp0)))
6616           +  inf$(omegax(r0,i0) eq inf))
6617           + sum((r0,marg,i)$(mapi(marg,i) and mapif(i,commf) and mapr(r0,r)), omegax(r0,marg)*vst(marg,r0)
6618           + inf$(omegax(r0,marg) eq inf)) ;
6619        if(omegax0(r,commf) ne inf,
6620           omegax0(r,commf) = omegax0(r,commf)/denom ;
6621        ) ;
6622     ) ;
6623   
6624  *  Second level CET -- weight is exports at market price
6625   
6626     denom = sum((r0,i0,i)$(mapi(i0,i) and mapif(i,commf) and mapr(r0,r)), sum(rp0, vxsb(i0,r0,rp0))) ;
6627     if(denom,
6628        omegaw0(r,commf) = sum((r0,i0,i)$(mapi(i0,i) and mapif(i,commf) and mapr(r0,r)), (omegaw(r0,i0)$(omegaw(r0,i0) ne inf))*
      sum(rp0, vxsb(i0,r0,rp0))
6629                     +    inf$(omegaw(r0,i0) eq inf)) ;
6630        if(omegaw0(r,commf) ne inf,
6631           omegaw0(r,commf) = omegaw0(r,commf)/denom ;
6632        ) ;
6633     ) ;
6634  ) ;
6635  display omegax0 ;
6636   
6637  *  Intl. trade margins 'make' elasticity -- weight is aggregate TT services
6638   
6639  sigmamg0(commf) = sum((r0,marg,i)$(mapi(marg,i) and mapif(i,commf)), vst(marg,r0)) ;
6640  sigmamg0(commf)$sigmamg0(commf) = sum((r0,marg,i)$(mapi(marg,i) and mapif(i,commf)),
6641     sigmamg(marg)*vst(marg,r0))/sigmamg0(commf) ;
6642   
6643  *  Factor supply elasticities
6644   
6645  *  Capital mobility for comp. stat. model -- weight is capital remuneration
6646   
6647  loop(r,
6648     denom = sum((r0,a0)$(mapr(r0,r)), kap0(r0,a0)) ;
6649     if(denom,
6650        omegak0(r) = sum((r0,a0)$(mapr(r0,r)), (omegak(r0)*kap0(r0,a0))$(omegak(r0) ne inf) + (inf)$(omegak(r0) eq inf)) ;
6651        if(omegak0(r) ne inf,
6652           omegak0(r) = omegak0(r)/denom ;
6653        ) ;
6654     ) ;
6655  ) ;
6656   
6657  *  Land elasticity -- weight is total land remuneration
6658   
6659  etat0(r) = sum((r0,a0,lnd0)$(mapr(r0,r)), evfp(lnd0,a0,r0)) ;
6660  etat0(r)$etat0(r) = sum((r0,a0,lnd0)$(mapr(r0,r)), etat(r0)*evfp(lnd0,a0,r0))/etat0(r) ;
6661   
6662  *  Land potential -- weight is total land remuneration
6663   
6664  landMax00(r) = sum((r0,a0,lnd0)$(mapr(r0,r)), evfp(lnd0,a0,r0)) ;
6665  landMax00(r)$landMax00(r) = sum((r0,a0,lnd0)$(mapr(r0,r)), landMax(r0)*evfp(lnd0,a0,r0))/landMax00(r) ;
6666   
6667  *  Top level land allocation elasticity -- weight is total land remuneration
6668   
6669  loop(r,
6670     denom = sum((r0,a0,lnd0)$(mapr(r0,r)), evfp(lnd0,a0,r0)) ;
6671     if(denom,
6672        omegat0(r) = sum((r0,a0,lnd0)$(mapr(r0,r)), (omegat(r0)*evfp(lnd0,a0,r0))$(omegat(r0) ne inf) + (inf)$(omegat(r0) eq inf
      )) ;
6673        if(omegat0(r) ne inf,
6674           omegat0(r) = omegat0(r)/denom ;
6675        ) ;
6676     ) ;
6677  ) ;
6678   
6679  * Intermediate land bundle -- weight is total land remuneration for land not in bundle 1
6680   
6681  loop(r,
6682     denom = sum((r0,a0,lnd0,a,actf,lb1)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf) and not maplb(lb1,actf)), evfp(lnd0,a0,r0)
      ) ;
6683     if(denom,
6684        omeganlb0(r) = sum((r0,a0,lnd0,a,actf,lb1)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf) and not maplb(lb1,actf)), omegan
      lb(r0)*evfp(lnd0,a0,r0)) ;
6685        if(omeganlb0(r) ne inf,
6686           omeganlb0(r) = omeganlb0(r)/denom ;
6687        ) ;
6688     ) ;
6689  ) ;
6690   
6691  *  Bottom level land bundles -- weight is total land remuneration of the bundles
6692   
6693  display omegalb ;
6694   
6695  loop((r,lb),
6696     denom = sum((r0,a0,lnd0,a,actf)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf) and maplb(lb,actf)), evfp(lnd0,a0,r0)) ;
6697     if(denom,
6698        omegalb0(r,lb) = sum((r0,a0,lnd0,a,actf,lb0)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf) and maplb(lb,actf) and maplb0(
      lb,lb0)), omegalb(r0,lb0)*evfp(lnd0,a0,r0)) ;
6699        if(omegalb0(r,lb) ne inf,
6700           omegalb0(r,lb) = omegalb0(r,lb)/denom ;
6701        ) ;
6702     ) ;
6703  ) ;
6704   
6705  *  Elasticity of supply of natural resources -- weight is total natl. res. remuneration
6706   
6707  loop((r,actf),
6708     denom = sum((r0,a0,nrf0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf)), evfp(nrf0,a0,r0)) ;
6709     etanrf0(r,actf)$denom = sum((r0,a0,nrf0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf)), etanrf(r0,a0)*evfp(nrf0,a0,r0))/d
      enom ;
6710  ) ;
6711   
6712  *  Dis-investment elasticity -- weight is capital remuneration
6713   
6714  display evfp ;
6715  loop((r,actf),
6716     denom = sum((r0,a0,cap0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf)), evfp(cap0,a0,r0)) ;
6717     invElas0(r,actf)$denom = sum((r0,a0,cap0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf)), invElas(r0,a0)*evfp(cap0,a0,r0))
      /denom ;
         if(0 and sameas("nuc", actf),
            put screen ;
            loop((r0,a0,a)$(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf)),
               loop(cap0,
                  put r.tl, actf.tl, r0.tl, a0.tl, evfp(cap0, a0, r0):15:9, denom:15:4, InvElas(r0,a0):10:4, invElas0(r,actf):10:4 /
       ;
               ) ;
            ) ;
         ) ;
6728  ) ;
6729   
6730  *  Migration elasticity -- weight is labor remuneration in rural activities
6731   
6732  omegam0(r,l) = sum((r0,l0,a0,a,actf,rur)
6733               $(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf) and mapzf(rur,actf) and mapf(l0,l)),
6734                    evfb(l0,a0,r0)) ;
6735  omegam0(r,l)$omegam0(r,l) = sum((r0,l0,a0,a,actf,rur)
6736               $(mapr(r0,r) and mapa(a0,a) and mapaf(a,actf) and mapzf(rur,actf) and mapf(l0,l)),
6737                    omegam(r0)*evfb(l0,a0,r0))/omegam0(r,l) ;
6738   
6739  execute_unload "ANX1/agg/ANX1Prm.gdx"
6740     sigmaxp0, sigmap0, sigman10, sigman20, sigmawat0,
6741     sigmav0, sigmav10, sigmav20,
6742     sigmakef0, sigmakf0, sigmakw0, sigmak0,
6743     sigmaul0, sigmasl0,
6744     sigmae0, sigmanely0, sigmaolg0, sigmaNRG0,
6745     omegas0, sigmas0,
6746     sigmael0, sigmapow0, sigmapb0,
6747     incElas0, e_c=eh0, b_c=bh0, nu0, nunnrg0, nue0, nunely0, nuolg0, nuNRG0, sigmafd0
6748     sigmam0, sigmaw0, omegax0, omegaw0, sigmamg0
6749     omegak0, invElas0, etat0, landMax00,
6750     omegat0, omeganlb0, omegalb0,
6751     etanrf0, omegam0
6752  ;
6753   
6754  display sigmanrg0 ;
6755   
6756  *  Prepare special sets file to convert labels in GDX file to final labels
BATINCLUDE F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makeAggSets.gms
6758  *  Save and then re-read 'final' labels
6759   
6760  file asets / tmpSets.gms / ;
6761  put asets ;
6762   
6763  put '$onempty' / / ;
6764  put 'set actf "Modeled activities" /' / ;
6765  * Use the model aggregation
6766  loop(actf,
6767     strlen = card(actf.tl) ;
6768     put '   ', actf.tl:<strlen, '':(maxstrlen-strlen), '     "', actf.te(actf), '"' / ;
6769  ) ;
6770  put '/ ;' / / ;
6771   
6772  put 'set mapact(a,actf) "Activity mapping" /' / ;
6773  loop(actf,
6774     strlen = card(actf.tl) ;
6775     put '   ', actf.tl:<strlen, '-a', '.', actf.tl / ;
6776  ) ;
6777  put '/ ;' / / ;
6778   
6779  put 'set commf "Modeled commodities" /' / ;
6780  * Use the model aggregation
6781  loop(commf,
6782     strlen = card(commf.tl) ;
6783     put '   ', commf.tl:<strlen, '':(maxstrlen-strlen), '     "', commf.te(commf), '"' / ;
6784  ) ;
6785  put '/ ;' / / ;
6786   
6787  put 'set mapcomm(i,commf) "Commodity mapping" /' / ;
6788  loop(commf,
6789     strlen = card(commf.tl) ;
6790     put '   ', commf.tl:<strlen, '-c', '.', commf.tl / ;
6791  ) ;
6792  put '/ ;' / / ;
6793   
6794  put 'set elycf(commf) "Electricity commodities" /' / ;
6795  loop(commf$elyc(commf),
6796     strlen = card(commf.tl) ;
6797     put '   ', commf.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', commf.te(commf), '"' / ;
6798  ) ;
6799  put '/ ;' / / ;
6800   
6801  put 'set kf "Household commodities" /' / ;
6802  loop(k,
6803     strlen = card(k.tl) ;
6804     put '   ', k.tl:<strlen, ' ':(maxstrlen-(strlen)+5), '"', k.te(k), '"' / ;
6805  ) ;
6806  put '/ ;' / / ;
6807   
6808  put 'set mapkcomm(k,kf) "Household commodity mapping" /' / ;
6809  loop(k,
6810     strlen = card(k.tl) ;
6811     put '   ', k.tl:<strlen, '-k', '.', k.tl / ;
6812  ) ;
6813  put '/ ;' / / ;
6814   
6815  put '$offempty' ;
6816   
6817  putclose asets ;
6818   
         file fx ;
         scalar jh, status ;
      *  Following need to be invoked at the end to do the conversion
         execute.ASync 'gams convertLabel --baseName=%baseName% -pw=150 -ps=9999' ;
         jh = JobHandle ; status = 1 ;
      *  put_utility fx 'log' / '>>> JobHandle :' jh;
         while(status = 1,
            status = JobStatus(jh);
      *     put_utility fx 'log' / '>>> Status    :' status;
         );
         abort$(status <> 2) '*** Execute.ASync gams... failed: wrong status';
         abort$errorlevel    '*** Execute.ASync gams... failed: wrong errorlevel';
6833   
6834     execute 'gams convertLabel --baseName=ANX1 -pw=150 -ps=9999' ;
6835     abort$errorlevel    '*** Execute gams... failed: wrong errorlevel';
6836   
6837  *  Delete temporary labels
6838  *  NEED TO FIX FOR UNIX
6839  *  execute 'del tmpSets.gms'
6841     execute 'del tmpSets.gms'
6843   
6845   
6846  *  Special data handling for this aggregation
6847   
6849   
6850  * --------------------------------------------------------------------------------------------------
6851  *
6852  *  Calculate the investment targets using the macro model
6853  *
6854  * --------------------------------------------------------------------------------------------------
6855   
6857   
INCLUDE    F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\macro.gms
6860   
6861  put screen ; put screen / ;
6862  scalar ifmcsv / 1 / ;
6863   
6864  set
6865     rs(r)
6866     ts(t)
6867  ;
6868   
6869  alias(r,s) ; alias(r,d) ;
6870   
6871  parameters
6872     gap(t)      "Time step"
6873     year0       "First year"
6874     yearE       "Year equilibrium is assumed"
6875     year1       "First simulation year"
6876     years(tt)   "Year values"
6877  ;
6878   
6879  year0 = smin(t, t.val) ;
6880  years(tt) = tt.val ;
6881  t0(t)$(years(t) eq year0) = yes ;
6882  singleton set t00(t) ; t00(t)$t0(t) = yes ;
6883   
6884  loop(t$te(t), yearE = years(t) ; ) ;
6885  loop(t$(not t0(t)),
6886     gap(t) = years(t) - years(t-1) ;
6887  ) ;
6888  loop((t,t0)$(years(t)-years(t0) = gap(t)),
6889     year1 = years(t) ;
6890  ) ;
6891  display years, yearE, year1, gap, year0 ;
6892   
6893  * --------------------------------------------------------------------------------------------------
6894  *
6895  *     Prepare the data
6896  *
6897  * --------------------------------------------------------------------------------------------------
6898   
6899  set is "SAM Labels" /
6900     act   "Activities"
6901     com   "Commodities"
6902     lab   "Labor"
6903     cap   "Capital"
6904     itx   "Indirect taxes"
6905     ptx   "Production taxes"
6906     etx   "Export taxes"
6907     mtx   "Import taxes"
6908     hhd   "Households"
6909     gov   "Government"
6910     inv   "Investment"
6911     row   "Rest of the world"
6912  / ;
6913  alias(is,js) ;
6914   
6915  Parameters
6916     popT(r, tranche, tssp)        "SSP-based population profiles"
6917     GDPT(r, tssp)                 "SSP-based GDP profiles"
6918     GDPpcT(r, tssp)               "SSP-based GDP per capita profiles"
6919  ;
6920   
6921  scalars
6922     pscale   "Population scale factor"  / 1e-9 /
6923     yscale   "GDP scale factor"         / 1e-12 /
6924     gscale   "GTAP scale factor"        / 1e-6 /
6925  ;
6926   
6927  Parameters
6928     tlab0(r)       "GTAP labor remuneration"
6929     tcap0(r)       "GTAP capital remuneration"
6930     gdpfc0(r)      "GTAP GDP at factor cost excl. indirect taxes"
6931     cons0(r)       "GTAP private consumption"
6932     gov0(r)        "GTAP public expenditure"
6933     inv0(r)        "GTAP investment expenditure"
6934     exp0(r)        "GTAP exports at FOB price incl. trade&transport services"
6935     imp0(r)        "GTAP imports at CIF price"
6936     gdp0(r)        "GTAP GDP at market price"
6937     abs0(r)        "Domestic absorption"
6938     ptax0(r)       "Production taxes"
6939     itax0(r)       "Indirect taxes on final demand"
6940     mtax0(r)       "Import taxes"
6941     etax0(r)       "Export taxes"
6942     save0(r)       "National savings"
6943     savf0(r)       "Capital account balance"
6944   
6945     yqtf0(r)       "Domestic profits accruing to global trust"
6946     trustY0        "Total cross border profit flows"
6947     yqht0(r)       "Receipt of foreign profits"
6948     remit0(s,r)    "Labor income in r remitted to s"
6949     ODAOut0(r)     "Outbound ODA"
6950     ODAIn0(r)      "Inbound ODA"
6951     ODAGbl0        "Total ODA"
6952   
6953     sam0(r,is,js)  "Initial SAM"
6954   
6955     kstock0(r)     "Capital stock"
6956   
6957     consshr0(r)    "Consumption share in absorption"
6958     govshr0(r)     "Government share in absorption"
6959     invShr0(r)     "Investment share in absorption"
6960     expshr0(r)     "Export share in GDP"
6961     impshr0(r)     "Import share in GDP"
6962     labShr0(r)     "Labor share in value added"
6963     capShr0(r)     "Capital share in value added"
6964     k_yRatio0(r)   "Capital output ratio"
6965  ;
6966   
6967  tlab0(r)   = gscale*sum((l,a), evfb1(l,a,r)) ;
6968  tcap0(r)   = gscale*sum((fp,a)$(not l(fp)), evfb1(fp,a,r)) ;
6969  ptax0(r)   = gscale*(sum((l,a), evfp1(l,a,r) - evfb1(l,a,r))
6970             +         sum((fp,a)$(not l(fp)), evfp1(fp,a,r) - evfb1(fp,a,r))
6971             +         sum((i,a), vdfp1(i,a,r) + vmfp1(i,a,r) - vdfb1(i,a,r) - vmfb1(i,a,r))
6972             +         sum((a,i), makb1(i,a,r) - maks1(i,a,r)))
6973             ;
6974   
6975  gdpfc0(r)  = tlab0(r) + tcap0(r) ;
6976  cons0(r)   = gscale*sum((i),  vdpp1(i,r) + vmpp1(i,r)) ;
6977  gov0(r)    = gscale*sum((i),  vdgp1(i,r) + vmgp1(i,r)) ;
6978  inv0(r)    = gscale*sum((i),  vdip1(i,r) + vmip1(i,r)) ;
6979  itax0(r)   = gscale*(sum((i), vdpp1(i,r) + vmpp1(i,r) - vdpb1(i,r) - vmpb1(i,r))
6980             +         sum((i), vdgp1(i,r) + vmgp1(i,r) - vdgb1(i,r) - vmgb1(i,r))
6981             +         sum((i), vdip1(i,r) + vmip1(i,r) - vdib1(i,r) - vmib1(i,r)))
6982             ;
6983   
6985     yqtf0(r)    = gscale*yqtf1(r) ;
6986     yqht0(r)    = gscale*yqht1(r) ;
6987     remit0(s,r) = gscale*sum(l, remit1(l,s,r)) ;
6988   
6989     ODAOut0(r)  = gscale*ODAOut1(r) ;
6990     ODAIn0(r)   = gscale*ODAIn1(r) ;
6992   
6993  trustY0      = sum(r, yqtf0(r)) ;
6994  ODAGbl0      = sum(r, ODAOut0(r)) ;
6995   
6996  exp0(r)    = gscale*(sum((i,d), vfob1(i,r,d)) + sum((i), vst1(i,r))) ;
6997  etax0(r)   = gscale*(sum((i,d), vfob1(i,r,d) - vxsb1(i,r,d))) ;
6998  imp0(r)    = gscale*sum((i,s), vcif1(i,s,r)) ;
6999  mtax0(r)   = gscale*sum((i,s), vmsb1(i,s,r) - vcif1(i,s,r)) ;
7000  abs0(r)    = cons0(r) + gov0(r) + inv0(r) ;
7001  gdp0(r)    = abs0(r) + exp0(r) - imp0(r) ;
7002  savf0(r)   = imp0(r) - exp0(r)
7003             + yqtf0(r) - yqht0(r)
7004             + sum(s, remit0(s,r)) - sum(s, remit0(r,s))
7005             + odaOut0(r) - ODAIn0(r) ;
7006  save0(r)   = inv0(r) - savf0(r) ;
7007  kstock0(r) = gscale*(vkb1(r)) ;
7008   
7009  * display tlab0, tcap0, cons0, gov0, inv0, exp0, imp0, abs0, gdp0, kstock0 ;
7010   
7011  labShr0(r)   = tlab0(r) / gdpfc0(r) ;
7012  capShr0(r)   = tcap0(r) / gdpfc0(r) ;
7013  consShr0(r)  = cons0(r) / abs0(r) ;
7014  govShr0(r)   = gov0(r) / abs0(r) ;
7015  invShr0(r)   = inv0(r) / abs0(r) ;
7016  k_yRatio0(r) = kstock0(r) / gdp0(r) ;
7017   
7018  expshr0(r)   = exp0(r)/gdp0(r) ;
7019  impshr0(r)   = imp0(r)/gdp0(r) ;
7020   
7021  sam0(r,"Lab","Act") = tlab0(r) ;
7022  sam0(r,"Cap","Act") = tcap0(r) ;
7023  sam0(r,"ptx","Act") = ptax0(r) ;
7024  sam0(r,"Act","Com") = tlab0(r) + tcap0(r) + ptax0(r) ;
7025  sam0(r,"itx","Com") = itax0(r) ;
7026  sam0(r,"etx","Com") = etax0(r) ;
7027  sam0(r,"mtx","Com") = mtax0(r) ;
7028  sam0(r,"row","Com") = imp0(r) ;
7029  sam0(r,"hhd","lab") = tlab0(r) - sum(s, remit0(s,r)) ;
7030  sam0(r,"row","lab") = sum(s, remit0(s,r)) ;
7031  sam0(r,"hhd","cap") = tcap0(r) - yqtf0(r) ;
7032  sam0(r,"hhd","ptx") = ptax0(r) ;
7033  sam0(r,"hhd","itx") = itax0(r) ;
7034  sam0(r,"hhd","etx") = etax0(r) ;
7035  sam0(r,"hhd","mtx") = mtax0(r) ;
7036  sam0(r,"hhd","row") = yqht0(r) + sum(s, remit0(r,s)) + ODAIn0(r) ;
7037  sam0(r,"row","HHD") = ODAOut0(r) ;
7038  sam0(r,"row","cap") = yqtf0(r) ;
7039  sam0(r,"com","hhd") = cons0(r) + gov0(r) ;
7040  sam0(r,"com","inv") = inv0(r) ;
7041  sam0(r,"com","row") = exp0(r) ;
7042  sam0(r,"inv","hhd") = save0(r) ;
7043  sam0(r,"inv","row") = imp0(r) - exp0(r)
7044                      + yqtf0(r) - yqht0(r)
7045                      + sum(s, remit0(s,r)) - sum(s, remit0(r,s))
7046                      + ODAOut0(r) - ODAIn0(r) ;
7047   
7048  put msamcsv ;
7049  if(ifmcsv,
7050     put "SSP,Mod,Region,RLab,CLab,Year,Value" / ;
7051     msamcsv.pc=5 ;
7052     msamcsv.nd=9 ;
7053   
7054     loop((r,is,js)$sam0(r,is,js),
7055        put "SSP2", "OECD", r.tl, is.tl, js.tl, 0:4:0, (sam0(r,is,js)/gscale) / ;
7056     ) ;
7057  ) ;
7058   
7059  * --------------------------------------------------------------------------------------------------
7060  *
7061  *  Declare model variables, parameters and equations
7062  *
7063  * --------------------------------------------------------------------------------------------------
7064   
7065  variables
7066  *  Endogenous variables
7067   
7068     wage(r,t)            "Wage rate"
7069     rent(r,t)            "Rental rate"
7070     x(r,t)               "Gross output"
7071   
7072     taxrev(r,t)          "Aggregate tax revenues"
7073     yqtfv(r,t)           "Domestic profits accruing to global trust"
7074     trustY(t)            "Total cross border profit flows"
7075     yqhtv(r,t)           "Receipt of foreign profits"
7076     remitv(s,r,t)        "Remitances in r transferred to s"
7077     ODAOutv(r,t)         "Outbound ODA"
7078     ODAInv(r,t)          "Inbound ODA"
7079     ODAGbl(t)            "Total ODA"
7080   
7081     yh(r,t)              "Household income"
7082   
7083     htax(r,t)            "Direct tax on households"
7084     cons(r,t)            "Household consumption"
7085     govt(r,t)            "Government consumption"
7086     chig(r,t)            "Government expenditure as a share of real GDP"
7087     savg(r,t)            "Government savings"
7088     chis(r,t)            "Government savings as a share nominal GDP"
7089   
7090     invt(r,t)            "Investment level"
7091     aps(r,t)             "Savings rate"
7092     xa(r,t)              "Domestic absorption"
7093   
7094     xd(r,t)              "Domestic absorption of domestically goods"
7095     xm(r,t)              "Imports"
7096     pa(r,t)              "Armington price tax inclusive"
7097   
7098     pd(r,t)              "Price of domestic goods"
7099     xe(r,t)              "Exports"
7100     px(r,t)              "Unit cost"
7101   
7102     pe(r,t)              "Export price in LCU tax exclusive"
7103     pm(r,t)              "CIF Import price in LCU"
7104   
7105     kap(r,t)             "Capital stock"
7106   
7107     gdp(r,t)             "Nominal GDP"
7108     rgdp(r,t)            "Real GDP"
7109     pgdp(r,t)            "GDP price deflator"
7110   
7111     walras(r,t)          "Walras' law"
7112     obj                  "Objective function"
7113   
7114  *  Closure variables
7115   
7116     tfp(r,t)             "TFP"
7117     lambdal(r,t)         "Labor-biased technical change"
7118     lambdak(r,t)         "Capital-biased technical change"
7119   
7120  *  Numéraire and exogenous prices
7121   
7122     p(r,t)               "Output price"
7123     exr(r,t)             "Exchange rate"
7124     pwe(r,t)             "Export price in FCU"
7125     pwm(r,t)             "Import price in FCU"
7126     pwebar(r,t)          "Export price index"
7127     pwmbar(r,t)          "Import price index"
7128   
7129  *  Exogenous variables
7130   
7131     tlab(r,t)            "Labor supply"
7132     savf(r,t)            "Foreign savings"
7133   
7134     ptx(r,t)             "Output tax"
7135     itx(r,t)             "Sales tax"
7136     mtx(r,t)             "Import tax"
7137     etx(r,t)             "Export tax"
7138  ;
7139   
7140  Parameters
7141     alphal(r,t)          "Labor share parameter"
7142     alphak(r,t)          "Capital share parameter"
7143     sigma(r,t)           "Capital-labor substitution elasticity"
7144   
7145     chik(r,t)            "Share of domestic profits flowing to RoW"
7146     chit(r,t)            "Share of global cross border profit flows accruing to region r"
7147     chiRemit(s,r,t)      "Share of region r's labor income remitted to s"
7148   
7149     chiODAOut(r,t)       "Initial share of ODA wrt to GDP"
7150     chiODAIn(r,t)        "Inbound share of global ODA"
7151     etaODA(r,t)          "Elasticity of ODA donation wrt to per capita income"
7152   
7153     alphad(r,t)          "Armington domestic share parameter"
7154     alpham(r,t)          "Armington import share parameter"
7155     gammad(r,t)          "Output domestic share parameter"
7156     gammae(r,t)          "Output export share parameter"
7157     chim(r,t)            "Import supply shifter"
7158     chie(r,t)            "Export supply shifter"
7159   
7160     sigmat(r,t)          "Armington CES elasticity"
7161     omega(r,t)           "Output CET elasticity"
7162   
7163     etam(r,t)            "Import supply elasticity"
7164     etae(r,t)            "Export demand elasticity"
7165   
7166     depr(r,t)            "Annual depreciation rate"
7167     popw(r,t)            "Population"
7168  ;
7169   
7170  equations
7171     wageeq(r,t)          "Labor demand equation"
7172     renteq(r,t)          "Capital demand equation"
7173     xeq(r,t)             "Output equation"
7174   
7175     ODAOuteq(r,t)    "Outbound ODA"
7176     ODAIneq(r,t)     "Inbound ODA"
7177     ODAGbleq(t)      "Total ODA"
7178   
7179     taxreveq(r,t)        "Tax revenues"
7180     yqtfeq(r,t)          "Domestic profits accruing to global trust"
7181     trustYeq(t)          "Total cross border profit flows"
7182     yqhteq(r,t)          "Receipt of foreign profits"
7183     remiteq(s,r,t)       "Remittances from r to s"
7184     yheq(r,t)            "Household income"
7185     peq(r,t)             "Price of gross GDP"
7186   
7187     conseq(r,t)          "Household consumption"
7188     goveq(r,t)           "Government expenditures"
7189     savgeq(r,t)          "Government savings"
7190     htaxeq(r,t)          "Fiscal closure equation"
7191     inveq(r,t)           "Investment equation"
7192     xaeq(r,t)            "Armington demand"
7193   
7194     xddeq(r,t)           "Demand for domestic goods"
7195     xmdeq(r,t)           "Demand for imports"
7196     paeq(r,t)            "Armington price"
7197   
7198     xdseq(r,t)           "Supply of domestic goods, i.e. pd"
7199     xeseq(r,t)           "Supply of exports"
7200     pxeq(r,t)            "Price of net output"
7201   
7202     peeq(r,t)            "Price of exports"
7203     pmeq(r,t)            "Price of imports"
7204   
7205     apseq(r,t)           "Average propensity to consume"
7206     capeq(r,t)           "Capital motion equation"
7207   
7208     gdpeq(r,t)           "Nominal GDP"
7209     rgdpeq(r,t)          "Real GDP"
7210     pgdpeq(r,t)          "GDP price deflator"
7211   
7212     walraseq(r,t)        "Walras' Law"
7213     objeq                "Objective function"
7214  ;
7215   
7216  wageeq(r,t)$(rs(r) and ts(t))..
7217     tlab(r,t)*wage(r,t)**sigma(r,t) =e=
7218           alphal(r,t)*((tfp(r,t)*lambdal(r,t))**(sigma(r,t)-1))*x(r,t)*px(r,t)**sigma(r,t) ;
7219   
7220  renteq(r,t)$(rs(r) and ts(t))..
7221     kap(r,t)*rent(r,t)**sigma(r,t) =e=
7222           alphak(r,t)*((tfp(r,t)*lambdak(r,t))**(sigma(r,t)-1))*x(r,t)*px(r,t)**sigma(r,t) ;
7223   
7224  xeq(r,t)$(rs(r) and ts(t))..
7226     px(r,t) =e= ((1/tfp(r,t))*(alphal(r,t)*(wage(r,t)/lambdal(r,t))**(1-sigma(r,t))
7227              +               alphak(r,t)*(rent(r,t)/lambdak(r,t))**(1-sigma(r,t)))
7228              **  (1/(1-sigma(r,t))))
7229              $(sigma(r,t) ne 1)
7230              +  ((1/tfp(r,t))*(((wage(r,t)/(alphal(r,t)*lambdal(r,t)))**alphal(r,t))
7231              *               ((rent(r,t)/(alphak(r,t)*lambdak(r,t)))**alphak(r,t))))
7232              $(sigma(r,t) eq 1)
7233              ;
7235   
7236  peq(r,t)$(rs(r) and ts(t))..
7237     p(r,t) =e= px(r,t)*(1+ptx(r,t)) ;
7238   
7239  taxreveq(r,t)$(rs(r) and ts(t))..
7240     taxrev(r,t) =e= ptx(r,t)*px(r,t)*x(r,t)
7241                  +  itx(r,t)*pa(r,t)*xa(r,t)/(1+itx(r,t))
7242                  +  mtx(r,t)*pm(r,t)*xm(r,t)
7243                  +  etx(r,t)*pe(r,t)*xe(r,t)
7244                  +  htax(r,t)*yh(r,t)
7245                  ;
7246   
7247  *  Outflow of capital income
7248   
7249  yqtfeq(r,t)$(rs(r) and ts(t) and yqtf0(r))..
7250     yqtfv(r,t) =e= chik(r,t) * kap(r,t) * rent(r,t) ;
7251  yqtfv.fx(r,t)$(yqtf0(r) eq 0) = 0 ;
7252   
7253  *  Total outflows of capital income
7254   
7255  trustYeq(t)$(ts(t) and trustY0)..
7256     trustY(t) =e= sum(r, yqtfv(r,t)) ;
7257  trustY.fx(t)$(trustY0 eq 0) = 0 ;
7258   
7259  *  Inflow of capital income
7260   
7261  yqhteq(r,t)$(rs(r) and ts(t) and yqht0(r))..
7262     yqhtv(r,t) =e= chiT(r,t)*trustY(t) ;
7263  yqhtv.fx(r,t)$(yqht0(r) eq 0) = 0 ;
7264   
7265  remiteq(s,r,t)$(rs(r) and ts(t) and remit0(s,r))..
7266     remitv(s,r,t) =e= chiRemit(s,r,t) * tlab(r,t) * wage(r,t) ;
7267   
7268  remitv.fx(s,r,t)$(remit0(s,r) eq 0) = 0 ;
7269   
7270  $macro M_YPC(r,t)  ((rgdp(r,t) / popw(r,t))/ (rgdp(r,t00) / popw(r,t00)))
7271   
7272  *  ODA outflows
7273   
7274  ODAOuteq(r,t)$(rs(r) and ts(t) and ODAOut0(r))..
7275     ODAOutv(r,t) =e= chiODAOut(r,t)*GDP(r,t)*((rgdp(r,t) / popw(r,t))/ (rgdp(r,t00) / popw(r,t00)))**etaODA(r,t) ;
7276  ODAOutv.fx(r,t)$(ODAOut0(r) eq 0) = 0 ;
7277   
7278  *  Total ODA
7279   
7280  ODAGbleq(t)$(ts(t) and ODAGbl0)..
7281     ODAGbl(t) =e= sum(r, ODAOutv(r,t)) ;
7282  ODAGbl.fx(t)$(ODAGbl0 eq 0) = 0 ;
7283   
7284  *  ODA inflows
7285   
7286  ODAIneq(r,t)$(rs(r) and ts(t) and ODAIn0(r))..
7287     ODAInv(r,t) =e= chiODAIn(r,t)*ODAGbl(t) ;
7288  ODAInv.fx(r,t)$(ODAIn0(r) eq 0) = 0 ;
7289   
7290  yheq(r,t)$(rs(r) and ts(t))..
7291     yh(r,t) =e= px(r,t)*x(r,t)
7292              +  yqhtv(r,t) - yqtfv(r,t)
7293              +  sum(s, remitv(r,s,t)) - sum(s, remitv(s,r,t)) ;
7294   
7295  conseq(r,t)$(rs(r) and ts(t))..
7296     pa(r,t)*cons(r,t) =e= (1-aps(r,t))*yh(r,t)*(1 - htax(r,t)) ;
7297   
7298  goveq(r,t)$(rs(r) and ts(t))..
7299     govt(r,t) =e= chig(r,t)*rgdp(r,t) ;
7300   
7301  savgeq(r,t)$(rs(r) and ts(t))..
7302     savg(r,t) =e= taxrev(r,t) + odaInv(r,t) - pa(r,t)*govt(r,t) - odaOutv(r,t) ;
7303   
7304  htaxeq(r,t)$(rs(r) and ts(t))..
7305     savg(r,t) =e= chis(r,t)*gdp(r,t) ;
7306   
7307  inveq(r,t)$(rs(r) and ts(t))..
7308     pa(r,t)*invt(r,t) =e= aps(r,t)*yh(r,t)*(1 - htax(r,t)) + savg(r,t) + exr(r,t)*savf(r,t) ;
7309   
7310  xaeq(r,t)$(rs(r) and ts(t))..
7311     xa(r,t) =e= cons(r,t) + govt(r,t) + invt(r,t) ;
7312   
7313  xddeq(r,t)$(rs(r) and ts(t))..
7314     xd(r,t) =e= alphad(r,t)*xa(r,t)*(pa(r,t)/((1+itx(r,t))*pd(r,t)))**sigmat(r,t) ;
7315   
7316  xmdeq(r,t)$(rs(r) and ts(t) and alpham(r,t) ne 0)..
7317     xm(r,t) =e= alpham(r,t)*xa(r,t)*(pa(r,t)/((1+itx(r,t))*(1+mtx(r,t))*pm(r,t)))**sigmat(r,t) ;
7318   
7319  paeq(r,t)$(rs(r) and ts(t))..
7320     (pa(r,t)/(1+itx(r,t)))**(1-sigmat(r,t))
7321        =e= (alphad(r,t)*pd(r,t)**(1-sigmat(r,t))
7322         +   alpham(r,t)*((1+mtx(r,t))*pm(r,t))**(1-sigmat(r,t)))
7323         ;
7324   
7325  xdseq(r,t)$(rs(r) and ts(t))..
7326     0 =e= (xd(r,t) - gammad(r,t)*x(r,t)*(pd(r,t)/p(r,t))**omega(r,t))$(omega(r,t) ne inf)
7327        +  (pd(r,t) - p(r,t))$(omega(r,t) eq inf) ;
7328   
7329  xeseq(r,t)$(rs(r) and ts(t) and gammae(r,t) ne 0)..
7330     0 =e= (xe(r,t) - gammae(r,t)*x(r,t)*(pe(r,t)/p(r,t))**omega(r,t))$(omega(r,t) ne inf)
7331        +  (pe(r,t) - p(r,t))$(omega(r,t) eq inf) ;
7332   
7333  pxeq(r,t)$(rs(r) and ts(t))..
7334     0 =e= (p(r,t)**(1+omega(r,t)) - (gammad(r,t)*pd(r,t)**(1+omega(r,t))
7335        +                             gammae(r,t)*pe(r,t)**(1+omega(r,t))))
7336        $(omega(r,t) ne inf)
7337        +  (x(r,t) - (xd(r,t) + xe(r,t)))
7338        $(omega(r,t) eq inf)
7339        ;
7340   
7341  peeq(r,t)$(rs(r) and ts(t) and gammae(r,t) ne 0)..
7342  *  0 =e= (xe(r,t) - chie(r,t)*(exr(r,t)*pwebar(r,t)/((1+etx(r,t))*pe(r,t)))**etae(r,t))
7343  *     $(etae(r,t) ne inf)
7344     0 =e= (log(xe(r,t)) - (log(chie(r,t)) + etae(r,t)*(log(exr(r,t)*pwebar(r,t))
7345        -   log((1+etx(r,t))*pe(r,t)))))
7346        $(etae(r,t) ne inf)
7347        +  ((1+etx(r,t))*pe(r,t) - exr(r,t)*pwebar(r,t))
7348        $(etae(r,t) eq inf) ;
7349   
7350  pmeq(r,t)$(rs(r) and ts(t) and alpham(r,t) ne 0)..
7351     0 =e= (xm(r,t) - chim(r,t)*(pm(r,t)/(exr(r,t)*pwmbar(r,t)))**etam(r,t))$(etam(r,t) ne inf)
7352        +  (pm(r,t) - exr(r,t)*pwmbar(r,t))$(etam(r,t) eq inf) ;
7353   
7354  apseq(r,t)$(rs(r) and ts(t) and years(t) ge yearE)..
7355     aps(r,t) =e= aps(r,t-1) ;
7356   
7357  capeq(r,t)$(rs(r) and ts(t) and years(t) gt year0)..
7358     kap(r,t) =e= tcap0(r)$(years(t) eq year0)
7359               + (kap(r,t-1)*power(1-depr(r,t), gap(t))
7360               +  gap(t)*invt(r,t-1))$(years(t) gt year0)
7361               ;
7362   
7363  $macro VGDP(r,tp,tq) \
7364     (pa(r,tp)*cons(r,tq) + pa(r,tp)*govt(r,tq) + pa(r,tp)*invt(r,tq) + \
7365     (1+etx(r,tp))*pe(r,tp)*xe(r,tq) - pm(r,tp)*xm(r,tq))
7366   
7367  gdpeq(r,t)$(rs(r) and ts(t))..
7368     gdp(r,t) =e=  (pa(r,t)*cons(r,t) + pa(r,t)*govt(r,t) + pa(r,t)*invt(r,t) + (1+etx(r,t))*pe(r,t)*xe(r,t) - pm(r,t)*xm(r,t)) 
      ;
7369   
7370  pgdpeq(r,t)$(rs(r) and ts(t) and years(t) gt year0)..
7371     pgdp(r,t) =e= pgdp(r,t-1)*sqrt(( (pa(r,t)*cons(r,t-1) + pa(r,t)*govt(r,t-1) + pa(r,t)*invt(r,t-1) + (1+etx(r,t))*pe(r,t)*xe
      (r,t-1) - pm(r,t)*xm(r,t-1))/ (pa(r,t-1)*cons(r,t-1) + pa(r,t-1)*govt(r,t-1) + pa(r,t-1)*invt(r,t-1) + (1+etx(r,t-1))*pe(r,t-1
      )*xe(r,t-1) - pm(r,t-1)*xm(r,t-1)))*( (pa(r,t)*cons(r,t) + pa(r,t)*govt(r,t) + pa(r,t)*invt(r,t) + (1+etx(r,t))*pe(r,t)*xe(r,t
      ) - pm(r,t)*xm(r,t))/ (pa(r,t-1)*cons(r,t) + pa(r,t-1)*govt(r,t) + pa(r,t-1)*invt(r,t) + (1+etx(r,t-1))*pe(r,t-1)*xe(r,t) - pm
      (r,t-1)*xm(r,t)))) ;
7372  *  log(pgdp(r,t)) =e= log(pgdp(r,t-1))
7373  *                  + 0.5*(log(VGDP(r,t,t-1)) - log(VGDP(r,t-1,t-1))
7374  *                  + log(VGDP(r,t,t)) - log(VGDP(r,t-1,t))) ;
7375   
7376  rgdpeq(r,t)$(rs(r) and ts(t))..
7377     rgdp(r,t)*pgdp(r,t) =e= gdp(r,t) ;
7378   
7379  walraseq(r,t)$(rs(r) and ts(t))..
7380     walras(r,t) =e= exr(r,t)*savf(r,t)
7381                  +  (1+etx(r,t))*pe(r,t)*xe(r,t) - pm(r,t)*xm(r,t)
7382                  +  yqhtv(r,t) - yqtfv(r,t)
7383                  +  sum(s, remitv(r,s,t)) - sum(s, remitv(s,r,t))
7384                  +  OdaInv(r,t) - odaOutv(r,t)
7385                  ;
7386   
7387  objeq..
7388     obj =e= sum((r,t), walras(r,t))
7389          ;
7390   
7391  model macro /
7392     wageeq.wage, renteq, xeq,
7393     yqtfeq, trustYeq, yqhteq, remiteq,
7394     odaineq, odagbleq, odaouteq,
7395     taxreveq, peq, yheq,
7396     conseq, goveq, savgeq, htaxeq,
7397     inveq, xaeq, xddeq, xmdeq, paeq.pa,
7398     xdseq.pd, xeseq, pxeq,
7399     peeq.pe, pmeq.pm,
7400     apseq, capeq,
7401     gdpeq, rgdpeq, pgdpeq,
7402     walraseq, objeq,
7403  / ;
7404  macro.holdfixed = 1 ;
7405  macro.tolinfrep = 1e-6 ;
7406   
7407  *  Initialize key parameters (may want to make them region and time specific in the future)
7408   
7409  sigma(r,t)  = 1.0 ;
7410  * depr(r,t)   = %DEPR% ;
7411  sigmat(r,t) = 1.5 ;
7412  omega(r,t)  = 4 ;
7413  etam(r,t)   = inf ;
7414  etae(r,t)   = inf ;
7415   
7416  *  Initialize the economic model
7417   
7418  rgdp.l(r,t)  = gdp0(r) ;
7419  x.l(r,t)     = (tlab0(r)+tcap0(r)+ptax0(r)) ;
7420  ptx.fx(r,t)  = (tlab0(r)+tcap0(r)+ptax0(r))/(tlab0(r)+tcap0(r)) - 1 ;
7421  mtx.fx(r,t)  = (imp0(r) + mtax0(r))/imp0(r) - 1 ;
7422  etx.fx(r,t)  = exp0(r)/(exp0(r) - etax0(r)) - 1 ;
7423  itx.fx(r,t)  = (cons0(r) + gov0(r) + inv0(r))/(cons0(r) + gov0(r) + inv0(r) - itax0(r)) - 1 ;
7424  display ptx.l, mtx.l, etx.l, itx.l ;
7425   
7426  parameter rwork(r) ;
7427   
7428  *  Calculate first period growth of GDP in SSP2 scenario
7429   
7430  loop(t$t0(t),
7431     rwork(r) = gdpScen1("OECD", "SSP2", "gdp", r, t+1)/gdpScen1("OECD", "SSP2", "gdp", r, t) ;
7432  ) ;
7433   
7434  display "Pre-adjustment:", kstock0 ;
7435   
7436  *  Adjust Kstock0 so that its initial growth is equal to GDP growth
7437  *  Only if the user asks for it
7438   
7439  kadj0(r)$(kadj0(r) eq na) = (inv0(r)/kstock0(r))
7440                            / (rwork(r) - (1 - depr(r,t00))) ;
7441   
7442  kstock0(r)   = kadj0(r)*kstock0(r) ;
7443  k_yRatio0(r) = kstock0(r) / gdp0(r) ;
7444  p.l(r,t)    = 1 ;
7445  x.l(r,t)    = x.l(r,t) / p.l(r,t) ;
7446  px.l(r,t)   = p.l(r,t) / (1 + ptx.l(r,t)) ;
7447  kap.l(r,t)  = kstock0(r) ;
7448  rent.l(r,t) = capShr0(r)*px.l(r,t)*x.l(r,t)/kap.l(r,t) ;
7449   
7450  display "Post-adjustment:", kstock0, inv0, rwork, kadj0, k_yRatio0, x.l, kap.l, rent.l ;
7451   
7452  pa.l(r,t)   = 1 ;
7453  exr.l(r,t)  = 1 ;
7454  pm.l(r,t)   = 1 ;
7455  pd.l(r,t)   = p.l(r,t) ;
7456  pe.l(r,t)   = p.l(r,t) ;
7457   
7458  pwebar.l(r,t) = pe.l(r,t)*(1 + etx.l(r,t)) / exr.l(r,t) ;
7459  pwmbar.l(r,t) = pm.l(r,t) / exr.l(r,t) ;
7460  pwe.l(r,t)    = pwebar.l(r,t) ;
7461  pwm.l(r,t)    = pwmbar.l(r,t) ;
7462   
7463  xe.l(r,t)     = expshr0(r)*rgdp.l(r,t)/((1 + etx.l(r,t))*pe.l(r,t)) ;
7464  xm.l(r,t)     = impshr0(r)*rgdp.l(r,t)/pm.l(r,t) ;
7465   
7466  yqtfv.l(r,t)    = yqtf0(r) ;
7467  yqhtv.l(r,t)    = yqht0(r) ;
7468  trustY.l(t)     = trustY0 ;
7469  remitv.l(s,r,t) = remit0(s,r) ;
7470  odaInv.l(r,t)   = odaIn0(r) ;
7471  odaOutv.l(r,t)  = odaOut0(r) ;
7472  odaGBL.l(t)     = odaGBL0 ;
7473   
7474  savf.l(r,t)   = (pm.l(r,t)*xm.l(r,t) - (1 + etx.l(r,t))*pe.l(r,t)*xe.l(r,t))/exr.l(r,t)
7475                + (yqtfv.l(r,t) - yqhtv.l(r,t))
7476                + sum(s, remitv.l(s,r,t)) - sum(s, remitv.l(r,s,t))
7477                + odaOutv.l(r,t) - odaInv.l(r,t) ;
7478   
7479  pgdp.l(r,t) = 1 ;
7480  gdp.l(r,t)  = pgdp.l(r,t)*rgdp.l(r,t) ;
7481  invt.l(r,t) = (gdp.l(r,t)*inv0(r)/gdp0(r)) / pa.l(r,t) ;
7482  cons.l(r,t) = (gdp.l(r,t)*cons0(r)/gdp0(r)) / pa.l(r,t) ;
7483  govt.l(r,t) = (gdp.l(r,t)*gov0(r)/gdp0(r)) / pa.l(r,t) ;
7484   
7485  *  Trade
7486   
7487  xa.l(r,t) = invt.l(r,t) + cons.l(r,t) + govt.l(r,t) ;
7488  xd.l(r,t) = (pa.l(r,t)*xa.l(r,t)/(1+itx.l(r,t)) - (1 + mtx.l(r,t))*pm.l(r,t)*xm.l(r,t))/pd.l(r,t) ;
7489  xd.l(r,t) = (p.l(r,t)*x.l(r,t) - pe.l(r,t)*xe.l(r,t)) / pd.l(r,t) ;
7490   
7491  taxrev.l(r,t) = ptx.l(r,t)*px.l(r,t)*x.l(r,t)
7492                + itx.l(r,t)*pa.l(r,t)*xa.l(r,t)/(1+itx.l(r,t))
7493                + mtx.l(r,t)*pm.l(r,t)*xm.l(r,t)
7494                + etx.l(r,t)*pe.l(r,t)*xe.l(r,t)
7495                ;
7496   
7497  chik(r,t)         = yqtf0(r) / tcap0(r) ;
7498  chit(r,t)$trustY0 = yqht0(r) / trustY0 ;
7499  chit(r,t)$rres(r) = 1 - sum(s$(not rres(s)), chit(s,t)) ;
7500   
7501  chiRemit(s,r,t) = remit0(s,r) / tlab0(r) ;
7502  etaODA(r,t)    = 0.1 ;
7503  chiODAOut(r,t) = ODAOut0(r) / GDP.l(r,t00) ;
7504  chiODAIn(r,t)$ODAGbl0 = ODAIN0(r) / ODAGBL0 ;
7505  chiODAIn(r,t)$rres(r) = 1 - sum(s$(not rres(s)), chiODAIn(s,t)) ;
7506   
7507  yh.l(r,t)    = p.l(r,t)*x.l(r,t) - ptx.l(r,t)*px.l(r,t)*x.l(r,t)
7508               + yqhtv.l(r,t) - yqtfv.l(r,t)
7509               + sum(s, remitv.l(r,s,t)) - sum(s, remitv.l(s,r,t)) ;
7510   
7511  * !!!! MOVE SOMEWHERE ELSE
7512   
7513  parameter chis0(r) "Original public savings" ; chis0(r) = 0 ;
7514   
7515  chis.fx(r,t) = chis0(r) ;
7516  savg.l(r,t)  = chis.l(r,t)*gdp.l(r,t) ;
7517   
7518  htax.l(r,t)   = (savg.l(r,t) - taxrev.l(r,t) + (odaOutv.l(r,t) - odaInv.l(r,t)) + pa.l(r,t)*govt.l(r,t)) ;
7519  htax.l(r,t)   = htax.l(r,t) / yh.l(r,t) ;
7520   
7521  taxrev.l(r,t) = taxrev.l(r,t) + htax.l(r,t)*yh.l(r,t) ;
7522  aps.l(r,t)    = 1 - pa.l(r,t)*cons.l(r,t)/(yh.l(r,t)*(1-htax.l(r,t))) ;
7523  loop(t0,
7524     chig.fx(r,t) = govt.l(r,t0)/rgdp.l(r,t0) ;
7525  ) ;
7526   
7527  lambdal.l(r,t) = 1 ;
7528  lambdak.l(r,t) = 1 ;
7529  tfp.l(r,t)     = 1 ;
7530   
7531  *  Calibrate trade
7532   
7533  loop((r,t0),
7534     alphad(r,t) = (xd.l(r,t0)/xa.l(r,t0))*((1+itx.l(r,t0))*pd.l(r,t0)/pa.l(r,t0))**sigmat(r,t0) ;
7535     alpham(r,t) = (xm.l(r,t0)/xa.l(r,t0))*((1+itx.l(r,t0))
7536                 *     (1 + mtx.l(r,t0))*pm.l(r,t0)/pa.l(r,t0))**sigmat(r,t0) ;
7537     if(omega(r,t0) ne inf,
7538        gammad(r,t) = (xd.l(r,t0)/x.l(r,t0))*(p.l(r,t0)/pd.l(r,t0))**omega(r,t0) ;
7539        gammae(r,t) = (xe.l(r,t0)/x.l(r,t0))*(p.l(r,t0)/pe.l(r,t0))**omega(r,t0) ;
7540     else
7541        gammad(r,t) = (pd.l(r,t0)*xd.l(r,t0)/(p.l(r,t0)*x.l(r,t0))) ;
7542        gammae(r,t) = (pe.l(r,t0)*xe.l(r,t0)/(p.l(r,t0)*x.l(r,t0))) ;
7543     ) ;
7544     if(etam(r,t0) ne inf,
7545        chim(r,t) = xm.l(r,t0)*(exr.l(r,t0)*pwmbar.l(r,t0)/pm.l(r,t0))**etam(r,t0) ;
7546     ) ;
7547     if(etae(r,t0) ne inf,
7548        chie(r,t) = xe.l(r,t0)*((1+etx.l(r,t0))*pe.l(r,t0)/(exr.l(r,t0)*pwebar.l(r,t0)))**etae(r,t0) ;
7549     ) ;
7550  ) ;
7551   
7552  *  Trade closure
7553   
7554  pwmbar.fx(r,t) = pwmbar.l(r,t) ;
7555  pwebar.fx(r,t) = pwebar.l(r,t) ;
7556   
7557  parameters
7558     ydot(r,t)   "Growth of GDP"
7559     ldot(r,t)   "Growth of labor"
7560     popw(r,t)   "Population"
7561     sam(r,is,js,t)
7562     invTgt(mod,ssp,r,t)
7563  ;
7564  alias(t,tsim) ;
7565   
7566  sets
7567     ragg /
7568        set.r
7569        set.ra
7570     /
7571     mapragg(ragg,r)
7572  ;
7573   
7574  mapragg(ragg,r)$sameas(ragg,r) = yes ;
7575  loop(ra,
7576     mapragg(ragg,r)$(sameas(ra,ragg) and mapra(ra,r)) = yes ;
7577  ) ;
7578   
7579  display ragg, mapragg ;
7580   
7581  $macro mLag1(v) v.fx(r,t00) = v.l(r,t00) ;
7582  $macro mLagB(v) v.fx(s,r,t00) = v.l(s,r,t00) ;
7583  $macro mLagG(v) v.fx(t00)   = v.l(t00) ;
7584   
7585  rent.fx(r,t00) = rent.l(r,t00) ;
7586  x.fx(r,t00) = x.l(r,t00) ;
7587  p.fx(r,t00) = p.l(r,t00) ;
7588  taxRev.fx(r,t00) = taxRev.l(r,t00) ;
7589  yqtfv.fx(r,t00) = yqtfv.l(r,t00) ;
7590  trustY.fx(t00)   = trustY.l(t00) ;
7591  yqhtv.fx(r,t00) = yqhtv.l(r,t00) ;
7592  remitv.fx(s,r,t00) = remitv.l(s,r,t00) ;
7593  ODAOutv.fx(r,t00) = ODAOutv.l(r,t00) ;
7594  ODAGbl.fx(t00)   = ODAGbl.l(t00) ;
7595  ODAInv.fx(r,t00) = ODAInv.l(r,t00) ;
7596  yh.fx(r,t00) = yh.l(r,t00) ;
7597  cons.fx(r,t00) = cons.l(r,t00) ;
7598  pa.fx(r,t00) = pa.l(r,t00) ;
7599  govt.fx(r,t00) = govt.l(r,t00) ;
7600  savg.fx(r,t00) = savg.l(r,t00) ;
7601  htax.fx(r,t00) = htax.l(r,t00) ;
7602  invt.fx(r,t00) = invt.l(r,t00) ;
7603  xa.fx(r,t00) = xa.l(r,t00) ;
7604  xd.fx(r,t00) = xd.l(r,t00) ;
7605  xm.fx(r,t00) = xm.l(r,t00) ;
7606  pa.fx(r,t00) = pa.l(r,t00) ;
7607  pd.fx(r,t00) = pd.l(r,t00) ;
7608  xe.fx(r,t00) = xe.l(r,t00) ;
7609  px.fx(r,t00) = px.l(r,t00) ;
7610  pe.fx(r,t00) = pe.l(r,t00) ;
7611  pm.fx(r,t00) = pm.l(r,t00) ;
7612  aps.fx(r,t00) = aps.l(r,t00) ;
7613  kap.fx(r,t00) = kap.l(r,t00) ;
7614  gdp.fx(r,t00) = gdp.l(r,t00) ;
7615  pgdp.fx(r,t00) = pgdp.l(r,t00) ;
7616  rgdp.fx(r,t00) = rgdp.l(r,t00) ;
7617   
7618  $macro usum(v)    (sum(r$mapragg(ragg,r), v(r,t)))
7619  $macro wsum(v,w)  (sum(r$mapragg(ragg,r), w(r,t)*v(r,t)) / sum(r$mapragg(ragg,r), w(r,t)))
7620  $macro psum(v,w)  (sum(r$mapragg(ragg,r), v(r,t)) / sum(r$mapragg(ragg,r), w(r,t)))
7621   
7622  loop((mod,ssp)$((sameas(mod,"OECD") and sameas(ssp,"SSP2")) or 1),
7623   
7624     tlab.fx(r,t) = pScale*lfpr(r)*tpop1(ssp, r, "P1564", t) ;
7625     popw(r,t)    = pScale*tpop1(ssp, r, "PTOTL", t) ;
7626     wage.l(r,t)  = (1-capshr0(r))*px.l(r,t)*x.l(r,t)/tlab.l(r,t) ;
7627     wage.fx(r,t00) = wage.l(r,t00) ;
7628   
7629     display tlab.l, popw, wage.l, capshr0 ;
7630   
7631     loop(t0,
7632        alphak(r,t) = capShr0(r)*(px.l(r,t0)/rent.l(r,t0))**(1-sigma(r,t0)) ;
7633        alphal(r,t) = (1-capshr0(r))*(px.l(r,t0)/wage.l(r,t0))**(1-sigma(r,t0)) ;
7634     ) ;
7635   
7636     loop(t$(not t0(t)),
7637        rgdp.l(r,t) = rgdp.l(r,t-1)
7638                    *  gdpScen1(mod, ssp, "gdp", r, t)/gdpScen1(mod, ssp, "gdp", r, t-1) ;
7639        x.l(r,t)    = x.l(r,t-1)*gdpScen1(mod, ssp, "gdp", r, t)/gdpScen1(mod, ssp, "gdp", r, t-1) ;
7640     ) ;
7641   
7642     loop(t0,
7643        rent.fx(r,t)$(years(t) ne year1 and years(t) le yearE) = rent.l(r,t0) ;
7644        rgdp.fx(r,t) = rgdp.l(r,t) ;
7645   
7646        tfp.l(r,t) = ((1/px.l(r,t0))*(alphal(r,t0)*(wage.l(r,t0)/lambdal.l(r,t0))**(1-sigma(r,t0))
7647                   +                  alphak(r,t0)*(rent.l(r,t0)/lambdak.l(r,t0))**(1-sigma(r,t0)))
7648                   **  (1/(1-sigma(r,t0))))
7649                   $(sigma(r,t0) ne 1)
7650                   +  ((1/px.l(r,t0))*(((wage.l(r,t0)/(alphal(r,t0)*lambdal.l(r,t0)))**alphal(r,t0))
7651                   *                   ((rent.l(r,t0)/(alphak(r,t0)*lambdak.l(r,t0)))**alphak(r,t0))))
7652                   $(sigma(r,t0) eq 1)
7653     ) ;
7654   
7655     if(0,
7656        lambdal.fx(r,t) = lambdal.l(r,t) ;
7657        lambdak.fx(r,t) = lambdak.l(r,t) ;
7658     else
7659        lambdak.fx(r,t) = lambdak.l(r,t) ;
7660        tfp.fx(r,t)     = tfp.l(r,t) ;
7661     ) ;
7662   
7663     loop(t0,
7664        tcap0(r) = kap.l(r,t0) ;
7665        inv0(r)  = invt.l(r,t0) ;
7666        aps.fx(r,t0)  = aps.l(r,t0) ;
7667  *     invt.fx(r,t0) = invt.l(r,t0) ;
7668     ) ;
7669   
7670     walras.l(r,t) = exr.l(r,t)*savf.l(r,t)
7671                   +  (1+etx.l(r,t))*pe.l(r,t)*xe.l(r,t) - pm.l(r,t)*xm.l(r,t)
7672                   +  yqhtv.l(r,t) - yqtfv.l(r,t)
7673                   +  sum(s, remitv.l(r,s,t)) - sum(s, remitv.l(s,r,t))
7674                   +  OdaInv.l(r,t) - odaOutv.l(r,t)
7675                   ;
7676   
7677     walras.fx(r,t00) = walras.l(r,t00) ;
7678     obj.l = sum((r,t), walras.l(r,t)) ;
7679   
7680  *  Give a better guess for tfp, wage and cap growth
7681   
7682     loop(t$(not t0(t)),
7683        ydot(r,t) = x.l(r,t)/x.l(r,t-1) - 1 ;
7684        ldot(r,t) = tlab.l(r,t)/tlab.l(r,t) - 1 ;
7685   
7686        if(0,
7687   
7688           tfp.l(r,t)    = tfp.l(r,t-1)*(1 + (ydot(r,t) - ldot(r,t))
7689                         /  (1 + sigma(r,t)*capshr0(r)/(1-capshr0(r)))) ;
7690   
7691           wage.l(r,t) = wage.l(r,t-1)*(1 + (ydot(r,t) - ldot(r,t))
7692                       /  ((1-capshr0(r)) + sigma(r,t)*capshr0(r))) ;
7693   
7694           kap.l(r,t)  = kap.l(r,t-1)*(1 + sigma(r,t)*ydot(r,t)
7695                       - ldot(r,t)*(sigma(r,t)-1)/(1 + sigma(r,t)*capshr0(r)/(1-capshr0(r)))) ;
7696   
7697        else
7698   
7699           lambdal.l(r,t) = lambdal.l(r,t-1)*(1 + ydot(r,t) - ldot(r,t)) ;
7700   
7701           wage.l(r,t)    = wage.l(r,t-1)*(lambdal.l(r,t)/lambdal.l(r,t-1)) ;
7702   
7703           kap.l(r,t)     = kap.l(r,t-1)*(1 + ydot(r,t)) ;
7704        ) ;
7705   
7706     ) ;
7707   
7708     display tfp.l, wage.l, kap.l, lambdal.l ;
7709   
7710  *  FIX LAGS
7711   
7712     pgdp.fx(r,t0) = pgdp.l(r,t0) ;
7713   
7714  *  Macro closure
7715   
7716     if(1,
7717        px.fx(r,t)    = px.l(r,t) ;
7718     else
7719        exr.fx(r,t)   = exr.l(r,t) ;
7720     ) ;
7721   
7722     savf.fx(r,t)  = savf.l(r,t) ;
7723   
7724     xe.fx(r,t)$(gammae(r,t) eq 0) = 0 ;
7725     xm.fx(r,t)$(alpham(r,t) eq 0) = 0 ;
7726   
7727     loop((t0,t)$(not t00(t)),
7728        wage.lo(r,t) = 0.001*wage.l(r,t0) ;
7729        pa.lo(r,t) = 0.001*pa.l(r,t0) ;
7730        pd.lo(r,t) = 0.001*pd.l(r,t0) ;
7731        pe.lo(r,t) = 0.001*pe.l(r,t0) ;
7732        pm.lo(r,t) = 0.001*pm.l(r,t0) ;
7733     ) ;
7734   
7735     if(1,
7736        rs(r) = yes ;
7737        ts(t) = yes ; ts(t00) = no ;
7738        if(0,
7739           options limrow=0, limcol=0, solprint=off, iterlim=3000 ;
7740        else
7741           options limrow=3, limcol=3, solprint=off, iterlim=3000 ;
7742        ) ;
7743   
7744        if(1,
7745           solve macro using mcp ;
7746        else
7747           solve macro minimizing obj using nlp ;
7748        ) ;
7749     ) ;
7750   
7751     invTgt(mod,ssp,r,t) = 100*invt.l(r,t)/rgdp.l(r,t) ;
7752   
7753     display rent.l ;
7754   
7755     if(ifmcsv,
7756        put mcsv ;
7757        put "SSP,Mod,Var,Region,Year,Value" / ;
7758        mcsv.pc=5 ;
7759        mcsv.nd=9 ;
7760   
7762        loop((ragg,t),
7763           put ssp.tl, Mod.tl, "Wage",      ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), tlab(r,t)*wage(r,t)) / sum(r$mapragg(rag
      g,r), tlab(r,t))) / ;
7764           put ssp.tl, Mod.tl, "Rent",      ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), kap(r,t)*rent(r,t)) / sum(r$mapragg(ragg
      ,r), kap(r,t))) / ;
7765           put ssp.tl, Mod.tl, "Cap",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), kap(r,t))) / ;
7766           put ssp.tl, Mod.tl, "Lab",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), tlab(r,t))) / ;
7767           put ssp.tl, Mod.tl, "Pop",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), popw(r,t))) / ;
7768           put ssp.tl, Mod.tl, "x",         ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), x(r,t))) / ;
7769           put ssp.tl, Mod.tl, "yh",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), yh(r,t))) / ;
7770           put ssp.tl, Mod.tl, "gdp",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), gdp(r,t))) / ;
7771           put ssp.tl, Mod.tl, "rgdp",      ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), rgdp(r,t))) / ;
7772           put ssp.tl, Mod.tl, "xa",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xa(r,t))) / ;
7773           put ssp.tl, Mod.tl, "xd",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xd(r,t))) / ;
7774           put ssp.tl, Mod.tl, "xm",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xm(r,t))) / ;
7775           put ssp.tl, Mod.tl, "xe",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xe(r,t))) / ;
7776           put ssp.tl, Mod.tl, "ypc",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), rgdp(r,t)) / sum(r$mapragg(ragg,r), popw
      (r,t))) / ;
7777           put ssp.tl, Mod.tl, "Cons",      ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), cons(r,t))) / ;
7778           put ssp.tl, Mod.tl, "Gov",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), govt(r,t))) / ;
7779           put ssp.tl, Mod.tl, "Inv",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), invt(r,t))) / ;
7780           put ssp.tl, Mod.tl, "savg",      ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), savg(r,t))) / ;
7781           put ssp.tl, Mod.tl, "savf",      ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), savf(r,t))) / ;
7782           put ssp.tl, Mod.tl, "walras",    ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), walras(r,t))) / ;
7783           put ssp.tl, Mod.tl, "aps",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), yh(r,t)*aps(r,t)) / sum(r$mapragg(ragg,r
      ), yh(r,t))) / ;
7784           put ssp.tl, Mod.tl, "htax",      ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), yh(r,t)*htax(r,t)) / sum(r$mapragg(ragg,
      r), yh(r,t))) / ;
7785           put ssp.tl, Mod.tl, "tfp",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), x(r,t)*tfp(r,t)) / sum(r$mapragg(ragg,r)
      , x(r,t))) / ;
7786           put ssp.tl, Mod.tl, "p",         ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), x(r,t)*p(r,t)) / sum(r$mapragg(ragg,r), 
      x(r,t))) / ;
7787           put ssp.tl, Mod.tl, "px",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), x(r,t)*px(r,t)) / sum(r$mapragg(ragg,r),
       x(r,t))) / ;
7788           put ssp.tl, Mod.tl, "exr",       ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xe(r,t)*exr(r,t)) / sum(r$mapragg(ragg,r
      ), xe(r,t))) / ;
7789           put ssp.tl, Mod.tl, "pa",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xa(r,t)*pa(r,t)) / sum(r$mapragg(ragg,r)
      , xa(r,t))) / ;
7790           put ssp.tl, Mod.tl, "pd",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xd(r,t)*pd(r,t)) / sum(r$mapragg(ragg,r)
      , xd(r,t))) / ;
7791           put ssp.tl, Mod.tl, "pe",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xe(r,t)*pe(r,t)) / sum(r$mapragg(ragg,r)
      , xe(r,t))) / ;
7792           put ssp.tl, Mod.tl, "pm",        ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), xm(r,t)*pm(r,t)) / sum(r$mapragg(ragg,r)
      , xm(r,t))) / ;
7793           put ssp.tl, Mod.tl, "lambdal",   ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), tlab(r,t)*lambdal(r,t)) / sum(r$mapragg(
      ragg,r), tlab(r,t))) / ;
7794           put ssp.tl, Mod.tl, "lambdak",   ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), kap(r,t)*lambdak(r,t)) / sum(r$mapragg(r
      agg,r), kap(r,t))) / ;
7795           put ssp.tl, Mod.tl, "sigma",     ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), x(r,t)*sigma(r,t)) / sum(r$mapragg(ragg,
      r), x(r,t))) / ;
7796           put ssp.tl, Mod.tl, "depr",      ragg.tl, t.val:4:0, (sum(r$mapragg(ragg,r), kap(r,t)*depr(r,t)) / sum(r$mapragg(ragg
      ,r), kap(r,t))) / ;
7797        ) ;
7798   
7799        sam(r,"Lab","Act",t) = wage.l(r,t)*tlab.l(r,t) ;
7800        sam(r,"Cap","Act",t) = rent.l(r,t)*kap.l(r,t) ;
7801        sam(r,"ptx","Act",t) = ptx.l(r,t)*px.l(r,t)*x.l(r,t) ;
7802        sam(r,"Act","Com",t) = p.l(r,t)*x.l(r,t) ;
7803        sam(r,"itx","Com",t) = itx.l(r,t)*pa.l(r,t)*xa.l(r,t)/(1+itx.l(r,t)) ;
7804        sam(r,"etx","Com",t) = etx.l(r,t)*pe.l(r,t)*xe.l(r,t) ;
7805        sam(r,"mtx","Com",t) = mtx.l(r,t)*pm.l(r,t)*xm.l(r,t) ;
7806        sam(r,"ROW","Com",t) = pm.l(r,t)*xm.l(r,t) ;
7807        sam(r,"hhd","Lab",t) = wage.l(r,t)*tlab.l(r,t) - sum(s, remitv.l(s,r,t)) ;
7808        sam(r,"row","Lab",t) = sum(s, remitv.l(s,r,t)) ;
7809        sam(r,"hhd","Cap",t) = rent.l(r,t)*kap.l(r,t) - yqtfv.l(r,t) ;
7810        sam(r,"ROW","Cap",t) = yqtfv.l(r,t) ;
7811        sam(r,"gov","ptx",t) = sam(r,"ptx","act",t) ;
7812        sam(r,"gov","itx",t) = sam(r,"itx","com",t) ;
7813        sam(r,"gov","mtx",t) = sam(r,"mtx","com",t) ;
7814        sam(r,"gov","etx",t) = sam(r,"etx","com",t) ;
7815        sam(r,"Com","hhd",t) = pa.l(r,t)*cons.l(r,t) ;
7816        sam(r,"Com","gov",t) = pa.l(r,t)*govt.l(r,t) ;
7817        sam(r,"Com","inv",t) = pa.l(r,t)*invt.l(r,t) ;
7818        sam(r,"Com","row",t) = (1+etx.l(r,t))*pe.l(r,t)*xe.l(r,t) ;
7819        sam(r,"Gov","hhd",t) = htax.l(r,t)*yh.l(r,t) ;
7820        sam(r,"Inv","hhd",t) = aps.l(r,t)*yh.l(r,t)*(1-htax.l(r,t)) ;
7821        sam(r,"Inv","gov",t) = savg.l(r,t) ;
7822        sam(r,"inv","row",t) = exr.l(r,t)*savf.l(r,t) ;
7823        sam(r,"hhd","row",t) = yqhtv.l(r,t) + sum(s, remitv.l(r,s,t)) ;
7824        sam(r,"gov","row",t) = odaInv.l(r,t) ;
7825        sam(r,"row","gov",t) = odaOutv.l(r,t) ;
7826   
7827        put ssp.tl, Mod.tl, msamcsv ;
7828   
7829        loop((r,is,js,t)$sam(r,is,js,t),
7830           put ssp.tl, Mod.tl, r.tl, is.tl, js.tl, t.val:4:0, (sam(r,is,js,t)/gscale) / ;
7831        ) ;
7832   
7834     ) ;
7835   
7836  ) ;
7837   
7838  execute_unload "ANX1/fnl/ANX1InvTgt.gdx", invTgt, kadj0, depr=deprT ;
7839   
      file invf / "v:/Env10/%BaseName%/%BaseName%InvTgt.gms" / ;
      put ssp.tl, Mod.tl, invf ;
      put ssp.tl, Mod.tl, "Parameter invTarget0(r,tt) /" / ;
      loop(t$tr(t),
         loop(r,
            put ssp.tl, Mod.tl, r.tl, ".", t.val:<7:0, (100*inv.l(r,t)/rgdp.l(r,t)):12:5 / ;
         ) ;
         put ssp.tl, Mod.tl, / ;
      ) ;
      put ssp.tl, Mod.tl, "/ ;" / /;
       
      put ssp.tl, Mod.tl, "Parameter kadj0(r) /" / ;
      loop(r,
         put ssp.tl, Mod.tl, r.tl, (kadj0(r)):10:3 / ;
      ) ;
      put ssp.tl, Mod.tl, "/ ;" ;
7858   
GAMS 36.1.0  r2c0a44a Released Aug  2, 2021 WEX-WEI x86 64bit/MS Windows - 11/19/21 10:44:12 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggGTAP.gms
     2       40 INCLUDE        1      40  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\SSPSets.gms
     3      150 INCLUDE        1      44  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\ANX1Map.gms
     4      182 INCLUDE        3      32  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\GTAPSets10APOWF.gms
     5     2434 INCLUDE        1     308  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\saveMap.gms
     6     2940 BATINCLUDE     1     705  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggsam.gms
     7     3392 GDXIN          1    1035  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\../GTAP10POW/GSDFnco2.gdx
     8     3498 BATINCLUDE     1    1141  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggNRG.gms
     9     3637 IF EXIST       1    1171  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\../GTAP10POW/GSDFBOP.gdx
    10     3916 IF EXIST       1    1640  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\../SatAcct/RystadGTAP2014.gdx
    11     4072 GDXIN          1    1801  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\../SatAcct/sspScenV9_2.gdx
    12     4136 GDXIN          1    1865  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\../SatAcct/WEOData.gdx
    13     4201 BATINCLUDE     1    1930  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makeset.gms
    14     4890 BATINCLUDE     1    1946  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makeset.gms
    15     5570 BATINCLUDE     1    1947  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makesetEnv.gms
    16     6176 BATINCLUDE     1    1963  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggEnvElast.gms
    17     6366 BATINCLUDE    16     190  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    18     6371 BATINCLUDE    16     191  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    19     6376 BATINCLUDE    16     192  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    20     6381 BATINCLUDE    16     193  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    21     6386 BATINCLUDE    16     194  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    22     6391 BATINCLUDE    16     195  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    23     6396 BATINCLUDE    16     196  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    24     6401 BATINCLUDE    16     197  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    25     6406 BATINCLUDE    16     198  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    26     6411 BATINCLUDE    16     199  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    27     6416 BATINCLUDE    16     200  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
    28     6421 BATINCLUDE    16     201  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
    29     6431 BATINCLUDE    16     207  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
    30     6441 BATINCLUDE    16     213  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
    31     6449 BATINCLUDE    16     217  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggra.gms
    32     6457 BATINCLUDE    16     221  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    33     6466 BATINCLUDE    16     226  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    34     6475 BATINCLUDE    16     231  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrav.gms
    35     6483 BATINCLUDE    16     235  ..F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\aggrave.gms
    36     6757 BATINCLUDE     1    1966  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\makeAggSets.gms
    37     6848 IF EXIST       1    1999  F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\ANX1Spc.gms
    38     6858 INCLUDE        1    2013  .F:\Andre\ENVISAGE-Training\EnvisageNOV2021\Data\macro.gms


COMPILATION TIME     =        0.375 SECONDS      3 MB  36.1.0 r2c0a44a WEX-WEI
GAMS 36.1.0  r2c0a44a Released Aug  2, 2021 WEX-WEI x86 64bit/MS Windows - 11/19/21 10:44:12 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


----   2189 SET mapcr  Mapping from countries to model aggregation

            CHN         XEA         USA         RUS         EUR         XOE         OPC         SAS         XLC         ROW

AUS                                                                     YES
NZL                                                                     YES
CHN         YES
HKG                     YES
JPN                                                                     YES
KOR                                                                     YES
MNG                     YES
TWN                     YES
BRN                     YES
KHM                     YES
IDN                     YES
LAO                     YES
MYS                     YES
PHL                     YES
SGP                     YES
THA                     YES
VNM                     YES
BGD                                                                                             YES
IND                                                                                             YES
NPL                                                                                             YES
PAK                                                                                             YES
LKA                                                                                             YES
CAN                                                                     YES
USA                                 YES
MEX                                                                                                         YES
ARG                                                                                                         YES
BOL                                                                                                         YES
BRA                                                                                 YES
CHL                                                                                                         YES
COL                                                                                                         YES
ECU                                                                                                         YES
PRY                                                                                                         YES
PER                                                                                                         YES
URY                                                                                                         YES
VEN                                                                                 YES
CRI                                                                                                         YES
GTM                                                                                                         YES
HND                                                                                                         YES
NIC                                                                                                         YES
PAN                                                                                                         YES
SLV                                                                                                         YES
DOM                                                                                                         YES
JAM                                                                                                         YES
PRI                                                                                                         YES
TTO                                                                                                         YES
AUT                                                         YES
BEL                                                         YES
CYP                                                         YES
CZE                                                         YES
DNK                                                         YES
EST                                                         YES
FIN                                                         YES
FRA                                                         YES
DEU                                                         YES
GRC                                                         YES
HUN                                                         YES
IRL                                                         YES
ITA                                                         YES
LVA                                                         YES
LTU                                                         YES
LUX                                                         YES
MLT                                                         YES
NLD                                                         YES
POL                                                         YES
PRT                                                         YES
SVK                                                         YES
SVN                                                         YES
ESP                                                         YES
SWE                                                         YES
GBR                                                         YES
CHE                                                         YES
NOR                                                         YES
ALB                                                                                                                     YES
BGR                                                                                                                     YES
BLR                                                                                                                     YES
HRV                                                                                                                     YES
ROU                                                                                                                     YES
RUS                                             YES
UKR                                                                                                                     YES
KAZ                                                                                 YES
KGZ                                                                                                                     YES
TJK                                                                                                                     YES
ARM                                                                                                                     YES
AZE                                                                                                                     YES
GEO                                                                                                                     YES
BHR                                                                                 YES
IRN                                                                                 YES
ISR                                                                                                                     YES
JOR                                                                                                                     YES
KWT                                                                                 YES
OMN                                                                                 YES
QAT                                                                                 YES
SAU                                                                                 YES
TUR                                                                                                                     YES
ARE                                                                                 YES
EGY                                                                                                                     YES
MAR                                                                                                                     YES
TUN                                                                                                                     YES
BEN                                                                                                                     YES
BFA                                                                                                                     YES
CMR                                                                                                                     YES
CIV                                                                                                                     YES
GHA                                                                                                                     YES
GIN                                                                                                                     YES
NGA                                                                                 YES
SEN                                                                                                                     YES
TGO                                                                                                                     YES
ETH                                                                                                                     YES
KEN                                                                                                                     YES
MDG                                                                                                                     YES
MWI                                                                                                                     YES
MUS                                                                                                                     YES
MOZ                                                                                                                     YES
RWA                                                                                                                     YES
TZA                                                                                                                     YES
UGA                                                                                                                     YES
ZMB                                                                                                                     YES
ZWE                                                                                                                     YES
BWA                                                                                                                     YES
NAM                                                                                                                     YES
ZAF                                                                                                                     YES
ASM                     YES
COK                     YES
FJI                     YES
PYF                     YES
GUM                     YES
KIR                     YES
MHL                     YES
FSM                     YES
NRU                     YES
NCL                     YES
NIU                     YES
MNP                     YES
PLW                     YES
PNG                     YES
WSM                     YES
SLB                     YES
TKL                     YES
TON                     YES
TUV                     YES
VUT                     YES
WLF                     YES
MAC                     YES
PRK                     YES
MMR                     YES
TLS                     YES
AFG                                                                                             YES
BTN                                                                                             YES
MDV                                                                                             YES
BMU                                                                                                         YES
GRL                                                                                                         YES
SPM                                                                                                         YES
FLK                                                                                                         YES
GUF                                                                                                         YES
GUY                                                                                                         YES
SUR                                                                                                         YES
BLZ                                                                                                         YES
AIA                                                                                                         YES
ATG                                                                                                         YES
ABW                                                                                                         YES
ANT                                                                                                         YES
BHS                                                                                                         YES
BRB                                                                                                         YES
VGB                                                                                                         YES
CYM                                                                                                         YES
CUB                                                                                                         YES
DMA                                                                                                         YES
GRD                                                                                                         YES
HTI                                                                                                         YES
MSR                                                                                                         YES
KNA                                                                                                         YES
LCA                                                                                                         YES
VCT                                                                                                         YES
TCA                                                                                                         YES
VIR                                                                                                         YES
GLP                                                         YES
MTQ                                                         YES
REU                                                                                                                     YES
ISL                                                         YES
LIE                                                         YES
MDA                                                                                                                     YES
AND                                                                                                                     YES
BIH                                                                                                                     YES
CHI                                                         YES
FRO                                                                                                                     YES
GIB                                                                                                                     YES
VAT                                                                                                                     YES
IMN                                                         YES
MKD                                                                                                                     YES
MCO                                                                                                                     YES
MNE                                                                                                                     YES
SMR                                                                                                                     YES
SRB                                                                                                                     YES
UVK                                                                                                                     YES
TKM                                                                                                                     YES
UZB                                                                                                                     YES
IRQ                                                                                 YES
LBN                                                                                 YES
PSE                                                                                 YES
SYR                                                                                 YES
YEM                                                                                 YES
DZA                                                                                 YES
LBY                                                                                 YES
ESH                                                                                 YES
CPV                                                                                                                     YES
GMB                                                                                                                     YES
GNB                                                                                                                     YES
LBR                                                                                                                     YES
MLI                                                                                                                     YES
MRT                                                                                                                     YES
NER                                                                                                                     YES
SHN                                                                                                                     YES
SLE                                                                                                                     YES
CAF                                                                                                                     YES
TCD                                                                                                                     YES
COG                                                                                                                     YES
GNQ                                                                                                                     YES
GAB                                                                                                                     YES
STP                                                                                                                     YES
AGO                                                                                 YES
COD                                                                                 YES
BDI                                                                                                                     YES
COM                                                                                                                     YES
DJI                                                                                                                     YES
ERI                                                                                                                     YES
MYT                                                                                                                     YES
SYC                                                                                                                     YES
SOM                                                                                                                     YES
SDN                                                                                                                     YES
SSD                                                                                                                     YES
LSO                                                                                                                     YES
SWZ                                                                                                                     YES


----   2189 SET maprg  Mapping for missing regions 'r'

            CHN         XEA         USA         RUS         EUR         XOE         OPC         SAS         XLC         ROW

AUS                                                                     YES
NZL                                                                     YES
XOC                     YES
CHN         YES
HKG                     YES
JPN                                                                     YES
KOR                                                                     YES
MNG                     YES
TWN                     YES
XEA                     YES
BRN                     YES
KHM                     YES
IDN                     YES
LAO                     YES
MYS                     YES
PHL                     YES
SGP                     YES
THA                     YES
VNM                     YES
XSE                     YES
BGD                                                                                             YES
IND                                                                                             YES
NPL                                                                                             YES
PAK                                                                                             YES
LKA                                                                                             YES
XSA                                                                                             YES
CAN                                                                     YES
USA                                 YES
MEX                                                                                                         YES
XNA                                                                                                         YES
ARG                                                                                                         YES
BOL                                                                                                         YES
BRA                                                                                 YES
CHL                                                                                                         YES
COL                                                                                                         YES
ECU                                                                                                         YES
PRY                                                                                                         YES
PER                                                                                                         YES
URY                                                                                                         YES
VEN                                                                                 YES
XSM                                                                                                         YES
CRI                                                                                                         YES
GTM                                                                                                         YES
HND                                                                                                         YES
NIC                                                                                                         YES
PAN                                                                                                         YES
SLV                                                                                                         YES
XCA                                                                                                         YES
DOM                                                                                                         YES
JAM                                                                                                         YES
PRI                                                                                                         YES
TTO                                                                                                         YES
XCB                                                                                                         YES
AUT                                                         YES
BEL                                                         YES
CYP                                                         YES
CZE                                                         YES
DNK                                                         YES
EST                                                         YES
FIN                                                         YES
FRA                                                         YES
DEU                                                         YES
GRC                                                         YES
HUN                                                         YES
IRL                                                         YES
ITA                                                         YES
LVA                                                         YES
LTU                                                         YES
LUX                                                         YES
MLT                                                         YES
NLD                                                         YES
POL                                                         YES
PRT                                                         YES
SVK                                                         YES
SVN                                                         YES
ESP                                                         YES
SWE                                                         YES
GBR                                                         YES
CHE                                                         YES
NOR                                                         YES
XEF                                                         YES
ALB                                                                                                                     YES
BGR                                                                                                                     YES
BLR                                                                                                                     YES
HRV                                                                                                                     YES
ROU                                                                                                                     YES
RUS                                             YES
UKR                                                                                                                     YES
XEE                                                                                                                     YES
XER                                                                                                                     YES
KAZ                                                                                 YES
KGZ                                                                                                                     YES
TJK                                                                                                                     YES
XSU                                                                                                                     YES
ARM                                                                                                                     YES
AZE                                                                                                                     YES
GEO                                                                                                                     YES
BHR                                                                                 YES
IRN                                                                                 YES
ISR                                                                                                                     YES
JOR                                                                                                                     YES
KWT                                                                                 YES
OMN                                                                                 YES
QAT                                                                                 YES
SAU                                                                                 YES
TUR                                                                                                                     YES
ARE                                                                                 YES
XWS                                                                                 YES
EGY                                                                                                                     YES
MAR                                                                                                                     YES
TUN                                                                                                                     YES
XNF                                                                                 YES
BEN                                                                                                                     YES
BFA                                                                                                                     YES
CMR                                                                                                                     YES
CIV                                                                                                                     YES
GHA                                                                                                                     YES
GIN                                                                                                                     YES
NGA                                                                                 YES
SEN                                                                                                                     YES
TGO                                                                                                                     YES
XWF                                                                                                                     YES
XCF                                                                                                                     YES
XAC                                                                                 YES
ETH                                                                                                                     YES
KEN                                                                                                                     YES
MDG                                                                                                                     YES
MWI                                                                                                                     YES
MUS                                                                                                                     YES
MOZ                                                                                                                     YES
RWA                                                                                                                     YES
TZA                                                                                                                     YES
UGA                                                                                                                     YES
ZMB                                                                                                                     YES
ZWE                                                                                                                     YES
XEC                                                                                                                     YES
BWA                                         